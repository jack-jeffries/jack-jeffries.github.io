\documentclass[11pt]{book}
\usepackage[margin=1in]{geometry}
\usepackage{latexsym,amsfonts,amssymb,amsthm,amsmath,amscd,stmaryrd}
\usepackage{mathrsfs}
\usepackage[all]{xy}  
\usepackage{enumerate}
\usepackage{color,tikz}
\usepackage{imakeidx,hyperref}
\usepackage{multicol}
\usepackage{empheq}
\usepackage{comment}


%%% Cut up section 4.5 to end of ch 2 and before 3.5

%%% Take HW 3.1 lemma into 3.5

%%% Move 4.28 and 4.33 to Matlis D section

%%% Move AG to chaper 3

%%% Clean up depth/noeth hypotheses in chapter 1

%%%

\makeindex

\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{Example}[theorem]{Example}
\numberwithin{equation}{section}
\numberwithin{theorem}{chapter}

\theoremstyle{definition}
\newtheorem{questions}[theorem]{Questions}
\newtheorem{propdef}[theorem]{Proposition-Definition}
\newtheorem{defthm}[theorem]{Definition/Theorem}
\newtheorem{discussion}[theorem]{Discussion}
\newtheorem{question}[theorem]{Question}
\newtheorem{example}[theorem]{Example}
\newtheorem{exercise}[theorem]{Exercise}
\newtheorem*{basic properties}{Basic Properties}
\newtheorem*{properties}{Properties}
\newtheorem*{eremarks}{Ending Remarks}
\newtheorem*{Important Remark}{Important Remark}
\newtheorem{remark}[theorem]{Remark}


\theoremstyle{remark}
\newtheorem*{claim*}{Claim}
\newtheorem*{IH*}{Induction Hypothesis}
\newtheorem{ques}[theorem]{Question}
\newtheorem{setup}[theorem]{Set up}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{observation}[theorem]{Observation}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{idea}[theorem]{Idea}


%For sets
\newcommand{\set}[1]{\left\{ #1 \right\}}

%Letters
\newcommand{\RR}{\mathbb{R}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\PP}{\mathbb{P}}
\renewcommand{\AA}{\mathbb{A}}
\newcommand{\m}{\mathfrak{m}}
\newcommand{\n}{\mathfrak{n}}
\newcommand{\V}{\mathcal{V}}
\newcommand{\p}{\mathfrak{p}}
\newcommand{\q}{\mathfrak{q}}
\newcommand{\A}{\mathfrak{a}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cE}{\mathcal{E}}
\newcommand{\cM}{\mathcal{M}}
\renewcommand{\aa}{\mathfrak{a}}
\newcommand{\bb}{\mathfrak{b}}
\newcommand{\cc}{\mathfrak{c}}

%Cech complex
\newcommand{\C}{\check{C}}

%operators
\newcommand{\type}{\operatorname{type}}
\newcommand{\syz}{\operatorname{syz}}
\newcommand{\ara}{\operatorname{ara}}
\newcommand{\Spec}{\operatorname{Spec}}
\newcommand{\Depth}{\operatorname{depth}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\End}{\operatorname{End}}
\newcommand{\Ext}{\operatorname{Ext}}
\newcommand{\Tor}{\operatorname{Tor}}
\renewcommand{\ker}{\operatorname{ker}}
\newcommand{\coker}{\operatorname{coker}}
\newcommand{\Max}{\operatorname{max}}
\newcommand{\Ann}{\operatorname{Ann}}
\newcommand{\Ass}{\operatorname{Ass}}	
\newcommand{\Char}{\operatorname{char}}
\newcommand{\rk}{\operatorname{rk}}	
\newcommand{\height}{\operatorname{ht}}	
\newcommand{\ceil}[1]{\lceil {#1} \rceil}
\newcommand{\floor}[1]{\lfloor {#1} \rfloor}
\newcommand{\ann}{\operatorname{ann}}
\newcommand{\Min}{\operatorname{Min}}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\cd}{cd}
\renewcommand{\dim}{\operatorname{dim}}
\newcommand{\grade}{\operatorname{grade}}
\newcommand{\reg}{\operatorname{reg}}
\newcommand{\Treg}{\operatorname{t-reg}}
\newcommand{\Ereg}{\operatorname{e-reg}}
\newcommand{\Lreg}{\operatorname{c-reg}}
\newcommand{\depth}{\operatorname{depth}}
\DeclareMathOperator{\Supp}{Supp}
\newcommand{\id}{\operatorname{id}}
\newcommand{\Tr}{\operatorname{Tr}}
\renewcommand{\height}{\operatorname{ht}}
\newcommand{\Rmod}{\operatorname{R-mod}}
\newcommand{\opens}{\operatorname{opens}}
\newcommand{\pd}{\operatorname{pd}}
\newcommand{\cC}{\v{C}}
\newcommand{\tp}{\mathrm{topdeg}}
\newcommand{\bt}{\mathrm{botdeg}}
\newcommand{\ai}{\mathrm{a}}
\newcommand{\dtil}[1]{\widetilde{\widetilde{#1}}}

\newcommand{\grHom}{\underline{\operatorname{Hom}}}
\newcommand{\grExt}{\underline{\operatorname{Ext}}}
\newcommand{\grTor}{\underline{\operatorname{Tor}}}



%leg/geqslant
\newcommand{\ls}{\leqslant}
\newcommand{\gs}{\geqslant}

%(co)homology
\renewcommand{\H}{\operatorname{H}}
%Cech
\newcommand{\Ch}{\textrm{\v C}}


%colors
\newcommand{\blue}[1]{\color {blue} #1}                   
\newcommand{\red}[1]{\color {red} #1}                   
\newcommand{\green}[1]{\color {green} #1} 



%circled letters
\newcommand*\mycirc[1]{%
   \begin{tikzpicture}
     \node[draw,circle,inner sep=1pt] {#1};
   \end{tikzpicture}} 

%primes

\title{Math 615: Local Cohomology}
\author{Jack Jeffries}

\begin{document}

\date{Winter 2018}
\maketitle

\tableofcontents

\setcounter{chapter}{-1}
\chapter{Introduction}

\section{What am I?}

These are lecture notes from the Winter 2018 semester section of Math 615, Commutative Algebra II, at The University of Michigan. The topic for the semester was local cohomology. The course is designed for people who have taken a first course in Commutative Algebra, like Math 614 at Michigan, and a class in Algebraic Topology or Homological Algebra. The notes draw largely from Mel Hochster's notes on the same topic, Craig Huneke's lectures on local cohomology, and the book Twenty-four Hours of Local Cohomology. Many thanks are due to Elo\'isa Grifo, who helped with typesetting these notes, and to the students in the class, who corrected many typos and asked many interesting questions that prompted some of the material. Additional thanks to Eamon Quinlan-Gallego, Taylor Murray, and David Lieberman for finding typos in these notes. Thanks are also due to the NSF for its support by grant DMS~\#1606353.

\section{Where are we going?}\index{living document}

Is $\mathbb{R}^m$ homeomorphic to $\mathbb{R}^n$? An obstruction is the cohomology of the pair $\H^i(X,X \setminus \left\lbrace \textrm{pt} \right\rbrace)$:
$$\H^i(\mathbb{R}^n, \mathbb{R}^n \setminus \left\lbrace \textrm{pt}\rbrace ; G \right) = \left\lbrace \begin{array}{ll} G & \textrm{if } i=n \\ 0 & \textrm{if } i \neq n. \end{array} \right.$$

Our main object of study is an algebraic analogue of this:


$$\begin{array}{ccccccc}
\H^i(X,X \setminus  Z; A ) &&&& \H^i_I(M) \\
& \\
\begin{array}{cc} Z \subseteq X & A \\ \textrm{closed} & \textrm{ab. group} \end{array} 
&&&&
\begin{array}{cc} I \subseteq R & M \\ \textrm{ideal} & \textrm{R-mod} \end{array} \\
\end{array}$$

$$\xymatrix@R=2mm{& X \ar@{~}[rrr] &&& \Spec(R) \\ & Z \ar@{~}[rrr] &&& \V(I)}$$

For example, this object $\H^i_I(M)$ will detect dimension:
$$\max \left\lbrace t \ | \ \H^t_\m(R) \neq 0 \right\rbrace = \dim R \hskip 10mm ((R,\m) \textrm{ local ring}).$$

But, if $\Spec(R)$ does not correspond to a nonsingular variety (compare to $X$ not a manifold) then there might be more than one nonvanishing $\H^t_\m(R)$.

\vskip 1cm

Two key applications of local cohomology:

\begin{itemize}
\renewcommand{\labelitemi}{\LARGE$\star$}
	\item Number of equations needed to cut out a subvariety: 
	The ideal 
	$$I = \left( \Delta_1, \Delta_2, \Delta_3 \right) \subseteq k \left[ \begin{array}{ccc} x_1 & x_2 & x_3 \\ y_1 & y_2 & y_3 \end{array} \right] = R$$
	corresponds to the variety of rank $1$ $2 \times 2$ matrices. We can see easily that $\V(I) \neq \V(f)$ for any $f \in R$; $\height(I) = 2$, and this would contradict Krull's Height Theorem. It is less obvious whether $\V(I) = \V(f,g)$ for some $f, g \in R$.
	
	\item Connectedness Theorems: Local cohomology detects a lot of information about the topology of the Spec of a ring / of a variety. The Fulton-Hanson connectedness theorem, which we'll prove, says that if $X,Y\subseteq \mathbb{P}^n$, and $\dim X + \dim Y > n$, then $X \cap Y$ is connected. 
\end{itemize}


For these reasons, we will be interested in the (non)vanishing of these modules.
A catch: they will not usually be finitely generated.

\begin{example}
	Let $R = k[x_1, \ldots, x_n]$, $k$ be a field, and $\m = \left( x_1, \ldots, x_n \right)$. Then $\H^n_\m(R)$ is the $k$-vector space structure
	$$\bigoplus_{\textrm{all } a_i > 0} k \cdot \frac{1}{x_1^{a_1} \cdots x_n^{a_n}},$$
	with $R$-module structure given by
	$$x_1^{b_1} \cdots x_n^{b_n} \cdot \frac{\gamma}{x_1^{a_1} \cdots x_n^{a_n}} =
\left\lbrace \begin{array}{ll}
\frac{\gamma}{x_1^{a_1-b_1} \cdots x_n^{a_n-b_n}} & \textrm{if all } b_i < a_i \\
0 & \textrm{otherwise.}
\end{array} \right.$$
This is not a finitely generated module! Note that every finitely generated submodule only has terms with bounded negative degree.

But this is still a very nice module: it looks like $R$ upside down.

\begin{multicols}{2}
\xymatrix@R=4mm@C=4mm{&\cdot && \cdot && \cdot && \cdot && \cdot \\
&& x^3 \ar[ul]^-x \ar[ur]_-y && x^2y \ar[ul]^-x \ar[ur]_-y && xy^2 \ar[ul]^-x \ar[ur]_-y && y^3 \ar[ul] \ar[ur] \\ 
&&& x^2 \ar[ul]^-x \ar[ur]_-y && xy \ar[ul]^-x \ar[ur]_-y && y^2 \ar[ul]^-x \ar[ur]_-y \\ 
&&&& x \ar[ul]^-x \ar[ur]_-y && y \ar[ul]^-x \ar[ur]_-y \\
&&&&& 1 \ar[ul]^-x \ar[ur]_-y}
\vskip 2mm
\qquad\qquad\qquad\qquad\qquad$k[x,y]$

\xymatrix@R=5mm@C=4mm{&&&& \frac{1}{xy} \\ 
&&& \frac{1}{x^2y}\ar[ur]^-x && \frac{1}{xy^2} \ar[ul]_-y \\
&& \frac{1}{x^3y} \ar[ur]^-x && \frac{1}{x^2y^2} \ar[ul]_-y \ar[ur]^-x && \frac{1}{xy^3} \ar[ul]_-y \\
&\cdot \ar[ur]^-x && \cdot \ar[ur]^-x \ar[ul]_-y && \cdot \ar[ur]^-x \ar[ul]_-y && \cdot \ar[ul]_-y \\
}
\vskip 2mm
\qquad\qquad\qquad\, $\H^2_{(x,y)} \left( k[x,y] \right)$
\end{multicols}

\end{example}


So we will want to develop the right notion of upside down (Matlis Duality), and a number of senses in which local cohomology modules are well-behaved or finite (for example, using differential operators).

Local cohomology modules are given by right-derived functors, so they are computed via injective resolutions. We will need to understand injective modules.

Local cohomology modules are also intrinsically related to $\Ext$ (very) and $\Tor$, so we will want to understand how these (and free resolutions) are related to qualitative properties of $R$.








\chapter{Preliminaries}

\section{Ext, Tor, and derived functors}

Recall the following properties of the $\Hom$ and tensor functors:

\begin{lemma}
Let $M$ be an $R$-module.
\begin{itemize}
	\item The covariant functor $\Hom_R(M,-)$ is left exact, meaning that given an exact sequence $\xymatrix@C=5mm{0 \ar[r] & A \ar[r] & B \ar[r] & C}$ the sequence $\xymatrix@C=5mm{0 \ar[r] & \Hom_R(M,A) \ar[r] & \Hom_R(M,B) \ar[r] & \Hom_R(M,C)}$ is exact.
	\item The contravariant functor $\Hom_R(-,M)$ is left exact, meaning that given an exact sequence $\xymatrix@C=5mm{ A \ar[r] & B \ar[r] & C \ar[r] & 0}$ the sequence $\xymatrix@C=5mm{0 \ar[r] & \Hom_R(C,M) \ar[r] & \Hom_R(B,M) \ar[r] & \Hom_R(A,M)}$ is exact.
	\item The covariant functor $- \otimes_R M$ is right exact: given an exact sequence $\xymatrix@C=5mm{A \ar[r] & B \ar[r] & C \ar[r] & 0,}$ the sequence $\xymatrix@C=6mm{A \otimes_R M \ar[r] & B \otimes_R M \ar[r] & C \otimes_R M \ar[r] & 0}$ is exact.
\end{itemize}
\end{lemma}

Recall that an $R$-module $M$ is {\bf projective} if $\Hom_R(M,-)$ is an exact functor, or {\bf injective} if $\Hom_R(-,M)$ is an exact functor.\index{projective module}\index{injective module} Equivalently, $M$ is projective (respectively, injective) if every short exact sequence of the form
\[0\to A \to B \to M \to 0 \qquad (\text{respectively,} \ \ 0\to M\to A \to B \to 0)\] splits. We will work with exact sequences, but also more generally with complexes of $R$-modules.


\begin{idea}\index{happiest functor}
	Given a module $M$, we would like to continue the short exact sequences above: if $\xymatrix@C=5mm{0 \ar[r] & A \ar[r] & B \ar[r] & C \ar[r] & 0}$ is a short exact sequence, we would like to understand what comes next ``$?$'' in
	\[\xymatrix@C=5mm{0 \ar[r] & \Hom_R(C,M) \ar[r] & \Hom_R(B,M) \ar[r] & \Hom_R(A,M) \ar[r] & ?}\]
	Functors are happiest with split exact sequences. If $C$ happened to be projective, then the given short exact sequence would split, yielding another short exact sequence $\xymatrix@C=5mm{0 & A \ar[l] & B \ar[l] & C \ar[l] & 0 \ar[l]}$, and by left exactness again, an exact sequence
	\[\xymatrix@C=5mm{ & \Hom_R(C,M) \ar[l] & \Hom_R(B,M) \ar[l] & \Hom_R(A,M) \ar[l] & 0 \ar[l]}.\]
	Since the maps $A\to B \to A$ compose to the identity, the induced maps $\Hom_R(A,M) \to \Hom_R(B,M) \to \Hom_R(A,M)$ compose to the identity, so ``$?$''$=0$.
To get a handle on ``$?$'' in general, we would like to try to replace the modules ``$-$'' we feed into $\Hom_R(-,M)$ with projectives.

Similarly, to get a handle on completing short exact sequences with $\Hom_R(M,-)$, we want to try to replace the modules ``$-$'' we feed in with injectives. (Think about why we want injectives rather than projectives in this case if this isn't clear to you.)
	
\end{idea}

\begin{definition}[Complex]\index{complex}\index{complex of $R$-modules}\index{homology of a complex}
	A {\bf complex} of $R$-modules $C_\bullet$ is a sequence of $R$-modules and homomorphisms of $R$-modules
	$$\xymatrix{C_\bullet = & \cdots \ar[r] & C_{n+1} \ar[r]^-{\delta_{n+1}} & C_n \ar[r]^{\delta_n} & C_{n-1} \ar[r] & \cdots}$$
	such that $\delta_n \delta_{n+1} = 0$ for all $n$.
	
	The $n$-th {\bf homology} module of a complex $C_\bullet$ is the $R$-module $\H_n(C_\bullet) = \ker \delta_n / \im \delta_{n+1}$.
	A complex is {\bf exact} at $C_n$, or in homological degree $n$, if $\H_n(C_\bullet) = 0$.
\end{definition}


\begin{remark}\index{cohomology of a complex}
	A complex might be indexed \emph{homologically}, with maps between decreasing homological degrees, as above, or cohomologically, with maps between modules in increasing homological degrees, as follows:
	$$\xymatrix{C^\bullet = & \cdots \ar[r] & C^{n-1} \ar[r]^-{\delta^{n-1}} & C^n \ar[r]^{\delta^n} & C^{n+1} \ar[r] & \cdots}$$
	In this case, the {\bf cohomology} of $C^\bullet$ is given by
	$$\H^n(C^\bullet) = \ker \delta^n / \im \delta^{n-1}.$$
\end{remark}


Projective and injective resolutions are exact complexes of particular interest.

\begin{definition}[Projective and injective resolutions]\index{projective resolution}\index{injective resolution}\index{free resolution}
	Let $M$ be an $R$-module.
	\begin{itemize}
		\item A {\bf projective resolution} of $M$ is a complex
		$$\xymatrix{P_\bullet = & \cdots \ar[r] & P_{2} \ar[r]^-{\delta_{2}} & P_1 \ar[r]^{\delta_1} & P_{0} \ar[r] & 0}$$
		such that
		$$\H_i(P_\bullet) = 
		\left\lbrace \begin{array}{ll} M & \textrm{ if } i = 0 \\
		0 & \textrm{ if } i>0.
		\end{array} \right.$$
	If the modules $P_i$ are all free, we say that $P_\bullet$ is a {\bf free resolution} of $M$.
		\item An {\bf injective resolution} of $M$ is a complex
		$$\xymatrix{I^\bullet = & 0 \ar[r] & I^{0} \ar[r]^-{\delta^{0}} & I^1 \ar[r]^{\delta^1} & I^{2} \ar[r] & \cdots}$$
		such that
		$$\H^i(I^\bullet) = 
		\left\lbrace \begin{array}{ll} M & \textrm{ if } i = 0 \\
		0 & \textrm{ if } i>0.
		\end{array} \right.$$
	\end{itemize}
	\end{definition}

We will often add on a ``$(\to M)$'' before the last ``$\to 0$'' at the end of a projective resolution to indicate what we are resolving; note that the resulting complex with no parentheses is now exact.
	
Projective and injective resolutions are not unique, but there is (under some hypotheses) a distinguished projective (respectively, injective), called the {\bf minimal} projective (respectively, injective) resolution of $M$. We will discuss these in more detail later.

We also note that the category of $R$-modules has enough projectives and enough injectives, meaning that for every $R$-module there exists a projective module $P$ surjecting onto $M$ and an injective module $I$ containing $M$. As a consequence, every $R$-module has a projective resolution and an injective resolution.

We can now define derived functors.

\begin{definition}\index{derived functor}\index{right derived functor}\index{left derived functor}$\,$

\begin{itemize}
	\item Let $F: \Rmod \longrightarrow \Rmod$ be a covariant left exact functor. The {\bf right derived functors} $R^iF$ of $F$ are a sequence of functors $R^iF\!:  \Rmod \longrightarrow \Rmod$. To compute $R^iF(N)$ for each $R$-module $N$, we start by finding an injective resolution of $N$
	$$\xymatrix{I_\bullet = & 0 \ar[r] & (N \ar[r] &) I_{0} \ar[r]^-{\delta_{1}} & I_1 \ar[r]^{\delta_1} & I_{2} \ar[r] & \cdots}.$$
	Then we apply $F$ to $I_{\bullet}$, obtaining a complex
	$$\xymatrix{0 \ar[r] & F(I_{0}) \ar[r]^-{F(\delta_{1})} & F(I_1) \ar[r]^{F(\delta_1)} & F(I_{2}) \ar[r] & \cdots}.$$
	Note that this complex may no longer be exact. However, the $i$-th cohomology of this complex is $R^iF(N)$. Note that $R^0F(N) = F(N)$.

	
	\item Let $F\!: \Rmod \longrightarrow \Rmod$ be a contravariant left exact functor. The {\bf right derived functors} $R^iF$ of $F$ are a sequence of functors $R^iF\!:  \Rmod \longrightarrow \Rmod$. To compute $R^iF(N)$ for each $R$-module $N$, we start by finding a projective resolution of $N$,
	$$\xymatrix{P_\bullet = & \cdots \ar[r] & P_{2} \ar[r]^-{\delta_{2}} & P_1 \ar[r]^{\delta_1} & P_{0} (\ar[r] & N ) \ar[r] & 0}.$$
	Then we apply $F$ to $P_{\bullet}$, obtaining a complex
	$$\xymatrix{0 \ar[r] & F(P_{0}) \ar[r]^-{F(\delta_{1})} & F(P_1) \ar[r]^{F(\delta_1)} & F(P_{2}) \ar[r] & \cdots}.$$
	The $i$-th cohomology of this complex is $R^iF(N)$. Note that $R^0F(N) = F(N)$.
	
	
	\item Let $F\!: \Rmod \longrightarrow \Rmod$ be a covariant right exact functor. The {\bf left derived functors} $L^iF$ of $F$ are a sequence of functors $L^iF\!:  \Rmod \longrightarrow \Rmod$, $i \geqslant 0$. To compute $R^iF(N)$ for each $R$-module $N$, we start by finding a projective resolution of $N$,
	$$\xymatrix{P_\bullet = & \cdots \ar[r] & P_{2} \ar[r]^-{\delta_{2}} & P_1 \ar[r]^{\delta_1} & P_{0} (\ar[r] & N ) \ar[r] & 0}.$$
	Then we apply $F$ to $P_{\bullet}$, obtaining a complex
	$$\xymatrix{\cdots \ar[r] & F(P_{2}) \ar[r]^-{F(\delta_{2})} & F(P_1) \ar[r]^{F(\delta_1)} & F(P_{0}) \ar[r] & 0}.$$
	The $i$-th homology of this complex is $L^iF(N)$. Note that $L^0F(N) = F(N)$.
	
	
	\item Let $F\!: \Rmod \longrightarrow \Rmod$ be a contravariant right exact functor. The {\bf left derived functors} $R^iF$ of $F$ are a sequence of functors $L^iF\!:  \Rmod \longrightarrow \Rmod$. To compute $L^iF(N)$ for each $R$-module $N$, we start by finding an injective resolution of $N$
	$$\xymatrix{I_\bullet = & 0 \ar[r] & (N \ar[r] &) I_{0} \ar[r]^-{\delta_{1}} & I_1 \ar[r]^{\delta_1} & I_{2} \ar[r] & \cdots}.$$
	Then we apply $F$ to $I_{\bullet}$, obtaining a complex
	$$\xymatrix{\cdots \ar[r] & F(I_{2}) \ar[r]^-{F(\delta_{2})} & F(I_1) \ar[r]^{F(\delta_1)} & F(I_{0}) \ar[r] & 0}.$$
	Note that this complex may no longer be exact. However, the $i$-th cohomology of this complex is $L^iF(N)$. Note that $L^0F(N) = F(N)$.
\end{itemize}
\end{definition}

\vskip 7mm

\begin{tabular}{| c | p{50mm} | p{55mm} |}
\hline
 & Left exact functor & Right exact functor \\ 
 \hline
covariant functor & takes left exact to left exact use: injective resolutions & takes right exact to right exact use: projective resolutions \\  
\hline
contravariant functor & takes right exact to left exact use: projective resolutions & takes left exact to right exact \quad use: injective resolutions \\
\hline
\end{tabular}


\vskip 10mm



\begin{remark}
	The left/right derived functors of a right/left exact functor are well-defined, meaning that different projective/injective resolutions yield isomorphic functors. 
\end{remark}

\begin{remark}
	If $R$ is noetherian, and $M$ is finitely generated, then $M$ admits a free resolution by finitely generated modules: take a free module with a basis corresponding to generating set for $M$ and map it onto $M$. The kernel of this map is finitely generated (by noetherianity), so we can repeat this over an over to get a free resolution.

On the other hand, a positive dimensional ring does not have any finitely generated injective modules (which you can take as an exercise for now, or return to later when we study the structure of injectives).
\end{remark}


\begin{remark}
	A map of $R$-modules $f \!: M \longrightarrow N$ can be lifted to a map between projective/injective resolutions of $M$. More precisely, given projective resolutions $P_\bullet$ and $Q_\bullet$ of $N$ and $M$ and injective resolutions $I_\bullet$ and $J_\bullet$ of $N$ and $M$, there exist commutative diagrams
	$$\xymatrix{& \cdots \ar[r] & P_{2} \ar[r]^-{\delta_{2}} & P_1 \ar[r]^{\delta_1} & P_{0} (\ar[r] & N ) \ar[r] & 0 \\ 
	& \cdots \ar[r] & Q_{2} \ar@{-->}[u]_-{f_2} \ar[r]^-{\delta_{2}} & Q_1 \ar@{-->}[u]_-{f_1} \ar[r]^{\delta_1} & Q_{0} \ar@{-->}[u]_-{f_0} (\ar[r] & M \ar[u]_-{f} ) \ar[r] & 0}$$
	and
	$$\xymatrix{0 \ar[r] & (N \ar[r]  &) I_{0} \ar[r]^-{\delta_{1}} & I_1 \ar[r]^{\delta_2} & I_{2} \ar[r] & \cdots \\ 
	0 \ar[r] & (M \ar[r]\ar[u]_-{f}  & ) J_{0} \ar@{-->}[u]_-{g_0} \ar[r]^-{\delta_{1}} & Q_1 \ar@{-->}[u]_-{g_1} \ar[r]^{\delta_2} & J_{2} \ar@{-->}[u]_-{g_2} \ar[r] & \cdots}$$
\end{remark}




Applying a left/right exact functor to a short exact sequence gives rise to a long exact sequence involving the corresponding derived functors. In other words, the derived functors of $F$ measure the failure of $F$ to be exact.

\begin{lemma}\label{long exact sequence}
	Consider a short exact sequence $\xymatrix{0 \ar[r] & A \ar[r] & B \ar[r] & C \ar[r] & 0}$.
	\begin{itemize}
		\item If $F$ is a covariant left exact functor, there is a long exact sequence
	$$\xymatrix@R=2mm@C=7mm{0 \ar[r] & F(A) \ar[r] & F(B) \ar[r] & F(C) \ar[r] & R^1F(A) \ar[r] & \cdots \\
		&\cdots \ar[r] & R^{i-1}F(C) \ar[r] & R^iF(A) \ar[r] & R^iF(B) \ar[r] & R^iF(C) \ar[r] & R^{i+1}F(A) \ar[r] & \cdots}.$$
		
	
		\item If $F$ is a contravariant left exact functor, there is a long exact sequence
		$$\xymatrix@R=2mm@C=7mm{0 \ar[r] & F(C) \ar[r] & F(B) \ar[r] & F(A) \ar[r] & R^1F(C) \ar[r] & \cdots \\
		&\cdots \ar[r] & R^{i-1}F(A) \ar[r] & R^iF(C) \ar[r] & R^iF(B) \ar[r] & R^iF(A) \ar[r] & R^{i+1}F(C) \ar[r] & \cdots}.$$
		
		
		\item If $F$ is a covariant right exact functor, there is a long exact sequence
		$$\xymatrix@R=2mm@C=5mm{\cdots \ar[r] & L^{i+1}F(C) \ar[r] & L^iF(A) \ar[r] & L^iF(B) \ar[r] & L^iF(C) \ar[r] & L^{i-1}F(A) \ar[r] & \cdots \\
		&& \cdots \ar[r] & L^1F(C) \ar[r] & F(A) \ar[r] & F(B) \ar[r] & F(C) \ar[r] & 0}.$$
		
		\item If $F$ is a covariant right exact functor, there is a long exact sequence
		$$\xymatrix@R=2mm@C=7mm{0 \ar[r] & F(A) \ar[r] & F(B) \ar[r] & F(C) \ar[r] & L^1F(A) \ar[r] & \cdots \\
		&\cdots \ar[r] & L^{i-1}F(C) \ar[r] & L^iF(A) \ar[r] & L^iF(B) \ar[r] & L^iF(C) \ar[r] & L^{i+1}F(A) \ar[r] & \cdots}.$$
	\end{itemize}
\end{lemma}


\begin{lemma}
	Let $F$ be a left exact functor, $G$ be a right exact functor, $M$ be an $R$-module, and ${x \in R}$. If the map $\xymatrix{M \ar[r]^-{.x} & M}$ given by multiplication by $x$ induces the maps $\xymatrix{F(N)\ar[r]^-{.x}& F(N)}$ and $\xymatrix{G(N) \ar[r]^-{.x} & G(N)}$ for all modules $N$, then $\xymatrix{R^iF(M) \ar[r]^-{.x} & R^i F(M)}$ and $\xymatrix{L^iF(M) \ar[r]^-{.x} & L^iF(M)}$.
\end{lemma}


\begin{proof}
	We note that the map $.x$ on $M$ lifts to multiplication by $x$ on a projective or injective resolution of $M$.
\end{proof}


We can now define two especially important derived functors, $\Ext$ and $\Tor$.

\begin{defthm}\label{defExtTor}\index{Ext}\index{Tor}\index{$\Ext^i_R(M,N)$}\index{$\Tor_i^R(M,N)$}
	Let $R$ be a ring and $M$ and $N$ be $R$-modules.
	
	\begin{itemize}
		\item Applying $R^i\Hom_R(M,-)$ to $N$ and $R^i\Hom_R(-,N)$ to $M$ yields isomorphic $R$-modules, which we denote by $\Ext^i_R(M,N)$. Following the definitions above, if $P_\bullet$ is a projective resolution of $M$, and $I_\bullet$ is an injective resolution of $N$, then $\Ext^i_R(M,N)$ can be computed as the $i$-th homology of
		$$\xymatrix{0 \ar[r] & \Hom_R(P_{0},N) \ar[r] & \Hom_R(P_1,N) \ar[r] & \Hom_R(P_{2},N) \ar[r] & \cdots},$$
		or the $i$-th cohomology of 
		$$\xymatrix{0 \ar[r] & \Hom_R(M,I_{0}) \ar[r] & \Hom_R(M,I_1) \ar[r] & \Hom_R(M,I_{2}) \ar[r] & \cdots}.$$
	
		\item Applying $L^i(-\otimes_R M)$ to $N$ and $L^i(-\otimes_R N)$ to $M$ yields isomorphic $R$-modules, which we denote by $\Tor_i^R(M,N)$. Following the definitions above, if $P_\bullet$ is a projective resolution of $M$, and $Q_\bullet$ is a projective resolution of $N$, then $\Tor_i^R(M,N)$ can be computed as the $i$-th homology of
		$$\xymatrix{\cdots \ar[r] & P_2 \otimes_R M \ar[r] & P_1 \otimes_R M \ar[r] & P_0 \otimes_R M \ar[r] & 0},$$
		or the $i$-th homology of 
		$$\xymatrix{\cdots \ar[r] & Q_2 \otimes_R N \ar[r] & Q_1 \otimes_R N \ar[r] & Q_0 \otimes_R N \ar[r] & 0}.$$
	
	\end{itemize}
\end{defthm}





\begin{remark}
	One way to show the $\Tor$ part of Theorem~\ref{defExtTor} is to show that if $P_\bullet\to M$ and $Q_\bullet\to N$ are projective resolutions, then $\Tor_i^R(M,N)=\H_i(P_\bullet \otimes_R Q_\bullet)$, where $P_\bullet \otimes_R Q_\bullet$ is the tensor product of complexes we will encounter in Definition~\ref{tensor product of complexes}. There is a notion (actually, different notions) of $\Hom$ between two complexes, and one can show the $\Ext$ part of loc.~cit.~by showing that if if $P_\bullet\to M$ is a projective resolution and $N \to E^\bullet$ is an injective resolution, then $\Ext^i_R(M,N)=\H^i(\Hom_R(P_\bullet,E^\bullet))$.
\end{remark}

\begin{definition}\index{$I$-torsion functor}\index{$\Gamma_I$}
	Let $I$ be an ideal in a ring $R$. The \emph{$I$-torsion functor}, is the functor that, on modules $M$, returns
	\[ \Gamma_I(M):=\{ m \in M \ | \ \exists n : I^n m = 0\}.\]
\end{definition}
If $\varphi:M\rightarrow N$ is a homomorphism and $I^n m =0$, then for any $a\in I^n$, $a \varphi(m)=\varphi(am)=0$, so $\phi$ restricts to a map $\Gamma_I(\varphi):=\varphi|_{\Gamma_I(M)}:\Gamma_I(M)\rightarrow \Gamma_I(N)$.

	
	This functor is left-exact: if 	$$\xymatrix{0 \ar[r] & A \ar[r]^-{\alpha} & B \ar[r]^{\beta} & C }$$ is exact, it is clear that $$\xymatrix{ 0 \ar[r] & \Gamma_I(A) \ar[r]^-{\Gamma_I(\alpha)} & \Gamma_I(B) \ar[r]^-{\Gamma_I(\beta)} & \Gamma_I(C) }$$ is exact at $\Gamma_I(A)$, since the restriction of an injective map is injective. If $b\in\Gamma_I(B)$ maps to zero in $\Gamma_I(C)$, then $\beta(b)=0$, so $b=\alpha(a)$ for some $a\in A$. But, since $\alpha$ is injective, $\ann_A(a)=\ann_B(\alpha(a))$, so we must have $a\in \Gamma_I(A)$.
	
	One definition of the local cohomology functors is $\H_i^I(-)=R^i \Gamma_I (-)$. We will need to understand injective modules to get a handle on this definition. We will also later find that these functors have a number of useful relationships with $\Ext$ and $\Tor$. We will first study $\Ext$, $\Tor$, and free resolutions, which have more accessible finiteness properties, and then study the structure of injective modules.





\section{A first look at free resolutions}


What do free resolutions look like? Let us try two examples:

\begin{example}
Consider $R = k[x,y]$ and $I=(x,y)$.
$$\xymatrix@C=5mm{? \ar[r] & R^2 \ar[rrr]^-{\begin{array}{cc} (x & y) \end{array}} &&& R \ar[r] & (R/I \ar[r] &) 0}$$	
To hit the kernel of the map, we need to find the $R$-linear relations between $x$ and $y$:
$$\left\lbrace \begin{pmatrix}a \\ b\end{pmatrix} \in R^2 \, | \, ax+by=0 \right\rbrace.$$

$$ax \, \substack{? \\ = \\ \,} -by$$
$R$ is a UFD, so $x | -by$. Since $x$ and $y$ are coprime, $x | -b$. Then:


\begin{multicols}{2}
\begin{align*}
b & = cx \\ 
ax & = -cxy \\
a & = -cy \\ 
{a \choose b} & = c {-y \choose x}	
\end{align*}

\begin{center} Later: \end{center}

\begin{empheq}[box=\fbox]{align*}
yb \in & (x) \\ 
\Rightarrow b \in & (x)
\end{empheq}

\begin{empheq}[box=\fbox]{align*}
xv & = 0 \\ 
\Rightarrow v & = 0
\end{empheq}
\end{multicols}



We now obtain
$$\xymatrix@C=6mm{0 \ar[r] & R \ar[rr]^-{{-y \choose x}} && R^2 \ar[rr]^-{\begin{array}{cc} (x & y) \end{array}} && R \ar[r] & 0}$$
Conclusion: the only relation is the ``obvious'' one. We can use this on $I = (f,g)$ for distinct irreducible polynomials $f$, $g$ in $k[\underline{x}]$:
$$\xymatrix@C=6mm{0 \ar[r] & R \ar[rr]^-{{-g \choose f}} && R^2 \ar[rr]^-{\begin{array}{cc} (f & g) \end{array}} && R \ar[r] & (R/(f,g) \ar[r] & ) 0}.$$
\end{example}



\begin{example}
	Take $S = k[x,y,u,v]/(xu-yv)$ and $I = (x,y)$. As before, a free resolution starts with
$$\xymatrix@C=5mm{? \ar[r] & R^2 \ar[rrr]^-{\begin{array}{cc} (x & y) \end{array}} &&& R \ar[r] & (R/I \ar[r] &) 0},$$	
and we want solutions ${a \choose b}$ to
$$a\underline{x}+b\underline{y} = 0.$$
Again, $-y \cdot \underline{x} + x \cdot \underline{y} = 0$ is a relation, but now $u \cdot \underline{x} - v \cdot \underline{y} = 0$ too.

\begin{claim*}
		Every relation on $x$, $y$ in $S$ is an $S$-linear combination of ${-y \choose x}$ and ${u \choose -v}$.
\end{claim*}
To see this, note that ``monomials'' are well-defined in $S$. Also, relations between monomials can be decomposed into sums of monomial relations. Use that structure and which are the same to check any monomial relation is a multiple of one of these.

So now we have
$$\xymatrix@C=5mm{? \ar[r] & R^2 \ar[rr]^{\begin{pmatrix} -y & u \\ x & -v \end{pmatrix}} && R^2 \ar[rrr]^-{\begin{array}{cc} (x & y) \end{array}} &&& R \ar[r] & (R/I \ar[r] &) 0}.$$
We now want solutions to
$$a {-y \choose x} + b {u \choose -v} = {0 \choose 0}. \hskip 20mm (\star)$$	
To solve
$a \cdot \underline{-y} + b \cdot \underline{u} = 0$, note that $x$ and $u$ are symmetric in the defining equation of $S$, so the previous claim shows that solutions of $(\star)$ are generated by ${v \choose x}$ and ${u \choose y}$. These solve the second equation too, so these must be generated by the relations
$$\xymatrix@C=5mm{? \ar[r] & R^2 \ar[rr]^{\begin{pmatrix} v & u \\ x & y \end{pmatrix}} && R^2 \ar[rr]^{\begin{pmatrix} -y & u \\ x & -v \end{pmatrix}} && R^2 \ar[rrr]^-{\begin{array}{cc} (x & y) \end{array}} &&& R \ar[r] & (R/I \ar[r] &) 0}.$$
Now, the solutions ${-y \choose x}$ and ${u \choose -v}$ to $a\underline{x}+b\underline{y} = 0$ also happen to be solutions to $a\underline{v}+b\underline{u} = 0$, so
this keeps repeating, alternating between matrices.
$$\xymatrix{\cdots \ar[r] & R^2 \ar[r]^{A} & R^2 \ar[r]^{B} \ar[r] & R^2 \ar[r]^{A} & R^2 \ar[r]^{B} & R^2 \ar[r]^{A} & R^2 \ar[r]^{B} & R^2 \ar[r]^{\begin{array}{cc} (x & y) \end{array}} & R \ar[r] & 0}.$$
$$A = \left( \begin{array}{cc} u & v \\ x & y  \end{array} \right) \textrm{ and } B = \left( \begin{array}{cc} -y & u \\ x & -v \end{array} \right).$$
\end{example}


In the second example, the failure of the cancellation properties led to a much wider resolution. We want to understand these cancellation properties.

\section{Depth and Ext}

\begin{definition}[Regular sequence]\index{regular sequence}\index{$M$-sequence}\index{weak $R$-sequence}
	Let $R$ be a ring, $M$ an $R$-module. Elements $f_1, f_2, \ldots, f_t \in R$ form an {\bf $M$-sequence} or {\bf regular sequence} on $M$ if:
	\begin{enumerate}[(1)]
		\item For each $0 < i \leqslant t$, $f_i$ is a nonzerodivisor on $M/(f_1, \ldots, f_{i-1})M$.
		\item $M \neq (f_1, \ldots, f_t)M$.
	\end{enumerate}
	A {\bf weak $R$-sequence} is only required to satisfy $(1)$.
\end{definition}

\begin{example}
	$f_1, \ldots, f_t$ is an $R$-sequence if:
	\begin{itemize}
		\item $f_1$ is a nonzerodivisor on $R$;
		\item $((f_1) : f_2) = (f_1)$
		\item $((f_1,f_2) : f_3) = (f_1,f_2)$
		
		\qquad\qquad $\vdots$
		\item $((f_1,\ldots, f_{t-1}) : f_t) = (f_1,\ldots, f_{t-1})$,
		\item and $1\notin (f_1,\dots,f_t)$.

	\end{itemize}
\end{example}


\begin{example}\index{prime sequence}
	Let $R = k[x_1, \ldots, x_t]$. Then $x_1, \ldots, x_t$ is an $R$-sequence: $R_i = R / (f_1,\ldots, f_i)$ is a domain for each $i \leqslant t$, and $\overline{x_i} \neq 0$ in $R_i$, so it is a nonzerodivisor. A sequence where each succesive quotient is a domain is called a \emph{prime sequence}.
\end{example}


\begin{example}
	In $k[x,y,z]$, $xy,xz$ is not a regular sequence:
$$y(xz) \in (xy).$$
\end{example}


\begin{example}
In $R = k[x,y,z]$, $x-1$, $xy$, $xz$ is an $R$-sequence, but $xy,xz,x-1$ is not.	
\end{example}



\begin{definition}[Depth]\index{depth}\index{grade}\index{$\depth_I(M)$}\index{$\depth(M)$}
The	{\bf depth} of a proper ideal $I$ on an $R$-module $M$ is the maximal length of an $M$-sequence consisting of elements of $I$. Another name for $\depth_I(M)$ is the \emph{grade} of $I$ on $M$.

If $(R,\m)$ is a local ring, $\depth(M) := \depth_\m (M)$.
\end{definition}


\begin{remark}
	Given an ideal $I$ and a module $M$, $\depth_I(M) = 0$ if and only if there is no nonzerodivisor on $M$ inside of $I$.
\end{remark}

Our expectation is that depth has to do with free resolutions. We will show an important relationship between depth and $\Ext$:

\begin{lemma}\label{lemma-Hom-zero}
	Let $R$ be noetherian. Let $M$ be a finitely generated $R$-module, and $I \subseteq R$ be an ideal. Then
	$$\Hom_R \left( R/I , M \right) \neq 0 \textrm{ if and only if } \depth_I(M) = 0.$$
\end{lemma}

\begin{proof}
	As a module over $R$, $R/I$ is cyclic, so any $R$-module map $\varphi: R/I \longrightarrow M$ is determined by $\varphi(\overline{1})$. On the other hand, $\overline{1}$ must go to some element of $M$ that is killed by $I$, so
	$$\Hom_R \left( R/I , M \right) \cong \ann_I(M) = (0 :_M I).$$
	So if $\Hom_R \left( R/I , M \right) \not= 0$, then there exists an element of $M$ killed by every element in $I$. In particular, no element of $I$ is a nonzerodivisor on $M$.
	
	Conversely, if $\depth_I(M) = 0$, then
	$$I \subseteq \left\lbrace \textrm{zerodivisors on M} \right\rbrace \subseteq \bigcup_{P \in \Ass(M)} P.$$
	By Prime Avoidance, there exists some $P \in \Ass(M)$ such that $P \supseteq I$. Then
	$$\xymatrix{R/I \ar@{->>}[r] & R/P \ar[r] & M}$$
	gives a nonzero map.
\end{proof}


\begin{lemma}\label{lemma ext to hom}
	Let $M$ be an $R$-module, and $\underline{x} = x_1, \ldots, x_t$ be a weak $M$ sequence contained in some ideal $I$. Then
	$$\Ext^t_R (R/I, M) \cong \Hom_R(R/I, M/\underline{x}M),$$
 and all of the lower $\Ext$'s vanish.	
\end{lemma}

\begin{proof}
By induction on $t$, with $t=0$ being trivial.
\begin{IH*} $\Ext^{j}_R (R/I, L) \cong \Hom_R(N, L/\underline{y}L)$ whenever $\underline{y}$ is a weak $L$-sequence on $L$ of length $j<t$.\end{IH*}
Let $\underline{x}'=x_2,\dots, x_{t}$, and consider the exact sequence
$$\xymatrix{0 \ar[r] & M \ar[r]^{x_1} & M \ar[r] & M/x_1 M \ar[r] & 0}.$$

This leads to a long exact sequence on $\Ext$:
{\small $$\xymatrix{\ar[r] &\Ext_R^{i-1}(R/I,M) \ar[r]^{x_1} & \Ext_R^{i-1}(R/I,M) \ar[r] & \Ext_R^{i-1}(R/I,M/x_1 M) \ar[r]  & \Ext_R^{i}(R/I,M) \ar[r]^{x_1} & \Ext_R^{i}(R/I,M) \ar[r] &}.$$}

The map $\cdot x_1$ is the map induced by multiplication by $x_1$ on $R/I$, which is the zero map. Thus there are short exact sequences
$$\xymatrix{ 0\ar[r] & \Ext_R^{i-1}(R/I,M) \ar[r] & \Ext_R^{i-1}(R/I,M/x_1 M) \ar[r]  & \Ext_R^{i}(R/I,M) \ar[r] & 0}.$$

For $i\leq t$, the induction hypothesis gives that $\Ext^{i-1}_R(R/I,M)\cong \Hom_R(R/I,M/(x_1,\dots,x_{i-1})M)$ which is zero by Lemma~\ref{lemma-Hom-zero} since $i-1<t$, so there is a regular element $x_i$. We then apply the induction hypothesis with $L=M/x_1 M$ and $\underline{y}=\underline{x}'$ to obtain $\Ext^t_R(R/I,M)\cong \Ext^{t-1}_R(R/I,M/x_1 M) \cong \Hom_R(R/I,M/(x_1,\underline{x}')M)= \Hom_R(R/I,M/\underline{x}M)$.
\end{proof}


\begin{theorem}[Rees]
	Let $R$ be a noetherian ring, $I$ an ideal in $R$, $M$ a finitely generated module such that $IM \neq M$. Then
	$$\depth_I(M) = \min \left\lbrace i \, | \, \Ext^i_R(R/I,M) \neq 0 \right\rbrace.$$
	All maximal $M$-sequences have this common length.
\end{theorem}


\begin{proof}
	Let $(f_1, \ldots, f_t)$ be a maximal $M$-sequence in $I$. Then for $j<t$, $f_1, \ldots, f_{j}$ is an $M$-sequence, and by Lemma \ref{lemma ext to hom},
	$$\Ext^{j}_R(R/I, M) \cong \Hom_R(R/I, M/(f_1, \ldots, f_{j})) = 0,$$
	since $f_{j+1}$ is a nonzerodivisor on it. 
	
	On the other hand,
	$$\Ext^{t}_R(R/I, M) \cong \Hom_R(R/I, M/(\underline{f})M) \neq 0,$$
	since the regular sequence cannot be extended.
\end{proof}

\begin{corollary}
	If $0 \to A \to B \to C \to 0$ is a short exact sequence of finitely generated modules, then $\depth_I(A) \geq \min\{\depth_I(B), \depth_I(C)+1\}.$
\end{corollary}
\begin{proof}
	Exercise. Also, state and prove similar inequalities for the depth on $B$ and $C$.
\end{proof}

\begin{proposition}
	Let $R$ be a local ring, $M$ a finitely generated $R$-module. If $\underline{x}$ is an $M$-sequence, then any permutation of $\underline{x}$ is an $M$-sequence as well.
\end{proposition}

\begin{proof}
	Since any permutation is a composition of transpositions that switch adjacent numbers, we may replace $M$ by its quotient by the start of a sequence and reduce to the case of two elements $x$, $y$. If $K = \ann_M(y) \ni z$, then $yz=0 \in xM$ implies $z \in xM$, since $y$ is regular on $M/xM$; write $z = xz'$. Now
	\begin{align*}
		yz & = 0 \\ 
		xyz' & = 0 \\
		yz' & = 0 \qquad (\textrm{ since $x$ is regular on $M$})
	\end{align*}
	Then $z' \in K = \ann_M(y)$, so that $K = xK$. By NAK, $K = 0$. Therefore, $y$ is regular on $M$.
	
All we need to show now is that $x$ is regular on $M/yM$. Given $m \in M$, if $xm \in yM$, we want to show that $m \in yM$.
$$xm = ym' \Rightarrow m' \in xM \Rightarrow m' = xm'',$$
and
$$xm'=xym'' \Rightarrow m = ym'' \Rightarrow m \in yM.$$
\end{proof}


\begin{proposition}
	Let $R$ be a local ring and $M$ a finitely generated $R$-module. If $x_1, \ldots, x_t$ is a regular sequence on $M$, then $x_1^{a_1}, \ldots, x_t^{a_t}$ is a regular sequence on $M$.
\end{proposition}

\begin{proof}
	Using the last proposition, the proof can be reduced to showing that if $x_1, \ldots, x_t$ is a regular sequence on $M$, then so is $x_1, \ldots, x_{t-1}, x_t^a$, and conversely, for any $a \geqslant 1$. In other words, it is enough to show $x$ is a regular element on $M$ if and only if $x^a$ is. This follows from the fact that
	$$x \in \bigcup_{P \in \Ass(M)} P \textrm{ if and only if } x^a \in \bigcup_{P \in \Ass(M)} P.$$
\end{proof}

\begin{corollary}
	If $R$ is a local ring, $M$ finitely generated module, and $I$ an ideal, then $\depth_I(M) = \depth_{\sqrt{I}}(M)$.
\end{corollary}

\begin{remark}
	The last two results hold without the assumption that $R$ is local.
\end{remark}

\begin{lemma}
	Let $(R,\m)$ be a local ring, $\underline{x} = x_1, \ldots, x_t \in R$. Consider the following properties:
	\begin{enumerate}[(1)]
		\item $\underline{x}$ is a regular sequence
		\item $\height(x_1, \ldots, x_i) = i$ for all $1 \leqslant i \leqslant t$
		\item $\height(x_1, \ldots, x_t) = t$
		\item $\underline{x}$ is part of a system of parameters for $R$.
	\end{enumerate}
	Then $(1) \Rightarrow (2) \Rightarrow (3) \Rightarrow (4)$. In particular, $\depth_I(R) \leqslant \height(I)$ for all ideals $I$.
\end{lemma}

\begin{proof}
	For $(1) \Rightarrow (2)$, we have
	$$0 < \height(x_1) < \height(x_1,x_2) < \cdots < \height(\underline{x}),$$
	since $x_i \notin \bigcup \Ass(x_1, \ldots, x_{i-1})$ for each $i$. The other inequalities follow from Krull's Height Theorem.
	
	$(2) \Rightarrow (3)$ is trivial.
	
%	$(3) \Rightarrow (2)$ follows from the fact that Krull's Height Theorem implies that $<$ perseveres.
	
	$(3) \Rightarrow (4)$ If $t = \dim(R)$, then $\underline{x}$ is a system of parameters. If $t<\dim(R)$, then $\m \notin \Min(( \underline{x} ))$, so there exists $x_{t+1} \in \m \setminus \cup \Min((\underline{x}))$. Continuing this way, we can find a system of parameters containing $\underline{x}$.
	
%	$(4) \Rightarrow (3)$ If $\underline{x}, \underline{y}$ is a system of parameters, then $\height(x,y) = \dim(R)$, and $\height((\underline{x})) = t$ as above.
\end{proof}


We will soon identify the class of rings where all of the statements are equivalent.

%\begin{comment}


\section{The Koszul complex and depth}

\begin{definition}\index{tensor product of complexes}\label{tensor product of complexes}
	The tensor product of two complexes of $R$-modules $C_\bullet$ and $D_\bullet$ is the complex $C_\bullet \otimes_R D_\bullet$ with
	$$\left( C_\bullet \otimes_R D_\bullet \right)_n = \bigoplus_{i+j = n} C_i \otimes_R D_j,$$
	and with differential $\delta_n$ defined on simple tensors $x \otimes y \in C_i \otimes_R D_j$ by
	$$\delta_{n} (x \otimes y)= \delta^{C_\bullet}_i(x) \otimes y + (-1)^i x \otimes \delta^{D_\bullet}_i(y).$$
	
	$$ 
	\xymatrix@R=6mm@C=4mm{
		&&& \vdots \ar[dd] && \vdots \ar[dd] && \\ 
		&&&&&&&&&&&&&\\
		& C_{i+1} \otimes D_{j+1} \ar[rr]^-{1 \otimes  \delta^{D_\bullet}_{j+1}} && C_{i+1} \otimes D_j \ar[rr]^-{1 \otimes  \delta^{D_\bullet}_{j}} \ar[dd]^-{\delta^{C_\bullet}_{i+1} \otimes 1} && C_{i+1} \otimes D_{j-1} \ar[rr]^-{1 \otimes  \delta^{D_\bullet}_{j-1}} \ar[dd]^-{\delta^{C_\bullet}_{i+1} \otimes 1} && C_{i+1} \otimes D_{j-2} &&&&&&  \\ 
		&&&&&&&&& \\
		& C_i \otimes D_{j+1} \ar[rr]_-{1 \otimes  \delta^{D_\bullet}_{j+1}} && C_{i} \otimes D_j \ar[rr]_-{1 \otimes  \delta^{D_\bullet}_{j}} \ar[dd]_-{\delta^{C_\bullet}_{i} \otimes 1} && C_{i} \otimes D_{j-1} \ar[rr]_-{1 \otimes  \delta^{D_\bullet}_{j-1}} \ar[dd]^-{\delta^{C_\bullet}_{i} \otimes 1} && C_{i} \otimes D_{j-2} &&&&& \\ 
		\textrm{\tiny{n+1}} \ar@{..}@[blue][uuuuurrrrr] &&&&&&& \\
		& \textrm{\tiny{n}} \ar@{..}@[blue][uuuuurrrrr] && C_{i-1} \otimes_R D_j \ar[dd]^-{\delta^{C_\bullet}_{i-1} \otimes 1} \ar[rr] ^-{1 \otimes \delta^{D_\bullet}_j} && C_{i-1} \otimes_R D_{j-1} \ar[dd]^-{\delta^{C_\bullet}_{i-1} \otimes 1} \ar[rr] ^-{1 \otimes \delta^{D_\bullet}_{j-1}} && C_{i-1} \otimes_R D_{j-1} && \\
		&& \textrm{\tiny{n-1}} \ar@{..}@[blue][uuuuururrrrr] &&&&&&& \\
		&&  & \vdots && \vdots&&&
	}
	$$
\end{definition}

\begin{definition}[Koszul complex]\index{Koszul complex}\index{$K_\bullet(f_1, \ldots, f_n)$}
	The {\bf Koszul complex} on a sequence of elements $f_1, \ldots, f_n$ is defined inductively as
	$$K_{\bullet}(f_1) = \xymatrix@R=0.5mm{0 \ar[r] & R \ar[r]^-{f_1} & R \ar[r] & 0 \\ & \textrm{\tiny{1}} & \textrm{\tiny{0}}}$$
	$$K_{\bullet} (f_1, \ldots, f_n) = K_{\bullet} (f_1, \ldots, f_{n-1}) \otimes K_{\bullet}(f_n).$$
\end{definition}


\begin{example}
	$$ 
	\xymatrix@R=2mm@C=2mm{
	&&&&&& 0 \ar[dd] && 0 \ar[dd] && \\ 
	&&&&&&&&&&&&&\\
	&&&& 0 \ar[rr] && R \ar[rr]^-{-g} \ar[dd]_-{f} && R \ar[rr] \ar[dd]^-{f} && 0 &&&&&&  \\ 
	K_{\bullet}(f,g) & = &&&&&&&&&&& = && 0 \ar[rr] && R \ar[rrr]^{{-g \choose f}} &&& R^2 \ar[rrr]^{(f \quad g)} &&& R \ar[rr] && 0 && \\
	&&&& 0 \ar[rr] && R \ar[rr]_-{g} \ar[dd] && R \ar[rr] \ar[dd] && 0 &&&&& \\ 
	&&& \textrm{\tiny{2}} \ar@{..}@[blue][uuuuurrrrr] &&&&&&& \\
	&&&& \textrm{\tiny{1}} \ar@{..}@[blue][uuuuurrrrr] && 0 && 0 &&&& \\
	&&&&& \textrm{\tiny{0}} \ar@{..}@[blue][uuuuururrrrr] &&&&&&
	 }  
	$$
	
	
	%K_{\bullet}(f,g) = \xymatrix@R=5mm{
%	&& 0 \ar[d] & 0 \ar[d] & \\
%	& 0 \ar[r] & R \ar[r]^-{-g} \ar[d]_-{f} & R \ar[r] \ar[d]^-{f} & 0 \\
%	& 0 \ar[r] & R \ar[r]_-{g} \ar[d] & R \ar[r] \ar[d] & 0 \\
%	\textrm{\tiny{2}} \ar@{..}@[blue][uuurrr] & & R & R \\ 
%	\textrm{\tiny{1}} \ar@{..}@[blue][uuuurrrr] & \textrm{\tiny{0}} \ar@{..}@[blue][uuurrr]}
%\xymatrix@C=10mm{ \\ = & 0 \ar[r] & R \ar[r]^{{-g \choose f}} & R^2 \ar[r]^{(f \quad g)} & R \ar[r] & 0}
\end{example}


\begin{example}
	$$K_\bullet(f,g,h) \quad = \quad \xymatrix{0 \ar[r] & R \ar[r]^{\begin{pmatrix} -g \\ f \\ h \end{pmatrix}} & R^3 \ar[rrr]^{\begin{pmatrix} -h & 0 & -g \\ 0 & -h & -f \\ f & g & 0 \end{pmatrix}} &&& R^3 \ar[rr]^-{\begin{pmatrix} f & g & h \end{pmatrix}} && R \ar[r] & 0}.$$
\end{example}

\

\begin{remark} Easy induction arguments show that when $\underline{f} = f_1, \ldots, f_n$:
\begin{itemize}
	\item $K_i(\underline{f}) \cong R^{{n \choose i}}$, with a basis naturally indexed by the subsets of $I\subseteq [n]$ of cardinality $i$; write $R e_I$ for the corresponding free summand.
	\item The component of the map $K_i(\underline{f})\to K_{i-1}(\underline{f})$ from $R e_I \to R e_J$ is zero if $J \not\subset I$, and is $\pm f_i$ if $I=J\cup \{i\}$.

	\item The last map is $\xymatrix@C=24mm{R^n \ar[r]^{\begin{pmatrix} f_1 & \cdots & f_n \end{pmatrix}} & R}$, and
	\item The first map is $\xymatrix@C=24mm{R \ar[r]^{\begin{pmatrix} \pm f_1 \\ \vdots \\ \pm f_n \end{pmatrix}} & R^n}$.
\end{itemize}
\end{remark}


\begin{definition}\index{Koszul complex of a module}\index{$K_\bullet(f_1, \ldots, f_n; M)$}\index{$K^\bullet(f_1, \ldots, f_n; M)$}
If $M$ is an $R$-module and $\underline{f} = f_1, \ldots, f_n$, then
\begin{align*}
K_\bullet(\underline{f};M) := & K_\bullet(\underline{f}) \otimes M \\ 
K^\bullet(\underline{f};M) := & \Hom_R( K_\bullet(\underline{f}), M)
\end{align*}
\end{definition}


Another easy induction shows that $K_\bullet(\underline{f};M) \cong K^{n-\bullet}(\underline{f};M)$.


\begin{definition}[Koszul (co)homology]\index{Koszul homology}\index{Koszul cohomology}\index{$\H_i(\underline{f};M)$}$\,$

	The Koszul homology of $\underline{f}$ on $M$ is $\H_i(\underline{f};M)  := \H_i(K_\bullet(f_1, \ldots, f_n; M))$.
	
	The Koszul cohomology of $\underline{f}$ on $M$ is $\H^i(\underline{f};M):=\H^i(K^\bullet(\underline{f}; M))$.
\end{definition}


By the previous note, $\H_i(\underline{f};M) \cong \H^{n-i}(\underline{f};M)$.


\begin{observation}$\,$
\begin{itemize}
	\item $\H_0(\underline{f}; M) \cong \H^n(\underline{f};M)$ is the homology of $\xymatrix@C=8mm{M^n \ar[rrr]^{\begin{pmatrix} f_1 & \cdots & f_n \end{pmatrix}} &&& M \ar[r] & 0}$, which is $M/(\underline{f})M$.
	\item $\H_n(\underline{f}; M) \cong \H^0(\underline{f};M)$ is the homology of $\xymatrix@C=6mm{M \ar[rr]^{\begin{pmatrix} \pm f_1 \\ \vdots \\ \pm f_n \end{pmatrix}} && M^n \ar[r] & 0}$, which is $\ann_M((\underline{f}))$.
\end{itemize}	
\end{observation}


\begin{example}
	In $R = k[x,y]$,
	$$\H_1(x,y;R) = \textrm{ homology of } \xymatrix{R \ar[r]^{\begin{pmatrix} -y \\ x \end{pmatrix}} & R^2 \ar[r]^{\begin{pmatrix} x \\ y \end{pmatrix}} &R} = 0.$$
\end{example}


\begin{example}
	In $R = k[x,y,u,v]/(xu-yv)$,
	$$\H_1(x,y;R) = \frac{\left\langle {-y \choose x}, {u \choose -v} \right\rangle}{\left\langle {-y \choose x} \right\rangle}.$$
	Note that
	$$x {u \choose -v} = {xu \choose -xv} = {yv \choose -xv} = -v {-y \choose x} = 0 \textrm{ in } \H_1(x,y;R).$$
\end{example}


\begin{observation}
	If $C_\bullet$ is a complex, there exists a short exact sequence of complexes
	$$\xymatrix{0 \ar[r]&  C_\bullet \ar[r] & C_\bullet \otimes K_\bullet(f) \ar[r] & C_\bullet(-1) \ar[r] & 0 \\ 
	0 \ar[r] &  C_n \ar[r]^-{\begin{pmatrix} 1 \\ 0 \end{pmatrix}} & C_n \oplus C'_{n-1} \ar[rr]^-{\begin{pmatrix} 0 & (-1)^{n-1} \end{pmatrix}} && C'_{n-1} \ar[r] & 0},$$
where $C'_i\cong C_i$, and the ' indicates that this is the copy tensored with $K_1(f)$. Indeed, these are clearly exact, and we only need to check that these give maps of complexes; i.e., that the maps above commute with the differentials. An element $\nu\in C_n$ maps to $(\nu,0)$ in $C_n \oplus C'_{n-1}$, which maps to $(\delta(\nu),0)$ by the differential on $C_\bullet \otimes K_\bullet(f)$, so the map $C_\bullet \to C_\bullet \otimes K_\bullet(f)$ is a map of complexes. Likewise, an element $(\nu,\mu)$ in $C_n \oplus C'_{n-1}$ maps to an element with second component $\delta(\mu)$ by the differential on $C_\bullet \otimes K_\bullet(f)$, so the map $C_\bullet \otimes K_\bullet(f) \to C_\bullet(-1)$ is a map of complexes as well.


	The long exact sequence in homology gives
	$$\xymatrix@R=5mm{\cdots \ar[r] &  \H_n(C_\bullet) \ar[r] & \H_n(C_\bullet \otimes K_\bullet(f)) \ar[r] & \H_{n}(C'_\bullet(-1)) \ar@{}[d]|*=0[@]{\cong} \ar[r]^-\delta & \cdots \\\ &&& \H_{n-1}(C_\bullet)}.$$
	
	We claim that the connecting homomorphism agrees with multiplication by $f$. Indeed, for $[\eta]\in H_i(C'_\bullet)$, one has that $(0,[\eta])\in H_i(C_\bullet \otimes K_\bullet(f))\mapsto [\eta]\in H_i(C'_\bullet)$. Applying the differential yields $([f\eta],[\delta(g)])=([f\eta],0)\in H_{i-1}(C_\bullet \otimes K_\bullet(f))$, and $[f \eta]\in H_{i-1}(C_\bullet)\mapsto ([f\eta],0)\in H_{i-1}(C_\bullet \otimes K_\bullet(f))$.
	
	Thus, the long exact sequence breaks into short exact sequences
	$$\xymatrix@R=5mm{0 \ar[r] &  \frac{\H_n(C_\bullet)}{f\H_n(C_\bullet)} \ar[r] & \H_n(C_\bullet \otimes K_\bullet(f)) \ar[r] & \ann_{\H_{n-1}(C_\bullet)}(f) \ar[r] & 0}.$$
	In particular, if $\underline{x}, y$ is a sequence of elements of $R$, and $M$ is an $R$-module,
	$$\xymatrix@R=5mm{0 \ar[r] &  \frac{\H_n(\underline{x};M)}{y\H_n(\underline{x};M)} \ar[r] & \H_n(\underline{x},y;M) \ar[r] & \ann_{\H_{n-1}(\underline{x})}(y) \ar[r] & 0}$$
\end{observation}


\begin{theorem}
	If $\underline{f} = f_1, \ldots, f_t$ is a regular sequence on $M$, then $\H_i(\underline{f};M) = 0$ for $i > 0$. If $R$ is a local ring and $M$ is a finitely generated $R$-module, then the converse holds.
\end{theorem}


\begin{proof}
	For $t=1$, the Koszul complex is
	$$\xymatrix{0 \ar[r] & M \ar[r]^-f \ar[r] & M \ar[r] & 0},$$
	which is exact at $i >0$ if and only if $f$ is a nonzerodivisor on $M$.
	
	Now to show the first statement when $t>1$, we will use induction:
	\begin{IH*}
	$\H_i(f_1, \ldots, f_{t-1};M) = 0 $ for all $i>0$ and all regular sequences 	$\underline{f}'=f_1, \ldots, f_{t-1}$.
	\end{IH*}

Assume that $\underline{f} = f_1, \ldots, f_{t}$ is a regular sequence. From
$$\xymatrix@R=1mm{0 \ar[r] &  \frac{\H_i(\underline{f}';M)}{f_t\H_i( \underline{f}';M)} \ar[r] & \H_i(\underline{f};M) \ar[r] & \ann_{\H_{i-1}(\underline{f}')}(f_t) \ar[r] & 0 \\ & 0 \ar@{=}[u] & & 0 \ar@{=}[u]}$$
we get $\H_i(\underline{f};M)=0$ for $i>1$.

When $i=1$, since $f_t$ is a nonzerodivisor on $M/(\underline{f}')M \cong \H_0(\underline{f}';M)$, we get
	$$\xymatrix@R=1mm{0 \ar[r] &  \frac{\H_1(\underline{f}';M)}{f_t\H_1( \underline{f}';M)} \ar[r] & \H_1(\underline{f};M) \ar[r] & \ann_{\H_{0}(\underline{f}')}(f_t) \ar[r] & 0 \\
	& 0 \ar@{=}[u] & & 0 \ar@{=}[u]},$$
	so $\H_1( \underline{f}'; M) = 0$.
	
	To prove the second statement, we again use induction, noting that we have already shown the base case. For the short exact sequences above, we get
	$$\frac{\H_i(\underline{f}';M)}{f_t \H_i(\underline{f}';M)} = 0$$
	for $i>0$. The koszul homology modules are finitely generated, so NAK applies. Then $\H_i(\underline{f}';M) = 0$ for all $i>0$. By induction hypothesis, this implies that $\underline{f}'$ is a regular sequence on $M$. Finally, from the short exact sequences, we know that
	$$\ann_{\H_0(\underline{f}';M)}(f_t) = 0,$$
	so $f_t$ is a regular element on $M/(\underline{f}')M$, and $\underline{f}$ is a regular sequence on $M$.
\end{proof}


\begin{corollary}
	 Let $R$ be a local ring, $M$ an $R$-module, and $\underline{f}$ a sequence of elements of $R$. The complex $K_\bullet(\underline{f};R)$ is a free resolution of $R/(\underline{f})$ if and only if $\underline{f}$ is a regular sequence. In this case, Koszul homology agrees with Tor: $\Tor_i^R(R/(\underline{f}),M)\cong H_i(\underline{f};M)$, and Koszul cohomology agrees with Ext: $\Ext^i_R(R/(\underline{f}),M)\cong H^i(\underline{f};M)$.
\end{corollary}

\begin{remark}
	If $\phi:R\to S$ is a ring homomorphism, $\underline{f}$ a sequence of elements of $R$, and $M$ is an $S$-module, then $K_{\bullet}(\underline{f};\, _{\phi} \!M) \cong K_{\bullet}(\underline{\phi(f)}; M)$, where $\underline{\phi(f)}$ is the sequence of images of the $f$'s under $\phi$, and $_{\phi} \! M$ is the $R$-module structure on $M$ given by restriction of scalars. In particular, 
	\[ H^{i}(\underline{f};\, _{\phi} \!M) \cong  {}_\phi\big( H^{i}(\underline{\phi(f)}; M) \big). \] 
\end{remark}

\section{Worksheet on Cohen-Macaulay rings, and a bit more Koszul homology}

	\begin{enumerate}[1)]
	\item  Let $R$ be a ring, $f_1, \ldots, f_t \in R$, and $M$ be an $R$-module. Let $S = R[x_1, \ldots, x_t]$. Then $R$ has two different $S$-module structures, given by $\varphi\!: S \longrightarrow R$ and $\psi\!: S \longrightarrow R$, where
	$$\varphi(x_i) = 0 \textrm{ for all } i \textrm{ and } \varphi|_R = \id_R,$$
	and
	$$\psi(x_i) = f_i \textrm{ for all } i \textrm{ and } \psi|_R = \id_R.$$
	
	\
	
	\begin{enumerate}[a)]
		
		\item Show that $\underline{x}$ is a regular sequence on $S$, and conclude that $K_\bullet(\underline{x})$ is a free resolution of $_\varphi R$ over $S$.
		
		
		
		\item Prove that $\H_i(\underline{f};M) \cong \Tor_i^S({}_{\varphi}R,{}_{\psi} M).$
		
		
		
		\item Use $b)$ to show that $(\underline{f})$ annihilates each $\H_i(\underline{f};M)$.
		
		
		
		\item If $x$ is a nonzerodivisor on $M$, there is a short exact sequence of complexes 
		$$\xymatrix{0 \ar[r] & K_\bullet(\underline{f};M) \ar[r]^{\cdot x} & K_\bullet(\underline{f};M) \ar[r] & K_\bullet(\underline{f};M/xM) \ar[r] & 0}.$$
		
		
		
		
		\item Show that, if $R$ is noetherian and $M$ finitely generated, $\depth_{(\underline{f})} (M) = \min \left\lbrace i \, | \, \H^i(\underline{f};M) \neq 0 \right\rbrace$.
	\end{enumerate}
	
	
\end{enumerate}

\begin{definition}[Cohen-Macaulay local ring]\index{Cohen-Macaulay}
A local ring $(R,\m,k)$ is {\bf Cohen-Macaulay} if $\depth R = \dim R$. That is, $R$ is Cohen-Macaulay if there exists a regular sequence of length $\dim(R)$ in $\m$.
\end{definition}

\begin{enumerate}\setcounter{enumi}{1}
	\item \begin{enumerate}
		\item Show that if $f_1,\dots,f_t$ is a regular sequence, then $\height(f_1,\dots,f_t)=t$. Thus, $(R,\m)$ is Cohen-Macaulay if and only if there exists a system of parameters that is a regular sequence.
		\item Give a one line argument that if $M$ is finitely generated and $R$ is local, and $f_1,\dots,f_t$  is an $M$-sequence, then $f_{\sigma(1)},\dots,f_{\sigma(t)}$ is a regular sequence for any permutation $\sigma\in S_t$.
		\item Give a one line argument to show that if $M$ is finitely generated and $R$ is local, and $f_1,\dots,f_t$  is an $M$-sequence, then $f_1^{a_1},\dots,f_t^{a_t}$ for any $a_i>0$. Conclude that $\depth_I(M)=\depth_{\sqrt{I}}(M)$ for all $I$.
		\item Use the previous part and the conclusion of 1(e) to show that if $(R,\m)$ is Cohen-Macaulay, then every system of parameters for $R$ is a regular sequence.
	\end{enumerate}
	
	
	\
	
	\item 
	\begin{enumerate}[a)]
		\item If $R=k[\underline{x}]$ is a polynomial ring over a field $k$ and $\m = (\underline{x})$, then $R_\m$ is Cohen-Macaulay.
		
		
		
		\item If $R$ is Cohen-Macaulay and $\underline{f}$ is a regular sequence on $R$, then $R/(\underline{f})$ is Cohen-Macaulay.
		
		
		
		\item Show that $R = \left( \frac{k[x,y]}{(x^2,xy)} \right)_{(x,y)}$ and $S = k[x^4,x^3y,xy^3,y^4]_{(x^4,x^3y,xy^3,y^4)} \subseteq k[x,y]_{(x,y)}$ are not Cohen-Macaulay rings.\footnote{Hint: $x^4 \cdot (xy^3)^2 = (x^3y)^2 \cdot y^4 \in (y^4).$}
	\end{enumerate} 
	
	\
	
	
	\item Recall that if $\p$ is a prime of height $i$ in a local ring $R$, there exist $f_1, \ldots, f_i \in \p$ and $g_{i+1}, \ldots, g_d \in R$ such that $\underline{f}, \underline{g}$ is a system of parameters for $R$. In particular, the images of $\underline{f}$ form a system of parameters for $R_{\p}$.
	
	\
	
	\begin{enumerate}[a)]
		\item Prove that $\depth_{\p}(R) = \height \p$ if $R$ is Cohen-Macaulay.
		
		
		
		\item Prove that if $R$ is Cohen-Macaulay, then $R_{\p}$ is Cohen-Macaulay for $\p \in \Spec(R)$.
		
		
	\end{enumerate} 
	
	
\end{enumerate}

\begin{definition}[Cohen-Macaulay ring]\index{Cohen-Macaulay}	A (not necessarily local) ring $R$ is Cohen-Macaulay if the following equivalent conditions hold:
\end{definition}
\begin{itemize}
	\item $R_\m$ is Cohen-Macaulay for all maximal ideals $\m$.
	\item $R_\p$ is Cohen-Macaulay for all prime ideals $\p$.
\end{itemize}

\

\begin{enumerate}\setcounter{enumi}{4}		
	
	
	
	
	\item Assume for now the following:
	
	\
	
	{\sc Lemma:} If $R$ is local, $\depth(R) \leq \dim(R/\p)$ for all $\p\in \Ass(R)$.
	
	\
	
	\begin{enumerate}
		\item Prove that if $R$ is local and Cohen-Macaulay, then $\dim(R)=\dim(R/\p)$ for all $\p\in \Ass(R)$.
		\item Show that if $R$ is Cohen-Macaulay, $R$ has no embedded primes.
		\item Prove that if $R$ is Cohen-Macaulay and $\underline{f} = f_1, \ldots, f_t$ is a regular sequence, then every associated prime of $(\underline{f})$ has height $t$. In particular, the ideal $(\underline{f})$ has no embedded primes.
		\item Prove the lemma above\footnote{One approach is to prove first that $\Ext^i_R(N,M)=0$ for $M,N$ finitely generated, $R$ local, and $i<\depth(M)-\dim(N)$ by induction on $\dim(N)$. To deal with the base and induction cases, filter $N$ by prime cyclic modules.}, or look it up in Bruns \& Herzog or Matsumura.
	\end{enumerate}
	
	\
	
	\item Show that 
	$$R = \frac{k\begin{bmatrix} u & v & w \\ x & y & z\end{bmatrix}}{(uy-vx,uz-wx,vz-wy)}$$ is Cohen-Macaulay, and that
	$$S = k\begin{bmatrix} ar & as & at \\ br & bs & bt \end{bmatrix} \subseteq \displaystyle\frac{ k[a,b,r,s,t] }{\, (r^3+s^r+t^3) \,}$$
	is not Cohen-Macaulay.
	
	\
	
	\item To what extent does $H^i(\underline{f})$ depend on the sequence of elements $\underline{f}$ rather than the ideal $I=(\underline{f})$ they generate?\footnote{It's actually not that much! Try to see what you get if you throw in one redundant element for starters.}
\end{enumerate}

\section{Auslander, Buchsbaum, and Serre}


\begin{definition}[Minimal free resolution]\index{minimal free resolution}
	A {\bf minimal free resolution} of a finitely generated module $M$ over a local ring $(R, \m, k)$ is a free resolution $F_\bullet \longrightarrow M$ such that the image of each $\xymatrix{F_i \ar[r]^-{\delta_i} & F_{i-1}}$ is contained in $\m F_{i-1}$. Equivalently, if we fix bases for each $F_i$ and write the maps $\delta_i$ in terms of matrices, every entry of such a matrix is in $\m$.
\end{definition}


Minimal free resolutions exist.

\begin{lemma}
	Every finitely generated $R$-module over a local ring $(R, \m, k)$ has a minimal free resolution.
\end{lemma}

\begin{proof}
	Take a basis $\left\lbrace m_i \right\rbrace_{i = 1}^n$ for $M/ \m M$ and map $F_0 = \bigoplus_{i=1}^n R e_i$ onto $M$ by $\xymatrix{e_i \ar@{|->}[r] & m_i}$. The kernel $K$ of this map lies in $\m F_0$.
	$$\xymatrix@C=5mm{F_1 \ar[rd] \ar[rr] && F_0 (\ar[r] & M ) \ar[r] & 0 \\ & K \ar[ru]}$$
	Repeat.
\end{proof}


Moreover, the ranks of the $F_i$ in a minimal free resolution of $M$ are well-defined:

$$\xymatrix{\cdots \ar[r] & F_2 \ar[r]^-{\alpha_2} & F_1 \ar[r]^-{\alpha_1} & F_0 (\ar[r] & M) \ar[r] & 0}$$

Since $\alpha_i \otimes k = 0$, then
$$\Tor^R_i(M,k) = \H_i \left( \xymatrix{\cdots \ar[r] & F_2 \otimes k \ar[r]^-{0} & F_1 \otimes k \ar[r]^-{0} & F_0 \otimes k \ar[r] & 0} \right) = k^{\beta_i},$$
where $\beta_i = \dim_k (F_i)$. These numbers $\beta_i$ are called the {\bf betti numbers} \index{betti numbers} of $M$.


If $P_\bullet$ is any projective resolution of $M$, the length of $P_\bullet$ is $\geqslant \max \left\lbrace i \, | \, \beta_i(M) \neq 0 \right\rbrace$. Otherwise, $\H_i(P_\bullet \otimes k) = \Tor^R_i(M,k)$ would vanish. The length of a minimal projective resolution of $M$, or $\max \left\lbrace i \, | \, \beta_i(M) \neq 0 \right\rbrace$, is called the {\bf projective dimension} \index{projective dimension} of $M$, and denoted $\pd_R(M)$.

It turns out that \emph{the} minimal resolution of $M$ is a direct summand of any projective resolution of $M$, but we will not need that.


\begin{remark}
	For any finitely generated module $M$ over a local ring $(R,\m,k)$, $\pd M \leqslant \pd k$, since we can compute $\beta_i(M) = \Tor_i(M,k)$ from a minimal projective resolution of $k$.
\end{remark}



\begin{lemma}[Depth Lemma]\label{depth lemma}\index{depth lemma}
Let $R$ be a noetherian local ring. Consider a short exact sequence of finitely generated $R$-modules:
 $$\xymatrix{0 \ar[r] & A \ar[r] & B \ar[r] & C \ar[r] & 0}.$$
 Then:
 \begin{enumerate}[1)]
 \item $\depth(A) \geqslant \min \left\lbrace \depth(B), \depth(C) + 1 \right\rbrace$.
 \item $\depth(B) \geqslant \min \left\lbrace \depth(A), \depth(C) \right\rbrace$.
 \item $\depth(C) \geqslant \min \left\lbrace \depth(A) - 1, \depth(B) \right\rbrace$.
 \end{enumerate}
 \end{lemma}


\begin{theorem}[Auslander--Buchsbaum formula]\label{Auslander-Buchsbaum}\index{Auslander--Buchsbaum formula}
	Let $(R, \m, k)$ be a local ring, and $M$ a finitely generated module with $\pd(M)< \infty$. Then
	$$\pd_R(M) + \depth (M) = \depth(R).$$
\end{theorem}

\begin{proof}
	By induction of $\pd_R(M)$.
	
	If $\pd_R(M) = 0$, then $M$ is free, so $\depth(M) = \depth(R)$. If $\pd_R(M) = 1$, then a minimal free resolution of $M$ looks like
	$$\xymatrix{0 \ar[r] & R^s \ar[r]^-{\alpha} & R^t \ar[r] & M \ar[r] & 0}.$$
	Then the corresponding long exact sequence on $\Ext^\bullet_R(k,-)$ looks like
		$$\xymatrix@C=15mm{\cdots \ar[r] & \Ext^i_R(k,R^s) \ar[r]^-{\Ext^i_R(k,\alpha)} & \Ext^i_R(k,R^t) \ar[r] & \Ext^i_R(k,M) \ar[r] & \cdots}.$$
	\begin{claim*}
		$\Ext^i_R(k,\alpha) = 0$.
	\end{claim*}
	
	To see that, notice that given an injective resolution of $R$, say
	$$\xymatrix@R=0.01mm{0 \ar[r] & R \ar[r] & \cdots \ar[r] & Q \ar[r] & \cdots \\ &&& i & },$$
	then
	$$\xymatrix@R=0.05mm{0 \ar[r] & R^s \ar[r] & \cdots \ar[r] & \oplus_s Q \ar[r] & \cdots}$$
	and
	$$\xymatrix@R=0.05mm{0 \ar[r] & R^t \ar[r] & \cdots \ar[r] & \oplus_t Q \ar[r] & \cdots}$$
	are injective resolutions of $R^s$ and $R^t$, respectively. Then
	$$\xymatrix{\Ext^i_R(k, \alpha) = \Hom_R \left( k, Q^s \right) \ar[r]^-\alpha & \Hom_R \left( k, Q^t \right)} = 0,$$
	since $\alpha$ has entries in $\m$.
	
	Then we get short exact sequences
	$$\xymatrix{0 \ar[r] & \Ext^i_R(k,R)^t \ar[r] & \Ext^i_R(k,M) \ar[r] & \Ext^{i+1}_R(k,R)^s \ar[r] & 0},$$
	From which $\depth M = \depth R - 1$.
	
	For $\pd(M) \geqslant 2$, there is a short exact sequence
	$$\xymatrix{0 \ar[r] & M' \ar[r] & R^n \ar[r] & M \ar[r] & 0}.$$
	Using the Depth Lemma (\ref{depth lemma}), we finish by showing that $\depth(M') = \depth(M) + 1$.
\end{proof}


\begin{definition}[Regular local ring]\index{regular local ring}
	A local ring $(R, \m, k)$ is {\bf regular} if $\dim R = \dim_k \m / \m^2$.
	
	In other words, a minimal generating set for for $\m$ forms a system of parameters for $R$.
\end{definition}

Geometrically, regular local rings correspond to smooth points: if $(R,\m,k)$ is the local ring of a point on a variety, the vector space $\m/\m^2$ corresponds to the dual of the tangent space at that point. Regularity is the condition that the tangent space has the same dimension as the variety.

\begin{example}
	If $R=K[\underline{x}]_{(\underline{x})}$ for a field $K$, then $R$ is regular.
\end{example}

\begin{example}
	$$R = \frac{k\begin{bmatrix} u & v & w \\ x & y & z\end{bmatrix}}{(uy-vx,uz-wx,vz-wy)} \qquad \m = \frac{(u,v,w,x,y,z)}{(uy-vx,uz-wx,vz-wy)}$$
	The local ring $R_\m$ is {\bf not} a regular ring, since $u, v, w, x, y, z$ are linearly independent in $\m/\m^2$.
	
	However, $R_{\mathfrak{n}}$ {\bf is} regular for
	$$\mathfrak{n} = \frac{(u-1,v,w,x,y,z)}{{(uy-vx,uz-wx,vz-wy)}}.$$
	In fact, $y \in (vx)$, $z \in (wx)$, so $\mathfrak{n} R_{\mathfrak{n}} = (u-1, v, w, x)$.
	
	Finally, for the prime ideal $\mathfrak{p} = (v,w,x,y,z)$, $R_{\mathfrak{p}}$ is regular with $\mathfrak{p} R_{\mathfrak{p}} = (v,w,x)$.
\end{example}


\begin{lemma}
	A regular local ring is a domain.
\end{lemma}

\begin{proof}
	By induction on $d = \dim R$, where $R$ is a regular local ring. If $d=0$, then $R$ must be a field, and thus a domain.
	
	If $d>0$, consider $x \in \m \setminus \left( \m^2 \cup \bigcup_{\mathfrak{p} \in \Min R} \mathfrak{p} \right)$. (Here we are using the strong version of prime avoidance where we can avoid one arbitrary ideal and a finite number of prime ideals.) By NAK, $\m/xR$ is generated by $d-1$ elements, so that $\dim R/xR \leqslant d-1$ by Krull's Height Theorem. Then $\dim R/xR = d-1$. By Induction Hypothesis, $R/xR$ is a domain, and thus $xR$ is a prime ideal in $R$, which is not minimal. Given a prime ideal $0 \subseteq \mathfrak{p} \subseteq xR$, if $y \in \mathfrak{p}$, we can write $y =ax$ for some $a \in R$, and if $x \notin \mathfrak{p}$, then $a \in \mathfrak{p}$. Thus $x \mathfrak{p} = \mathfrak{p}$, which by NAK implies that $\mathfrak{p} = 0$. Thus $R$ is a domain.
\end{proof}


\begin{proposition}\label{regular mod x}
Let $(R, \m)$ be a local ring.
\begin{enumerate}[1)]
	\item If $(R, \m)$ is a regular local ring, $x \in \m \setminus \m^2$, then $R/xR$ is a regular ring.
	\item If $R/xR$ is a regular ring for some $x$ that is a nonzerodivisor on $R$, then $R$ is a regular ring.
	\item Every regular local ring is Cohen-Macaulay.
\end{enumerate}
\end{proposition}


\begin{proof}$\,$
	\begin{enumerate}[1)]
		\item If $R$ has dimension $d$, then $\m_{R/xR}$ is generated by $d-1$ elements and $\dim R/xR = d-1$.
		\item Since $x$ is not in any minimal prime of $R$, $\dim R = \dim R/xR + 1$. Given $x_1, \ldots, x_{d-1} \in R$ such that $\m_{R/xR} = \left( \overline{x_1}, \ldots, \overline{x_{d-1}} \right)$, $\m = \left(  x_1, \ldots, x_{d-1}, x \right)$. Since $\m$ has height $d$, it must be generated by at least $d$ elements, and thus it is generated by exactly $d$ elements, and $R$ is regular.
		\item Every minimal generating set for $\m / \m^2$ forms a prime sequence.
	\end{enumerate}
\end{proof}




\begin{lemma}\label{pd mod nzd}
	Let $(R, \m)$ be a local ring, $M$ a finitely generated $R$-module, and $x \in \m$ a nonzerodivisor on $R$ and on $\m$. Then
	$$\pd_{R/xR} M/xM = \pd_R M.$$
\end{lemma}

\begin{proof}
	We will show that $R/xR \otimes_R F_\bullet$ is exact whenever $F_\bullet \longrightarrow M$ is a minimal free resolution of $M$. Therefore, $R/xR \otimes_R F_\bullet$ must be a resolution of $M/xM$. Indeed, the homology of $F_\bullet \longrightarrow M$ is
	$$\Tor_\bullet^R(R/xR, M) = \H_\bullet \left( \xymatrix{0 \ar[r] & M \ar[r]^-x & M \ar[r] & 0} \right),$$
	which vanishes in all positive degrees, and which is $M/xM$ in degree $0$.
	
	Moreover, if $F_\bullet$ is a minimal resolution then so is $R/xR \otimes_R F_\bullet$, since elements in $\m$ are sent into $\m_{R/xR}$ by $-\otimes R/xR$.
\end{proof}

\begin{theorem}[Auslander-Buchsbaum-Serre]\label{Auslander-Buchsbaum-Serre}
Let $(R,\m,k)$ be a local ring. The following are equivalent:
	\begin{enumerate}[1)]
		\item $R$ is regular.
		\item $\pd_R(M) < \infty$ for all finitely generated $R$-modules $M$.
		\item $\pd_R(k) < \infty$
	\end{enumerate}
\end{theorem}

\begin{proof}
	Clearly, $2) \Rightarrow 3)$, and $1) \Rightarrow 2)$ follows once we show that $1)$ implies $\pd k < \infty$, since $\pd M \leqslant \pd k$ for all finitely generated $R$-modules $M$. Indeed, the minimal generators of $\m$ form a prime sequence, hence a regular sequence, and thus the Koszul complex on a minimal set of generators for $\m$ gives a finite projective resolution for $k$.
	
	To show $3) \Rightarrow 1)$, we proceed by induction on $t = \dim_k \m / \m^2$.
	
	If $t=0$, then $R$ is a field, and thus regular.
	
	If $t>0$, note that if $\depth(R) = 0$, then applying Auslander-Buchsbaum to $\pd (R)< \infty$ gives $\pd k = 0$, so $k$ is free and $R$ must be a field, and thus regular. If we assume that $\depth R > 0$, then $\m \notin \Ass(R)$, so there exists some $x \in \m \setminus \m^2 \cup \Ass (R)$. Consider $\overline{R} = R/xR$. It suffices to show that
	$$\pd_{\overline{R}} (\overline{\m}/\overline{\m}^2),$$
	since that implies $\overline{R}$ is regular by induction hypothesis, and thus $R$ must be regular by Lemma~\ref{regular mod x}.
	
	By Lemma~\ref{pd mod nzd}, we know that $\pd_{\overline{R}}(\m/x\m)<\infty$. We claim that the short exact sequence of $\overline{R}$-modules
	\[ 0 \to xR/x\m \to \m/x\m \to \overline{\m} \to 0\]
	splits. Indeed, the image of $xR/x\m \to \m / x\m \to \m/\m^2$ is nonzero, since $x\notin \m^2$. Thus, the composed map of $\overline{R}$-modules $R/\m\cong xR/x\m \to \m / x\m \to \m/\m^2$ is injective; the source and target are $\overline{R}/\m$-modules, and any injective map of modules over a field splits. Thus, the identity on $xR/x\m$ factors through $\m/x\m$, establishing the claim.
	
	Now, $\overline{\m}$ is a direct summand of $\m/x\m$, so, by functoriality, $\Tor^{\overline{R}}_i(\overline{\m},k)$ is a direct summand of $\Tor^{\overline{R}}_i(\m/x\m,k)$ for each $i$. Since the latter vanishes for large $i$, the former does as well, so $\pd_{\overline{R}}(k)<\infty$, as required. 
\end{proof}

One important consequence of the previous theorem is that the regularity property localizes.

\begin{theorem}
	If $(R,\m,k)$ is a regular local ring, and $\p\in \Spec(R)$, then $R_\p$ is regular.
\end{theorem}
\begin{proof}
	The $R$-module $R/\p$ has a finite free resolution, by the previous theorem. Applying the functor of localizing at $\p$ to the resolution gives a finite free resolution of the residue field $R_{\p}/\p R_{\p}$ of $R_{\p}$ as an $R_{\p}$-module, so $R_{\p}$ is regular by the same theorem. 
\end{proof}


\begin{definition}\label{regular ring}
	An arbitrary ring is a \emph{regular ring} if for every $\p\in \Spec(R)$, $R_{\p}$ is a regular local ring.
\end{definition}

This definition is consistent with the local definition by the preceding theorem. We note now an important corollary of the Auslander-Buchsbaum and Auslander-Buchsbaum-Serre theorems. 

\begin{corollary}
	Let $S$ be a local ring, and $R$ be a regular local ring. Suppose that $R\subseteq S$ is a module-finite local inclusion. Then $S$ is Cohen-Macaulay if and only if $S$ is free as an $R$-module.
\end{corollary}
\begin{proof} Since $S$ is module-finite over $R$, a  system of parameters for $R$ is a system of parameters for $S$, and hence $S$ is Cohen-Macaulay if and only if its depth as an $R$-module is equal to $\dim(R)=\dim(S)$.
	
	By Theorem~\ref{Auslander-Buchsbaum-Serre}, since $R$ is regular, $S$ has finite projective dimension as an $R$-module. Then, $S$ is $R$-free if and only if it has projective dimension zero, which happens if and only if its depth as an $R$-module is equal to the depth of $R$, by Theorem~\ref{Auslander-Buchsbaum}. Since $R$ is Cohen-Macaulay, and $R\subseteq S$ is module-finite, $\depth(R)=\dim(R)=\dim(S)$. Thus, $S$ is $R$-free if and only if it is Cohen-Macaulay.
\end{proof}

The previous corollary exhibits an important principle in Commutative Algebra: the qualitative behavior of rings (e.g., Cohen-Macaulayness) is reflected in the module structure of rings over others via restriction of scalars.

\section{Structure theorem of complete local rings}

\begin{definition}\index{completion}
	The ($\m$-adic) completion of a local ring $(R,\m,k)$ is $\widehat{R}=\varprojlim R/\m^t R$. The completion of an $R$-module is $\widehat{M}=\varprojlim M/\m^t M$. A local ring is complete if $R\cong \widehat{R}$ via the natural map.
\end{definition}

While arbitrary local rings defy anything akin to a classification, there is a beautiful classification for complete local rings.

First, we say that a local ring $(R,\m,k)$ has \emph{(equal) characteristic zero}\index{equal characteristic} if $\mathrm{char}(R)=\mathrm{char}(k)=0$. Likewise, $(R,\m,k)$ has \emph{(equal) characteristic $p$} if $\mathrm{char}(R)=\mathrm{char}(k)=p$. $(R,\m,k)$ has \emph{mixed characteristic $(0,p)$}\index{mixed characteristic} if $\mathrm{char}(R)=0$ and $\mathrm{char}(k)=p>0$. We note that for a reduced local ring, these combinations of characteristics (where $p$ is always a prime) are the only possibilities; if $R$ is not reduced, $\mathrm{char}(k)=p>0$ and $\mathrm{char}(R)=p^e$ is possible too. A local ring $R$ has equal characteristic if and only if it contains a field.

\begin{theorem}[Cohen structure theorem]
	Let $(R,\m,k)$ be a complete local ring.
	\begin{enumerate}
		\item One can write $R\cong A\llbracket\underline{x}\rrbracket /I$, where
		\begin{itemize}
			\item $A\cong K$, a field, if $R$ has equal characteristic, or
			\item $A \cong V$, a complete DVR with uniformizer $p$ if $R$ has mixed characteristic.
		\end{itemize} That is, every complete local ring is a quotient of a power series ring.
		\item $R$ is regular if and only if
		\begin{itemize}
			\item $R\cong K\llbracket\underline{x}\rrbracket$ in equal characteristic, or
			\item either $R\cong V\llbracket\underline{x}\rrbracket$ or $R\cong V\llbracket\underline{x}\rrbracket/(p-f)$ with $f\in \m^2$ in mixed characteristic.
		\end{itemize}
	\item There exists a power series ring $S=K\llbracket\underline{y}\rrbracket$ or $S=V\llbracket\underline{y}\rrbracket$ such that $S\subseteq R$ is module-finite.
	\item If $R$ has equal characteristic, there exists a subfield $K\subseteq R$ such that the composition ${K\subseteq R \to k}$ is an isomorphism. Such a $K$ is called a \emph{coefficient field}\index{coefficient field} for $R$. In (1)--(3), one can choose a coefficient field for the stated $K$.
	\end{enumerate}
\end{theorem}

It is often helpful to complete $R$, and use this wonderful structure theorem. In general, the completion map $R\to \widehat{R}$ is faithfully flat, which allows one to descend many useful conclusions about $\widehat{R}$ to $R$. For example, you are encouraged to prove now that $R$ is regular (resp.~Cohen-Macaulay) if and only if $\widehat{R}$ is.



\chapter{Injective modules}

At this point, we have a pretty concrete idea of what free resolutions look like. For finitely-generated modules, the modules in a free resolution are the simplest modules to describe, free modules with finite rank. To specify a free resolution, we just need to give a bunch of matrices. Furthermore, we know that these all have finite (homological) length over regular rings, and what exactly this length is. At first glance, describing an injective resolution is a much more daunting task: injective modules are rarely finitely generated, so just getting started writing an injective resolution is a more daunting task. We will see that there is great finiteness in the structure of injective resolutions. We will also see that even though these modules aren't finitely generated, we can get a relative concrete understanding of them. 

\section{Injective modules and essential extensions}

\begin{definition}\index{injective module}
	An $R$-module $E$ is \emph{injective} if, for any inclusion of $R$-modules $A \subseteq B$, and any homomorphism $\varphi:A\to E$, one can extend $\varphi$ to a map $\varphi':B\to E$. Equivalently, $E$ is injective if any one-to-one\footnote{The class of modules we are defining of course shares a name with the property of maps that characterizes monomorphisms. We will try to stick to the term ``one-to-one'' to refer to injective maps in our discussion of the basics of injectives.}\index{one-to-one} map $A\to B$ induces a surjection $\Hom_R(B,E)\to \Hom_R(A,E)$.
\end{definition}

If $E$ is injective, then $\Hom_R(-,E)$ is an exact functor: given a short exact sequence $0 \to A \to B \to C \to 0$, the sequence
\[ 0 \to \Hom_R(C,E)\to \Hom_R(B,E)\to \Hom_R(A,E) \to 0\]
is exact at every spot except possibly at $\Hom_R(A,E)$, since this always holds for the ``$\Hom$ into'' functor, and is also exact at $\Hom_R(A,E)$ by the definition of injective.

A useful fact is that, instead of checking arbitrary inclusions in the definition above, it suffices to check inclusions of an ideal into the ring.

\begin{proposition}[Baer's criterion]\index{Baer's criterion}
	Let $R$ be a ring, and $E$ be a module. The module $E$ is injective if and only if, for any ideal $\A\subseteq R$, and any homomorphism $\varphi:\A\to E$, one can extend $\varphi$ to a map $\varphi':R\to E$.
\end{proposition}
\begin{proof}
	Exercise.
\end{proof}

\begin{definition}\index{divisible}
	An $R$-module $M$ is \emph{divisible} if, for any $m\in M$ and any $r\in R$, there is an $m'\in M$ such that $rm'=m$.
\end{definition}

Note that if $R$ is local, and $M$ is a nonzero divisible module, then $M$ is \emph{not} finitely generated, by NAK.

\begin{proposition}\label{divisible-domain}
	\textbf{Let $R$ be a domain.} If $M$ is an injective $R$-module, then $M$ is divisible. If $R$ is a PID, and $M$ is a divisible $R$-module, then $M$ is injective.
\end{proposition}
\begin{proof}
	By Baer's criterion, it suffices to note that $M$ is divisible if and only any map $\varphi:rR\to M$ from a principal ideal to $M$ extends to a map $\varphi':R\to M$. To see this, note that any $\varphi:rR\to M$ is of the form $\varphi_m(rs)=sm$ for some $m$ (and for any $m$, the map $\varphi_m$ is well-defined; contrast this with Example~\ref{ex:x2-self-injective}); any map from $R\to M$ is of the form $\psi_{m'}(s)=sm'$ for some $m'$; such a $\psi_{m'}$ extends $\varphi_{m}$ if and only if $m=rm'$.
\end{proof}

\begin{example}
	\[0 (\to \ZZ) \to \QQ \to \QQ/\ZZ \to 0 \]
	is an injective resolution of $\ZZ$ as a $\ZZ$-module.
\end{example}



\begin{exercise}
	Use the definition of local cohomology to compute $\H^i_{(n)}(\ZZ)$ for all $n,i$. Then, find an injective resolution of $\ZZ/p\ZZ$ as a $\ZZ$-module, and compute $\H^i_{(n)}(\ZZ/p\ZZ)$ for all $n,i$.
\end{exercise}

The hypothesis that $R$ is a domain is necessary in Propositon~\ref{divisible-domain}:

\begin{example}\label{ex:x2-self-injective}
	Let $R=K[x]_{(x)}/(x^2)$. We claim that $R$ is an injective $R$-module. By Baer's criterion, we need to check that any map $xR\to R$ extends to a map $R\to R$. Since $xR\cong R/x$, any map $xR\to R$ is of the form $\varphi(xs)=sy$, with $xy=0$. But, $y\in \ann_R(x)=(x)$, so we have $\varphi(xs)=s(xy')$, so $\psi(s)=sy'$ extends $\varphi$. Of course, $R$ is not a divisible $R$-module: $1$ is not a multiple of $x$.
\end{example}

\begin{proposition}[Hom-tensor adjunction]\index{Hom-tensor adjunction}
	Let $R\rightarrow S$ be a map of rings, $A,B$ two $S$-modules, and $C$ an $R$-module. Then there are isomorphisms
	\[ \Hom_R(A \otimes_S B, C) \cong \Hom_S( A, \Hom_R(B,C)) \]
	that are functorial in each argument; we interpret each $S$-module as an $R$-module via restriction of scalars to compute $R$-linear $\Hom$ modules. These isomorphisms are functorial in each argument, and compatible with each of the $R$ and $S$ structures induced by $A$, $B$, and $C$. 
\end{proposition}

\begin{lemma}\label{hom-injective}
	Let $R\to S$ be a map of rings. Let $F$ be a flat $S$-module (e.g., $S$ itself), and $E$ be an injective $R$-module. Then $\Hom_R(F,E)$ is an injective $S$-module.
\end{lemma}
\begin{proof}
	By Hom-tensor adjunction, there is an isomorphism of functors
	\[ \Hom_S(-,\Hom_R(F,E))\cong \Hom_R(F\otimes_S -, E). \]
	The latter is a composition of two exact functors (tensor with a flat module, hom into an injective module), so it is exact.
\end{proof}

\begin{proposition}
	Every $R$-module embeds into an injective $R$-module.
\end{proposition}
\begin{proof}
	Exercise. Suggestion: Let $(-)^{\vee}=\Hom_{\ZZ}(-,\QQ/\ZZ)$, and show that the map ``evaluate at''$:M\to M^{\vee\vee}$ is injective; map a free $R$-module onto $M^{\vee}$ and apply ${}^{\vee}$ to that $R$-module surjection.
\end{proof}

\begin{proposition}
	Let $\theta:M\to N$ be a one-to-one map of $R$-modules. The following are equivalent:
	\begin{enumerate}
		\item For any map $\alpha:N\to L$, $\alpha\circ \theta$ is one-to-one $\Rightarrow$ $\alpha$ is one-to-one. In particular, if $M\subseteq N$, then $\alpha|_M$ is one-to-one $\Rightarrow$ $\alpha$ is one-to-one.
		\item Every nonzero submodule of $N$ has a nonzero intersection with $\theta(M)$.
		\item Every nonzero element of $N$ has a nonzero multiple in $\theta(M)$.
	\end{enumerate}
\end{proposition}
\begin{proof}
	$(1)\Rightarrow (2)$: If $N'\subseteq N$ is nonzero, then $\alpha:N \to N/N'$ is not one-to-one, hence $\alpha\circ \theta:M \to N/N'$ is not either, so $M\cap N' \neq 0$.
	
	\
	
		$(2)\Rightarrow (3)$: This is the special case of a cyclic submodule.
		
		\
		
		$(3)\Rightarrow (1)$: Given a nonzero element in $n\in\ker(\alpha)$, $n$ has a nonzero multiple in $\theta(M)$, and any multiple of $n$ is still in the kernel of $\alpha$. 
\end{proof}


\begin{definition}\index{essential extension}
	A map $\theta$ that satisfies the equivalent conditions above is called an \emph{essential extension}. We will often say that one module is an essential extension of another, meaning that the latter is a submodule, and the inclusion map is essential.
\end{definition}

Roughly, one can think of $A\subseteq B$ is an essential extension as being something like a dual property to $A$ being a generating set for $B$ (even though generating sets aren't modules). If $A \subseteq B$ is essential, then anything in $B$ can get multiplied back into $A$, whereas if $A$ is a generating set for $B$, anything in $B$ can be obtained by multiplying from elements in $A$ (and adding).

\begin{example}\label{ex:localization essential}
	If $W$ is a multiplicative set consisting of nonzerodivisors on $M$, then $W^{-1}M$ is an essential extension of $M$. In particular, the fraction field of a domain is an essential extension of it.
\end{example}

\begin{example}\index{$I$-torsion}\index{socle}\label{ex:socle essential}
	If $M$ is a (nonzero) $I$-torsion module, that is, every element of $M$ is killed by a power of $I$, then $\ann_M(I)\subseteq M$ is an essential extension.
	
	In particular, if $(R,\m)$ is local and $M$ is $\m$-torsion, $\ann_M(\m)$ is called the \emph{socle} of $M$; $M$ is an essential extension of its socle.
\end{example}
\begin{proof}
	Given $m\in M$, we have that $\Ass(Rm)\subseteq \Ass(M)$.\footnote{For a not-necessarily-finitely-generated module $M$, $\Ass(M)$ is the set of primes $\q$ such that $R/\q$ embeds into $M$. Any nonzero module has an associated prime: this reduces to the finitely generated case by considering a nonzero finitely generated submodule.} Since $M$ is $I$-torsion, $\Ass(M)\subseteq V(I)$. Let $\p\in \Ass(Rm)$, and $x\in Rm$ such that $\ann(x)=\p$. Then $x$ is a nonzero multiple of $m$ that is killed by $I$.
\end{proof}

\begin{proposition}
	Let $L\subseteq M \subseteq N$ be $R$-modules.
	\begin{enumerate}
		\item $L\subseteq N$ is essential if and only if $L\subseteq M$ and $M \subseteq N$ are essential.
		\item If $M \subseteq N_i \subseteq N$ and $N=\bigcup N_i$, then $M \subseteq N$ is essential if and only if each $M \subseteq N_i$ is essential.
		\item There is a unique $N'$ such that $M \subseteq N' \subseteq N$ that is maximal with respect to the property that $M \subseteq N'$ is essential.
	\end{enumerate}
\end{proposition}

\begin{definition}\index{maximal essential extension}
	A module $N'$ as in (3) above is called a \emph{maximal essential extension of $M$ in $N$}.
	 If $M\subseteq N$ is essential, and $N$ has no proper essential extensions, then we say that $N$ is a \emph{maximal essential extension} of $M$.
\end{definition}

Beware that there are two notions of maximal essential extension above: a relative version that takes place inside another module, and an absolute version.

\begin{proposition}
	Let $M$ be an $R$-module. The following are equivalent:
	\begin{enumerate}
		\item $M$ is an injective module
		\item every one-to-one map $M\to N$ splits
		\item $M$ has no proper essential extensions
	\end{enumerate}
In particular, any maximal essential extension in the absolute sense is an injective module.
\end{proposition}
\begin{proof}
	$(1)\Rightarrow (2)$: The identity map $M\to M$ extends to a map $N\to M$ by the definition of injective.
	
	\
	
		$(2)\Rightarrow (3)$: It suffices to note that $M \subseteq M \oplus M'$ is \emph{not} essential: $(0,m')$ has no nonzero multiple in (the image of) $M$.
		
		\
		
		$(3)\Rightarrow (1)$: Embed $M$ in an injective module, $E$. By Zorn's lemma, there is a maximal submodule $N$ of $E$ such that $M\cap N=0$. Then, $M \to E/N$ is essential, and by hypothesis, an isomorphism. Then, $E=M+N=M\oplus N$. Since $M$ is a direct summand of an injective module, $M$ is injective.
\end{proof}

\begin{proposition}
	Let $M$ be an $R$-module. If $E$ is an injective module with $M\subseteq E$, then the maximal essential extension of $M$ in $E$ is an injective module. All maximal essential extensions of $M$ are isomorphic.
\end{proposition}
\begin{proof}
	Let $E'$ be a maximal essential extension of $M$ in $E$, and $Q$ be an essential extension of $E'$ (possibly not in $E$). Since $E$ is injective, the inclusion of $E'\subseteq E$ extends to a map from $Q\to E$. Since $E'\to E$ was one-to-one, and $E' \to Q$ essential, $Q$ to $E$ is one-to-one. By definition of $E'$, we have $E'=Q$. Thus, $E'$ is an absolute maximal essential extension of $M$, hence an injective module.
	
	Let $E'$ and $E''$ be two maximal essential extensions of $M$. The map from $M\to E''$ extends to a map $\varphi:E' \to E''$. Since $E'$ is an essential extension of $M$ and $M \to E''$ is one-to-one, $\varphi:E'\to E''$ is one-to-one. Since $E'$ is injective, $E''=\varphi(E')\oplus C$ for some $C$. Since $\varphi(E')\to E''$ is essential, $C=0$.
\end{proof}

\begin{definition}\index{injective hull}\index{$E_R(M)$}
	An \emph{injective hull} or \emph{injective envelope} of an $R$-module $M$ is a maximal essential extension of $M$. By the previous proposition, this is well-defined up to isomorphism. We write $E_R(M)$ for an injective hull of $M$.
\end{definition}



\begin{definition}\index{minimal injective resolution}
	A \emph{minimal injective resolution} of an $R$-module $M$ is an injective resolution $M \to E^{\bullet}$ of $M$ in which $E^0=E_R(M)$, and $E^i=E_R(\coker(\partial^i_{E^{\bullet}}))$ for each $i>0$.
\end{definition}

\begin{example}
	\[0 (\to \ZZ) \to \QQ \to \QQ/\ZZ \to 0 \] is a minimal injective resolution of $\ZZ$ as a $\ZZ$-module.
\end{example}

\section{Injective modules over noetherian rings}

So far, our observations on injectives are very general. For noetherian rings, there is a beautiful structure theory of injective modules due to Bass. To prepare for the first step, we note:

\begin{lemma} If $M$ is a finitely generated $R$-module, and $\{N_i\}_{i\in I}$ is an arbitrary family of $R$-modules, then 
	\[\Hom_R(M,\bigoplus_{i\in I} N_i)\cong \bigoplus_{i\in I} \Hom_R(M,N_i).\] If $N_0 \subseteq N_1 \subseteq N_2 \subseteq \cdots$ , then 
	\[\Hom_R(M,\bigcup_{i\in \NN} N_i) \cong \bigcup_{i\in \NN}\Hom_R(M, N_i).\]
	\end{lemma}
\begin{proof}
	Exercise.
\end{proof}

\begin{proposition}\label{prop: direct sum of injective}
	If $R$ is noetherian, then every direct sum of injective $R$-modules is injective.
\end{proposition}
\begin{proof}
	Let $\{E_i\}_{i\in I}$ be a family of injective modules. For an ideal $\A$ and any $i$, $\Hom_R(R,E_i)\to \Hom_R(\A,E_i)$ is surjective. Applying the previous lemma and the hypothesis that $\A$ is finitely generated, the composition
	\[ \Hom_R(R,\bigoplus_{i\in I} E_i)\cong \bigoplus_{i\in I} \Hom_R(R,E_i) \to \bigoplus_{i\in I} \Hom_R(\A,E_i) \cong \Hom_R(\A,\bigoplus_{i\in I} E_i) \]
	is surjective. By Baer's criterion, $\bigoplus_{i\in I} E_i$ is injective.
\end{proof}

Evidently, the injective hulls of prime cyclic modules, $E_R(R/\p)$, are injective modules. They will be the building blocks in the structure theory. Both to that end and for our purposes later, we will want to understand their structure. We collect some of their key properties here.

Before we do this, we recall some facts about modules that are not necessarily finitely generated.

Recall that $\p$ is an \emph{associated prime}\index{associated prime}\index{$\Ass(M)$} of a module $M$ if there is an embedding $R/\p\hookrightarrow M$; we write $\Ass(M)$ for the set of associated primes of $M$. For a general module, 
\begin{itemize}
	\item $\Ass(M)$ need not be finite, and
	\item $\bigcap_{\p\in\Ass(M)} \p$ does not necessarily agree with $\sqrt{\ann_R(M)}$.
\end{itemize}
However, $M\subseteq N$ implies $\Ass(M)\subseteq \Ass(N)$, and if $R$ is noetherian,
\begin{itemize}
	\item if $M\neq 0$, then $\Ass(M)\neq \varnothing$, and
	\item $\Supp(M)=\{ \q \in \Spec(R) \ | \ \q \supseteq \p  \text{ for some } \p \in \Ass(M) \}$.
\end{itemize}
\begin{proof}
	For the first, take some nonzero $m\in M$; $\varnothing\neq\Ass(Rm) \subseteq \Ass(M)$. For the second, we note that $(R/\p)_\q \neq 0$ if $\q \subseteq \p$, which yields ``$\supseteq$,'' and if $x/1 \neq 0$ in $M_\q$, then $\q$ must contain an associated prime of $Rx$, which is an associated prime of $M$.
\end{proof}

A module $M$ is $I$-torsion if for every $m\in M$, $\exists N$ such that $I^N m=0$. This does not necessarily imply that there is some $N$ such that $I^N M=0$. If $R$ is noetherian and $I=(f_1,\dots, f_t)$ then the following are equivalent:
\begin{itemize}
	\item $M$ is $I$-torsion;
	\item $\forall m\in M$, there is an $N$ such that $f_i^N m=0$ for all $i$;
	\item $\forall \p \in \Ass(M), \ \p \supseteq I$.
\end{itemize}
\begin{proof}
	For the equivalence of the first two, we note that $I^{Nt}\subseteq (f_1^N,\dots,f_t^N)\subseteq I^N$, so a large power of $I$ kills an element iff large powers of each $f_i$ do. This uses finite generation in a crucial way. The first implies the third since $I$ contains a nonzerodivisor on the domain $R/\q$, and any power of this element does not kill the generator of $R/\q$. The third implies the first, since, for each $x\in M$, the associated primes of the cyclic module $Rx$ all are contained in $I$, so $\sqrt{\ann(x)}=\bigcap_{\p\in \Ass(Rx)} \p \subseteq I$.
\end{proof}

\begin{lemma}
	If $M\subseteq N$ is an essential extension, then $\Ass(M)=\Ass(N)$.
\end{lemma}
\begin{proof}
	We only need to see that an associated prime of $N$ is also associated to $M$. If $x$ generates a cyclic submodule of $N$ isomorphic to $R/\p$, then any nonzero multiple of $x$ does as well; since $x$ has a nonzero multiple in $M$, we are done.
\end{proof}


\begin{theorem}\label{properties-of-ERP}
	Let $\p$ be a prime in a noetherian ring $R$. Let $\kappa$ be the fraction field of $R/\p$ (equivalently, the residue field of $R_\p$.) Let $E=E_R(R/\p)$ be an injective hull for $R/\p$. 
	\begin{enumerate}
		\item If $x\in R\setminus \p$, then $E \stackrel{x}{\to} E$ is an isomorphism, hence $E=E_\p$.
		\item $\ann_E(\p)=\kappa$.
		\item $\kappa\subseteq E$ is an essential extension of $R_\p$-modules and $E$ is an injective hull of $\kappa$ as an $R_{\p}$-module.
		\item $E$ is $\p$-torsion, and $\Ass(E)=\{\p\}$.
		\item $\Hom_{R_\p}(\kappa, E)\cong \kappa$ and $\Hom_{R_\p}(\kappa, E_R(R/\q)_{\p})=0$ for another prime $\q \neq \p$.
	\end{enumerate}
\end{theorem}
\begin{proof}
	\begin{enumerate}
		
				\item[4.] This is immediate from the previous lemma and the discussion above it.
				
		\item By Example~\ref{ex:localization essential}, $R/\p \subseteq \kappa$ is an essential extension, so $E$ must contain a copy of $\kappa$; we identify $\kappa$ with its isomorphic copy in $E$: $R/\p \subseteq \kappa \subseteq E$ are all essential. Since multiplication by $x$ is one-to-one on $\kappa$, it must be one-to-one on its essential extension $E$. Then, the submodule $xE\cong E$ is injective, so a direct summand of $E$. But, since $\kappa \subseteq xE \subseteq E$ is essential, $E$ cannot decompose as a nontrivial direct sum, so $xE=E$.
		
		\item By part (1), $\ann_E(\p)=\ann_E(\p R_{\p})$ is a $\kappa$-vector space, and contains the copy of $\kappa$ we found earlier, so $\kappa \subseteq \ann_E(\p)$ splits. Since the extensions $\kappa \subseteq \ann_E(\p) \subseteq E$ are essential, $\ann_E(\p)$ cannot decompose as a nontrivial direct sum of $\kappa$-vector spaces.
		
		\item Since $\kappa \subseteq E$ is essential as $R$-modules, it is clearly essential as $R_{\p}$-modules. (Any nonzero element has a nonzero $R$-multiple, hence a nonzero $R_{\p}$-multiple in the submodule.) To see that $E$ is a maximal essential extension of $\kappa$ as an $R_{\p}$-module, let $E\subseteq M$ be an essential extension of $R_{\p}$-modules. For any nonzero $m\in M$, there is some nonzero multiple $(r/s)m$ in $E$, with $s\notin \p$. Then $rm$ is a nonzero multiple of $m$ in $E$, so $E\subseteq M$ is an essential extension as $R$-modules, so $M=E$.
		

		
		\item[5.] We recall that $\Hom_{R_\p}(R_\p/\p R_\p,M)$ can be identified with the submodule of $M$ consisting of elements killed by $\p R_\p$.
		
		Then, the first isomorphism follows from part~(2) applied in $R_\p$.
		
		Set $E'=E_R(R/\q)$. By (4), $E'_{\p}\neq0$ only if $\q \subseteq \p$. By (1), $E'_\p=E_{R_\p}(R_\p / \q R_\p)$, which by (4) has $\q R_\p$ as its only associated prime; in particular, no element is killed by $\p R_\p$, so the hom is zero.
	\end{enumerate}
\end{proof}

We can now prove the structure theorem for injective modules.

\begin{theorem}\label{structure of injectives}
	Let $R$ be a noetherian ring and $E$ an injective $R$-module. There is a direct sum decomposition
	\[ E \cong \bigoplus_{\p \in \Spec(R)} E_R(R/\p)^{\mu_\p}, \]
	and the multiplicities $\mu_\p$ are uniquely determined by the formula $\mu_\p=\dim_{\kappa(\p)} \Hom_{R_\p}(\kappa(\p), E_\p)$, where $\kappa(\p)=R_\p / \p R_\p$.
	\end{theorem}
\begin{proof}
	By Zorn's lemma, there is a submodule $E'$ (not a priori nonzero) of $E$ that is 
	\begin{itemize}
		\item isomorphic to a direct sum of injective hulls of prime cyclic modules: $E'\cong \oplus_\p E_R(R/\p)^{\eta_\p}$, 
		\item and no other submodule of $E$ contains $E'$ and admits a decomposition of this form.
	\end{itemize}  
By Proposition~\ref{prop: direct sum of injective}, $E'$ is injective, so we can write $E=E'\oplus C$ for some $C$. If $E''\neq 0$, take $\p\in \Ass(E'')$. The inclusion map $R/\p \to E''$ extends along the inclusion $R/\p\subseteq E_R(R/\p)$ to a map $E_R(R/\p)$ since $E''$ is injective; since the inclusion is essential, $E_R(R/\p)$ embeds into $E''$. Since $E_R(R/\p)$ is injective, it splits from $E''$, and we contradict the maximality of $E'$. Thus, a decomposition as promised exists. Given such a decomposition, the formulas for $\mu(\p)$ follow from part (5) of the previous theorem.
\end{proof}


Thus, injective modules are uniquely determined by a multiplicity for each prime. This structural data, for the modules appearing in a minimal injective resolution of a module, are called Bass numbers.

\begin{definition}[Bass numbers]\index{Bass number}\index{$\mu(i,\p)$}
	Let $R$ be a noetherian ring, and $M$ an $R$-module. Given a minimal injective resolution 
	\[0 \to ( M \to ) E^0 \to E^1 \to E^2 \to \cdots \]
	and decompositions
		\[ E^i \cong \bigoplus_{\p \in \Spec(R)} E_R(R/\p)^{\mu(i,\p)}, \]
		we call $\mu(i,\p)$ the \emph{i-th Bass number of $M$ with respect to $\p$}.
\end{definition}

\begin{theorem}
	Let $R$ be a noetherian ring, and $M$ an $R$-module. The Bass numbers of $M$ can be computed as
	\[\mu(i,\p) = \dim_{\kappa(\p)}\Ext^i_{R_\p}(\kappa(\p), M_{\p}) \quad \text{ where } \ \kappa(\p)=R_\p / \p R_\p.\]
\end{theorem}
\begin{proof}
	Given a minimal injective resolution 
	\[0 \to ( M \to ) E^0 \to E^1 \to E^2 \to \cdots \]
	we leave it as an exercise to check that 
	\[0 \to ( M_\p \to ) E_\p^0 \to E_\p^1 \to E_\p^2 \to \cdots \]
	is a minimal injective resolution of $M_\p$ as an $R_\p$-module, and that the number of copies of $E_R(R/\p)$ in $E^i$ is the same as the number of copies of $E_R(R/\p)$ in $E^i_{\p}$. We compute the $\Ext$ modules in the statement from the latter injective resolution:
	\[ \Ext^i_{R_\p}(\kappa(\p), M) = H^i\Big( \ 0 \to \Hom_{R_\p}(\kappa(\p),E^0_\p) \to \Hom_{R_\p}(\kappa(\p),E^1_\p) \to \Hom_{R_\p}(\kappa(\p),E^2_\p) \to \cdots \ \Big). \]
	
	\begin{claim*}
		The differentials in the complex above are zero.
	\end{claim*}
We need to show that for any $R_\p$-linear $\alpha:\kappa(\p)\to E^i_\p$, the composition $\delta^i \circ \alpha: \kappa(\p) \to E^{i+1}_\p$ is the zero map. Let $x\in \kappa(\p)$, and suppose that $\alpha(x)\neq 0$ in $E^i_\p$. The minimality of the injective resolution implies that $\alpha(x)$ has a nonzero multiple in the image of $\delta^{i-1}$. Since $\kappa$ is a field, this implies that $\alpha(x)$ is in the image of $\delta^{i-1}$, and hence in the kernel of $\delta^i$, establishing the claim.

The proof of the theorem is now immediate, since the homology of the complex in the i-th spot is $\Hom_{R_\p}(\kappa(\p),E^i_\p)$, which, by the previous theorem, is a $\kappa(\p)$-vector space of rank $\mu(i,\p)$.
\end{proof}

\begin{corollary}
	If $R$ is noetherian, and $M$ is a finitely generated $R$-module, all of the Bass numbers of $M$ are finite.
\end{corollary}
\begin{proof}
	We can compute $\mu(i,\p)$ by taking a minimal free resolution of $\kappa(\p)$, applying $\Hom_{R_\p}(-,M_\p)$, and computing homology. The complex we obtain consists of finitely generated modules, so its homology modules are finitely generated modules. 
\end{proof}

\begin{example}
	Let's compute the Bass numbers of $\ZZ$ as a $\ZZ$-module. We claim that \[\QQ/\ZZ\cong \bigoplus_{p \text{ prime}} \ZZ[1/p]/\ZZ \cong \bigoplus_{\p \in \Spec(\ZZ) \setminus \{(0)\}} E_{\ZZ}(\ZZ/p\ZZ).\]
	To see the first isomorphism, consider an element $[m/n]\in \QQ/\ZZ$ with $m/n$ in lowest terms. We want to see that $[m/n]$ has a unique expression as a sum of elements of $\ZZ[1/p]/\ZZ$. We can discard any terms with denominators $q$ not dividing $n$, since $(1/q \cdot\ZZ) \cap (1/n \cdot \ZZ) = \ZZ$. Write $n=p_1^{e_1}\cdots p_n^{e_n}$. Then, by the Chinese remainder theorem
	\begin{align*} \frac{m}{n} &\equiv \sum_i \frac{a_i}{p_i^{e_i}}&(\mathrm{mod} \ 1) & & \Longleftrightarrow & \\
		 m &\equiv \sum_i {a_i}{p_1^{e_1}\cdots \widehat{p_i^{e_i}} \cdots p_n^{e_n}} &(\mathrm{mod} \ n )&  &\Longleftrightarrow &
		 \end{align*}
		 \[\begin{cases} m \equiv {a_1}\widehat{p_1^{e_1}}\cdots {p_i^{e_i}} \cdots p_n^{e_n} \quad (\mathrm{mod} \ p_1^{e_1} ) \\
		\qquad  \vdots \qquad  \vdots \qquad  \vdots \\
		  m \equiv {a_n}p_1^{e_1}\cdots {p_i^{e_i}} \cdots \widehat{p_n^{e_n}} \quad (\mathrm{mod} \ p_n^{e_n} ).
		  \end{cases} \]
In each of these congruence equations, the product of prime powers on the RHS is a unit, so we can solve uniquely for each $a_i$ mod $p_i^{e_i}$; that is, each $[a_i / p_i^{e_i} ] \in \ZZ[1/p]/\ZZ$ is uniquely determined. This establishes the first isomorphism.
		  
		  For the second, it suffices to note that $\ZZ[1/p] / \ZZ$ is divisible (check it!), that it is $p$-torsion (clear), and that the annihilator of $p$ in this module is isomorphic to $\ZZ/ p \ZZ$. From these observations, we see that the module is injective by Proposition~\ref{divisible-domain}, and that it is an essential extension of $\ZZ / p \ZZ$ by Example~\ref{ex:socle essential}.
		  
		  We conclude that the Bass numbers of $\ZZ$ are 
		  \[\mu(0,\p)= \begin{cases} 1 \ \ \text{ if } \p=(0) \\ 0 \ \ \text{ if } \p=(p)\neq(0) \end{cases} \quad \text{ and } \mu(1,\p)= \begin{cases} 0 \ \ \text{ if } \p=(0) \\ 1 \ \ \text{ if } \p=(p)\neq(0). \end{cases} \]
		  
		  Each Bass number here is either $0$ or $1$. We caution that the ``total first Bass number,'' the sum of the first Bass numbers, is infinite.
		  
		  We note also that this 116esque game\index{116esque game} of writing a fraction as a sum of fractions with pure-power denominators is very closely related to the calculation of local cohomology.
	\end{example}

We now know that the indecomposable injectives of a noetherian ring are all of the form $E_R(R/\p)$, that every injective is (in a unique way) a direct sum of these, and finitely generated modules all have injective resolutions in which each injective has a finite number of copies of $E_R(R/\p)$ in its direct sum decomposition. We also know many of the key structural properties of $E_R(R/\p)$, as collected in Theorem~\ref{properties-of-ERP}. 

We will want to have a better understanding of $E_R(k)$ for the residue field of a local ring in order to the develop the duality theory hinted at on the first day of class. We note that this encompasses \emph{any} indecomposable injective $E_S(S/\p)$: by part (3) of Theorem~\ref{properties-of-ERP},  $E_S(S/\p)=E_R(k)$ for $R=S_\p$ and $k$ the residue field of $R$. We will pursue this with a little bit of redundancy. First, we will discuss a model for $E_R(k)$ when $R$ has a coefficient field (e.g., when $R$ is complete) and the Matlis duality functor in that setting. Then, we will develop the duality theory in full generality.

\section{Worksheet on Matlis duality and $E_R(k)$ for rings with coefficient fields}

 Throughout this section/worksheet, $(R, \m)$ will denote a local or graded noetherian ring with coefficient field\index{coefficient field} $k$, so that the composition $k \hookrightarrow R \to R/\m$
is an isomorphism.


\begin{definition}\index{$\m$-adically continuous Hom}\index{$\Hom_k^{\m-\textrm{cts}}$} For an $R$-module $M$, the \emph{$\m$-adically continuous $k$-linear homomorphisms from $M$ to $k$} are 
$$\Hom_k^{\m-\textrm{cts}} \left( M, k \right) := \varinjlim \Hom_k \left( M/\m^n M, k \right).$$
\end{definition}


\noindent We recall some facts about $\Hom$ and limits:

\begin{itemize}
	\item Given a directed system $(M_i)_{i\in \NN} = \left( \xymatrix{\cdots \ar[r] & M_i \ar[r] & M_{i+1} \ar[r] & \cdots} \right)$,
	$$\Hom_R \left( \varinjlim M_i, N \right) \cong \varprojlim \Hom_R \left( M_i, N \right).$$
	\item If $M$ is finitely presented and given a directed system $(N_i)_{i\in \NN}$, then
	$$\Hom_R \left( M, \varinjlim N_i \right) \cong \varinjlim \Hom_R \left( M, N_i \right).$$
	\item In general, if $(M_i)_{i\in \NN} = \left( \xymatrix{\cdots \ar[r] & M_i \ar[r] & M_{i-1} \ar[r] & \cdots} \right)$ is an inverse system,
	$$\Hom_R \left( \varprojlim M_i, N \right) \not\cong \varinjlim \Hom_R (M_i, N)$$
\end{itemize}




\begin{enumerate}[1)]\setcounter{enumi}{-1}
	
	\item Check that if $M$ is an $R$-module, then $\big(\Hom_k(M/\m^n M,k)\big)_{n\in \NN}$ forms a directed system of $R$-modules, so $\Hom_k^{\m-\textrm{cts}} ( M, k)$ is an $R$-module.\footnote{Yes, this is very quick.}
	
	\
	
	\item \begin{enumerate}[a)]
		\item Show that $k \cong \Hom_R(R,k) \subseteq \Hom_k^{\m-\textrm{cts}} \left( R, k \right)$ is an essential extension.
		
		
		\item Show that if $M$ is a finitely generated $R$-module, then
		$$\Hom_k^{\m-\textrm{cts}} \left( M, k \right) \cong \Hom_R \left( M,\Hom_k^{\m-\textrm{cts}} \left( R, k \right) \right).$$
		
		
		
		\item Show that $\Hom_k^{\m-\textrm{cts}} \left( R, k \right)$ is injective, and conclude that this is an injective hull of $k$.\footnote{Hint: Show that for any ideal $I$ and any $n$, there exists $N$ such that $\xymatrix@R=1mm{I / \m^N \cap I \ar@{->>}[r] \ar@{^{(}->}[rd] & I / \m^n I \\ & R/\m^N}$.}
	\end{enumerate}
	
	\
	
	\item \begin{enumerate}[a)]
		\item Let $S = k \left[ x_1, \ldots, x_d \right]$, $\m = \left( x_1, \ldots, x_d \right)$, $T = S_\m$. Show that $E_T(k)$ has a basis given by
		$$\left( {\underline{x}}^{\underline{\alpha}} \right)^* = \left\lbrace \begin{array}{ll} {\underline{x}}^{\underline{\beta}} \mapsto 1 & {\underline{\beta}} = \underline{\alpha} \\ {\underline{x}}^{\underline{\beta}} \mapsto 0 & \underline{\beta} \neq \underline{\alpha} \end{array} \right.$$
		with module structure given by
		$${\underline{x}}^{\underline{\gamma}} \cdot \left( {\underline{x}}^{\underline{\alpha}} \right)^* = \left\lbrace \begin{array}{ll} \left( {\underline{x}}^{\underline{\alpha} - \underline{\gamma}} \right)^* & \alpha_i \geqslant \gamma_i \textrm{ for all } i \\ 0 & \alpha_i < \gamma_i \textrm{ for some } i. \end{array} \right.$$
		
		
		
		\item Compare $E_T(k)$ to the module described in the first lecture.
		
		
		
		\item Consider $\widehat{T} = k \llbracket x_1, \ldots, x_n \rrbracket$, the completion of $T$ above. Show that $E_{\widehat{T}}(k) \cong E_T(k)$.
		
		
		
		\item If $R = \oplus_{i\in \NN} R_i$ is graded, $R_0 = k$, and $R$ is a finitely generated $k$-algebra, show that the graded dual
		$$R^* = \bigoplus_i R_i^*, \qquad R_i^* = \Hom_k(R_i, k)$$
		is an injective hull for $k$.
	\end{enumerate}
\end{enumerate}


\begin{definition}\index{Matlis duality}\index{$M^\vee$} The \emph{Matlis duality functor} is $(-)^{\vee} = \Hom_R(-,E_R(k))$. Note that this is an exact functor.
\end{definition}


\begin{enumerate}	\setcounter{enumi}{2}
	\item \begin{enumerate}[a)]
		\item If $M$ is a finitely generated $R$-module, show that
		$M^{\vee} \cong \Hom_k^{\m-\textrm{cts}} ( M, k ).$
		
		
		
		\item If $M$ is a module of finite length, show that $M^\vee \cong \Hom_k ( M, k )$.
		
		
		
		\item If $M_1 \subseteq M_2 \subseteq M_3 \subseteq \cdots \subseteq M$, each $M_i$ is a finite length module, and $M=\bigcup M_i$, we say that $M$ \emph{is a union of finite length submodules}. Show that if $M$ is a union of finite length submodules, then $M^\vee \cong \Hom_k(M,k)$.
		
		
		
		\item Show that if $M$ is finitely generated, then $M^\vee$ is a union of finite length submodules.
		
		
		
		\item If $M$ is a finitely generated $R$-module, show that $M^{\vee \vee} \cong \widehat{M}$. In particular, $R^{\vee \vee} \cong \widehat{R}$.
		
		
		
		
	\end{enumerate}

\
	
	\item \begin{enumerate}[a)]
		\item Come up with explicit examples of Matlis duals of nonregular rings and nonfree modules.
		
		
		
		\item Say $R$ is complete. Our recipe for $E_R(k)$ looks canonical. Explain why it is not.
		
		
		
		\item Show that the Matlis duality functor is faithful: if $M\neq 0$, then $M^\vee \neq 0$.
		
		
		
		\item Suppose $R$ is a local ring containing a field, but that $R$ does not have a coefficient field. Explain how to give an explicit description of $R^\vee$ anyway.
		
		
		
		\item Can you give a uniform description for the duality functor for all $R$-modules in our setting?
		
		
	\end{enumerate}
	
	
\end{enumerate}

We note here a generalization of the definition we encountered above:

\begin{definition}\index{continuous Hom}\index{$\Hom_A^{J-\textrm{cts}}$} Let $R$ be an $A$-algebra, $J$ an ideal of $R$, $M,N$ two $R$-modules. The \emph{$J$-adically continuous $A$-linear homomorphisms from $M$ to $N$} are 
	$$\Hom_A^{J-\textrm{cts}} \left( M, N \right) := \varinjlim \Hom_A \left( M/\m^n M, N \right).$$
\end{definition}


\section{Matlis Duality}

In the previous worksheet, we encountered the Matlis duality functor in a special setting. We define it the same way in general.

\begin{definition}\index{Matlis duality}\index{$M^\vee$} Let $(R,\m,k)$be a local ring. The \emph{Matlis duality functor} is $(-)^{\vee} = \Hom_R(-,E_R(k))$.
\end{definition}

Based on the worksheet above, we expect this functor to behave like vector space duality $\Hom_k(-,k)$. A more homological motivation for this functor is given by the fact hom into an injective is exact, and the only indecomposable injective into which every module could admit a nonzero map is $E_R(k)$.

Of course, we hope/expect this to be a duality in some sense. The following lemma gives a few first ways in which this is true.


\begin{lemma}
	Let $(R,\m, k)$ be a local ring and $M$ be an $R$-module. Then
	\begin{enumerate}
		\item the natural map $M\to M^{\vee\vee}$ is injective,
		\item $\ell(M^{\vee}) = \ell(M)$, and
		\item if $\ell(M)<\infty$, then $M\cong M^{\vee\vee}$.
	\end{enumerate} 
\end{lemma}

\begin{proof}
	\begin{enumerate}
		\item For nonzero $x\in M$ set $L = Rx \subseteq M$, and consider the composed
		map $L\to L/\m L \cong K \to E_R(k)$. This map extends to a homomorphism
		of $R$-modules $\epsilon: M \to E_R(k)$ with $\epsilon (x) \neq 0$.

\item	First, we assume that $\ell(M)$ is finite, and induce on length. Note that $k$ is the only simple module over $R$, and thus the subquotients in any decomposition series are isomorphic to $k$. Therefore, if $\ell(M)=1$, then $M \cong k$, and the result follows from $\Hom_R(k, E(k)) \cong k$. When $\ell(M) \geqslant 2$, the composition series of $M$ gives an exact sequence
	$$\xymatrix{0 \ar[r] & L \ar[r] & M \ar[r] & k \ar[r] & 0}.$$
	Since length is additive on exact sequences, $\ell(L) = \ell(M)-1$. By induction hypothesis, $\ell(L^\vee) = \ell(L)$. On the other hand, since $(-)^{\vee}$ is an exact functor, applying $(-)^{\vee}$ to the short exact sequence above yields a short exact sequence
	$$\xymatrix{0 \ar[r] & k \ar[r] & M^\vee \ar[r] & L^\vee \ar[r] & 0}.$$
	By additivity of $\ell$ on this short exact sequence, $\ell(M^\vee) = \ell(L^\vee) + 1$. Thus $\ell(M^\vee) = \ell(L) + 1 = \ell(M)$.
	
	\item From the first two parts, we have that $M\to M^{\vee\vee}$ is injective, and $\ell(M)=\ell(M^{\vee\vee})$, so the map must be surjective as well.
		\end{enumerate}
\end{proof}

\begin{remark}
	The natural map ``evaluate at'' from $M$ to $M^{\vee\vee}$ commmutes with double-duals: given $f\colon M \to N$, the diagram
		$$\xymatrix{M \ar[d]_-{\mathrm{nat}} \ar[r]^-{f} & N \ar[d]_-{\mathrm{nat}} \\
		M^{\vee \vee} \ar[r]^-{f^{\vee \vee}} & N^{\vee \vee} }$$
	commutes.
\end{remark}

%When $M=R$, we obtain the following corollary:
%
%\begin{corollary}\label{corollary length R}
%	Let $(R,\m, k)$ be a local ring and $M$ be an $R$-module. Then $\ell(E(k)) = \ell(R)$. In particular, $E(k)$ is a finite length module if and only if the local ring $R$ is artinian.
%\end{corollary}


Our goal now is to bootstrap up this duality from the finite length case to local rings in general. The following statement on compatibility of injective hulls will be the key.

\begin{theorem}
	Let $\varphi \!: (R, \m, k) \longrightarrow (S, \mathfrak{n}, \ell)$ be a local homomorphism of local rings. If $S$ is module-finite over the image of $R$, then $\Hom_R(S,E_R(k)) = E_S(\ell)$.
\end{theorem}

\begin{proof} We ahve that $S/\m S \cong S \otimes_R k$ has finite length, so $\m S$ is $\mathfrak{n}$-primary. Since some power of $\mathfrak{n}$ is contained in $\m S$, and $E_R(k)$ is $\m$-torsion, $\Hom_R(S,E_R(k))$ is $\mathfrak{n}$-torsion as an $S$-module. It is also injective by Lemma~\ref{hom-injective}.
	Thus, by the structure theorem, it is isomorphic to some number of copies of $E_S(\ell)$. We know that this number of copies is the $\ell$-vector space dimension of $\Hom_S(\ell,\Hom_R(S,E_R(k)))$. Consider the isomorphisms
	\begin{align*}
	\Hom_S(\ell,\Hom_R(S,E_R(k))) & \cong \Hom_R(\ell \otimes_S S, E_R(k)) \\
	& \cong \Hom_R(\ell \otimes_k k, E_R(k)) \\
	& \cong \Hom_k(\ell, \Hom_R(k,E_R(k))) \\
	& \cong \Hom_k(\ell,k).
	\end{align*}
	The last hom module is a one-dimensional $\ell$-vector space, so $\Hom_R(S,E_R(k)) \cong E_S(\ell)$.
\end{proof}

\begin{remark}
	Let $(R,\m,k)$ be a local ring. For each ideal $I$ in $R$, the theorem above implies that the injective hull of $k$ over $R/I$ is $(0 :_{E_R(k)} I)$. In particular, since $E_R(k)$ is $\m$-torsion, one has 
	$$E_R(k) = \bigcup_{t} \ (0 :_{E_R(k)} \m^t) = \bigcup_{t} \ E_{R/\m^t}(k).$$
\end{remark}

\begin{remark}
	Let $(R,\m)$ is local, and $M$ is an $\m$-torsion $R$-module, then $M$ is naturally a $\widehat{R}$-module: if $\m^n x=0$, and $\widehat{r}\in \widehat{R}$, take some $r\in R$ such that $r-\widehat{r}\in \m^n$, and set $\widehat{r}m=rm$. One sees easily that this action is well-defined, and additionally, that any $R$-linear endomorphism of $M$ is also an $\widehat{R}$-linear endomorphism.
\end{remark}

%\begin{theorem}
%	A be a local ring $R$ is an injective module over itself if and only if $R$ is an artinian ring and the socle of $R$ has rank $1$ as a vector space over $k$.  
%\end{theorem}
%
%\begin{proof}
%	By NAK, every local ring is an indecomposable module over itself. If $R$ is injective, then it must be isomorphic to $E(R/P)$ for some prime ideal $P$ in $R$, by Theorem \ref{structure of injectives}. In particular, $R$ must be $P$-torsion, and every element in $R \setminus P$ is a unit, so that $P$ must be the only prime ideal in $R$. In particular, $R$ is artinian with maximal ideal $P$, and the socle of $R$ is isomorphic to the socle of $E(R/P)$, which is a rank one vector space over $R/P$.
%	
%	Conversely, when $R$ is an artinian ring, $R$ is an essential extension of its socle. Thus, since $E(k)$ is injective, if the socle of $R$ is isomorphic to $k$, then there is an embedding $R \subseteq E(k)$, induce by the fact that $k \subseteq R$ is an essential extension. By Corollary \ref{corollary length R}, $\ell(E(k)) = \ell(R)$. Therefore, $E(k) = R$.
%\end{proof}


\begin{theorem}
	Let $(R,\m,k)$ be a local ring, $\widehat{R}$ its $\m$-adic completion, and $E = E_R(k)$. Then,
	\begin{enumerate}
		\item  $E_{\widehat{R}}(k) = E$, and
		\item there is an isomorphism of $\widehat{R}$-modules:
			$$\xymatrix@R=1mm{\widehat{R} \ar[r] & R^{\vee\vee}=\Hom_R(E,E) \\ r \ar@{|->}[r] & (e \mapsto re)}.$$
	\end{enumerate}
\end{theorem}


\begin{proof}
The containment $k \subseteq E$ is an essential extension of $R$-modules, and thus of $\widehat{R}$-modules as well. Given an essential extension $E \subseteq M$ of $\widehat{R}$-modules, $M$ must be $\m$-torsion, since it has the same associated primes (just $\m$). Therefore, $R m = \widehat{R} m$ for each $m \in M$, which implies that $E \subseteq M$ is also an essential extension of $R$-modules. Hence $M = E$, and we conclude that $E = E_{\widehat{R}} (k)$.


Since $E$ is $\m$-torsion, $\Hom_{\widehat{R}}(E,E) = \Hom_R(E,E)$, so we may assume that $\widehat{R}$ is complete for the rest of the proof. Then, we can identify the given map $R\to R^{\vee\vee}$ with the natural map $r\mapsto(\phi \mapsto \phi(r))$. Hence, this map is injective.


When $R$ is artinian, $\ell(R)<\infty$, so the map $R\to R^{\vee\vee}$ is an isomorphism.

For each $i \geqslant 1$, set $R_i := R/\m^i$. The $R_i$-module $E_i = (0 :_E \m^i)$ is the injective hull of $k$ as an $R_i$-module. For each $\varphi \in \Hom_R(E,E)$, $\varphi(E_i) \subseteq E_i$, and thus $\varphi$ restricts to an element of $\Hom_{R_i}(E_i,E_i) = R_i$, where the equality holds because $R_i$ is artinian. Consequently, $\varphi$ restricted to $E_i$ is multiplication by an element $\overline{r_i} \in R_i$, with $r_{i+1} - r_i \in \m^i$. Thus $\varphi$ is multiplication by the element $\varprojlim_i r_i$ in $R$.
\end{proof}

\begin{remark}
	We have a pretty concrete idea of what any injective module in any noetherian ring looks like now. They are direct sums of modules $E_R(R/\p)$ for primes $\p$, and
	\[ E_R(R/\p) \cong E_{R_\p}(R_\p / \p R_\p) \cong  E_{\widehat{R_\p}}(\widehat{R_\p} / \p \widehat{R_\p}) \cong \begin{cases} E_{K \llbracket \underline{x} \rrbracket/I}(K) \cong \ann_I(E_{K\llbracket \underline{x} \rrbracket}(K)) \cong \ann_I({\blue{K[\underline{x^{-1}}]}}) \\ E_{V\llbracket \underline{x} \rrbracket/I}(V/pV) \cong \ann_I(E_{V\llbracket \underline{x} \rrbracket}(V/pV)) \cong \ann_I({\blue{\star}}),
	\end{cases}\]
	where ${\blue{K[\underline{x^{-1}}]}}$ is the continuous hom module you described in the worksheet, and ${\blue{\star}}$ is the analogous mixed characteristic thing you described in the homework. Note that $K\cong R_\p / \p R_\p$.
\end{remark}

\begin{definition}\index{artinian}
	An $R$-module $M$ is \emph{artinian} if every descending chain of submodules of $M$ eventually stabilizes.
\end{definition}

It is evident that submodules and quotient modules of artinian modules are also artinian. We recall that artinian \emph{rings} --- rings that satisfy the DCC condition on ideals --- are necessarily noetherian, and hence have finite length. This is not true for modules.


\begin{corollary}
	For a local ring $(R,\m,k)$, the module $E_R(k)$ is artinian.
\end{corollary}


\begin{proof}
	Consider a chain of submodules $E_R(k) \supseteq E_1 \supseteq E_2 \supseteq \cdots$. Applying the functor $(-)^{\vee}$ yields surjections
	$$\xymatrix{\widehat{R} \ar@{->>}[r] & E_1^{\vee} \ar@{->>}[r] & E_2^{\vee} \ar@{->>}[r] & \cdots}.$$
	The ideals $\ker(\xymatrix{\widehat{R} \ar@{->>}[r] & E_i^{\vee} })$ form an ascending chain of ideals, and thus stabilize. Thus $\xymatrix{E_i^{\vee} \ar@{->>}[r] & E_{i+1}^{\vee}}$ is an isomorphism for $i \gg 0$. Since $(-)^\vee$ is faithful, it follows that $E_i = E_{i+1}$ for $i \gg 0$.
\end{proof}


\begin{theorem}
	Let $(R,\m,k)$ be a local ring and $M$ be an $R$-module. The following conditions are equivalent:
	\begin{enumerate}[(1)]
		\item $M$ is $\m$-torsion and the rank of the socle of $M$ is finite.
		\item $M$ is an essential extension of a $k$-vector space of finite rank.
		\item $M$ can be embedded in a finite direct sum of copies of $E_R(k)$.
		\item $M$ is artinian.
	\end{enumerate}
\end{theorem}


\begin{proof}
	The implications $(1) \Rightarrow (2) \Rightarrow (3) \Rightarrow (4)$ are straightforward.
	To show $(4) \Rightarrow (1)$, consider $x \in M$, and the descending chain $Rx \supseteq \m x \supseteq \m^2 x \supseteq \cdots$, which stabilizes. Therefore, $\m^{t+1} x = \m^t x$ for some $t$, which by NAK implies that $\m^t x = 0$. Therefore, $M$ is $\m$-torsion. Finally, the socle of $M$ is artinian and a $k$-vector space, so it must have finite rank.
\end{proof}

%
%\begin{example}
%	Let $(R,\m,k)$ be a DVR with $\m = Rx$. For example, $R$ may be $k[[x]]$ or the $p$-adic integers. We claim that $E_R(k) \cong R_x/R$. Indeed, it is easy to check that the $R$-module $R_x/R$ is divisible and hence injective, and that the socle of $R_x/R$ is generated as a $k$-vector space by the image of $1/x$.
%\end{example}



\begin{theorem}[Matlis duality]
	Let $(R,\m,k)$ be a complete local ring, and $M$ be an $R$-module.
	\begin{enumerate}
		\item If $M$ is noetherian, then $M^\vee$ is artinian.
		\item If $M$ is artinian, then $M^\vee$ is noetherian.
		\item If $M$ is artinian or noetherian, then the map $M \longrightarrow M^{\vee \vee}$ is an isomorphism.
	\end{enumerate}
\end{theorem}

\begin{proof}
	Write $E = E_R(k)$. If $M$ is noetherian, consider a presentation
	$$\xymatrix{R^m \ar[r] & R^n \ar[r] & M \ar[r] & 0}.$$
	Applying $(-)^{\vee}$, we get an exact sequence 
	$$\xymatrix{0 \ar[r] & M^{\vee} \ar[r] & E^n \ar[r] & E^m}.$$
	The module $(R^n)^{\vee} \cong E^n$ is artinian, hence so is the submodule $M^{\vee}$. Applying $(-)^{\vee}$ again, we get the commutative diagram
	$$\xymatrix{R^m \ar[d]_-{\cong} \ar[r] & R^n \ar[d]_-{\cong} \ar[r] & M \ar[d] \ar[r] & 0 \\
	(R^m)^{\vee \vee} \ar[r] & (R^n)^{\vee \vee} \ar[r] & M^{\vee \vee} \ar[r] & 0}$$
	and thus $M \cong M^{\vee \vee}$.
	
	Similarly, if $M$ is artinian, we note that $R\cong R^{\vee\vee}$ implies $E \cong R^{\vee} \cong R^{\vee \vee \vee} \cong E^{\vee\vee}$. Embed $M$ into some $E^a$; since the cokernel is a quotient of an artinian module, hence artinian, we get a left-exact sequence
	$$\xymatrix{0 \ar[r] & M \ar[r] & E^a \ar[r] & E^b}.$$
	As before, we obtain a commutative diagram
		$$ \xymatrix{ 0 \ar[r] & M\ar[d] \ar[r] &E^a \ar[d]_-{\cong} \ar[r] & E^b \ar[d]_-{\cong}  \\ 
		 0 \ar[r] & M^{\vee \vee} \ar[r] &(E^a)^{\vee \vee} \ar[r] & (E^b)^{\vee \vee} }$$
	 and thus $M \cong M^{\vee\vee}$.
\end{proof}


%\begin{remark}
%	Let $M$ be a finitely generated module over a complete local ring $(R,\m,k)$. One has isomorphisms
%		\begin{align*}
%		\Hom_R(k,M^{\vee}) & \cong \Hom_R(k \otimes_R M, E_R(k)) \\
%		& \cong \Hom_R(M/\m M, E_R(k)) \\
%		& \cong \Hom_k(M/\m M,k). \\
%	\end{align*}
%	
%	Thus the number of generators of $M$ as an $R$-module is the rank of the socle of $M^{\vee}$ as a $k$-vector space. This number is called the {\bf type} \index{type} of $M^{\vee}$.
%\end{remark}

\section{A quick note on graded rings and modules}

Many interesting rings are equipped with an extra structure, a grading, that is helpful in making computations (and is important for compactness properties in algebraic geometry).

\begin{definition} A ring is \emph{$\NN$-graded}\index{$\NN$-graded}\index{graded ring} if it admits a direct sum composition $R=\bigoplus_{i\in \NN} R_i$ such that $R_i R_j \subseteq R_{i+j}$. A ring is graded with respect to an semigroup $S$, if, in the definition above, one replaces $\NN$ with $S$ and $+$ with the semigroup operation.
	
If $R$ is $\NN$-graded, an $R$-module is \emph{$\ZZ$-graded}\index{graded module} if $M=\bigoplus_{n\in \NN} M_i$ and $R_i M_j \subseteq M_{i+j}$. If $R$ is $S$-graded, and $M$ is an $R$-module, $M$ is $S$-graded if the analogous condition holds. We often write $[M]_i$\index{$[M]_i$} to specify the degree $i$ summand of a graded module $M$.

In a graded ring or module, we say an element is \emph{homogeneous}\index{homogeneous} of degree $i$ if it lies in $M_i$. A \emph{homomorphism of graded modules}\index{homomorphism of graded modules} is a module homomorphism $M\to N$ such that $M_i\to N_i$ for all~$i$.

For a graded ring $R$ and $i$ in its grading semigroup, the \emph{$i$-th shift functor}\index{shift} assigns to the graded $R$-module $M$ the graded $R$-module $M(i)$\index{$M(i)$} such that $[M(i)]_j=[M]_{i+j}$. These functors are exact.

For an $\NN$-graded ring $R$ and a positive integer $d$, the \emph{$d$-th veronese subring}\index{veronese subring}\index{$R^{(d)}$} of $R$ is the $\NN$-graded ring $R^{(d)}=\bigoplus_{i\in \NN} R_{di}$. The \emph{$d$-th veronese functor}\index{veronese functor} assigns to a graded $R$-module $M$ the graded $R^{(d)}$-module $M^{(d)}=\bigoplus_{i\in \NN} M_{di}$. We note that these functors are exact.
\end{definition}


\chapter{Local cohomology}

\section{Definitions of local cohomology}

Recall that we defined $\H^i_I(M) := R^i \Gamma_I(M)$. Now, with the theory of injectives we have so far, we can prove some properties about these functors. But first we want to collect some other definitions of local cohomology. Some of our descriptions involve direct limits. We recall a couple of facts about direct limits.

\begin{definition}
	Given a directed system of modules
	\[(M_i)_{i\in \NN} = \left( \xymatrix{\cdots \ar[r] & M_i \ar[r] & M_{i+1} \ar[r] & \cdots} \right)\]
	its \emph{direct limit}\index{direct limit} is the module $M=\varinjlim_{i\in \NN} M_i$, equipped with maps $\iota_i:M_i \to M$ for all $i$, satisfying the property that, if there are maps $\alpha_i:M_i \to N$ that commute with the maps in the system, then there is a unique map $\varphi: M\to N$ such that $\alpha_i=\varphi\circ \iota_i$ for all $i$.
	
This notion is functorial: given two directed systems of complexes, and maps of complexes for each $i$ that commute with the maps in the systems, there is an induced map on the direct limits.

Direct limits can be realized explicitly as follows: every element is represented by a class $(m, i)$ with $m\in M_i$. Two classes $(m,i),(n,j)$ are the same if and only if for some $k\geq\max\{i,j\}$, the images of $m$ and $n$ under the composed transition maps agree in $M_k$. In particular, an element represents the zero class if and only if it is in the kernel of a large composition of the transition map.

Similar considerations hold for systems indexed by an arbitrary poset $P$; this consists of a collection of modules $M_p$ for $p\in P$, and commuting maps $M_p\to M_q$ for all $p\leq q$.
\end{definition}

\begin{remark}
	We defined the tensor product of complexes in terms of homological notation before. The same definition works with cohomological indexing. 
\end{remark}

\begin{lemma} 
$\,$
\begin{enumerate}[(1)]
	\item If
	$$\xymatrix{M_\bullet^{(0)} \ar[r] & M_\bullet^{(1)} \ar[r] & M_\bullet^{(2)} \ar[r] & \cdots}$$
	is a directed system of complexes, then
	$$\H_i \left( \varinjlim_t M_\bullet^{(t)} \right) = \varinjlim_t \H_i \left( M_\bullet^{(t)} \right).$$
	\item Given two directed systems of complexes, $M_\bullet^{(t)}$ and $N_\bullet^{(t)}$, we have
	$$\varinjlim_t M_\bullet^{(t)} \otimes N_\bullet^{(t)} = \left( \varinjlim_t M_\bullet^{(t)} \right) \otimes \left( \varinjlim_t N_\bullet^{(t)} \right).$$
\end{enumerate}
The same considerations hold for arbitrary direct limits.
\end{lemma}


\begin{proposition}
	Let $R$ be a noetherian ring and $I$ an ideal in $R$. For all $i$, there is an isomorphism of functors
	$$\H^i_I(-) \cong \varinjlim_t \Ext^i_R \left( R/I^t, -\right).$$
	Moreover, if $\lbrace I_i \rbrace_i$ is a sequence of ideals such that for all $a \in \NN$ there exist $b, c$ such that $I_b \subseteq I^a$ and $I^c \subseteq I_a$, then
	$$\H^i_I(-) \cong \varinjlim_t \Ext^i_R \left( R/I_t, -\right).$$
\end{proposition}

\begin{proof}
	It is enough to show the later statement. Note that 
	$$\Gamma_I(M) = \bigcup_t \left( 0 :_M I^t \right) = \bigcup_t \left( 0 :_M I_t \right) = \varinjlim \Hom_R(R/I_t,M) \left( = \Hom^{I-cts}_R(R,M) \right).$$
Then, if $M \longrightarrow E^{\bullet}$ is an injective resolution, then
\begin{align*}
	\H^i_I(M) & = \H^i \Gamma_I \left( \xymatrix{0 \ar[r] & E^0 \ar[r] & E^1 \ar[r] & \cdots} \right) \\
	& = \H^i \varinjlim \Hom_R \left( R/I_t, E^{\bullet} \right) \\
	& = \varinjlim \H^i \left( \Hom_R \left( R/I_t, E^{\bullet} \right) \right) \\
	& = \varinjlim \Ext^i_R \left( R/I_t, M \right) 
\end{align*}
It is easy to see that these isomorphisms are functorial.
\end{proof}

One important special case of the ``moreover'' is $\varinjlim \Ext^i_R \left(R/(f_1^b, \ldots, f_n^b), - \right)$. 

\begin{remark}
	Earlier, we saw that Koszul cohomology and $\Ext^\bullet(R/I, -)$ measure similar things, and are equal when $I=(f_1,\dots, f_m)$, is generated by a regular sequence. Since $f_1^t,\dots, f_m^t$ form an $R$-sequence as well in this case, we obtain isomorphisms \[H^i_I(M)\cong \varinjlim_t \Ext^i_R \left( R/(f_1^t,\dots, f_m^t), M \right) \cong \varinjlim_t H^i(f_1^t,\dots, f_m^t;M), \]
	though we should take care that we have the right maps in the directed system.
	
	 In general, Koszul cohomology and $\Ext^\bullet(R/I, -)$ are not the same; we have seen examples in the homework. However, we will soon see that they agree in the direct limit; the isomorphism above holds for all ideals in a noetherian ring!
\end{remark}




	Let $M$ be an $R$-module and $x \in R$. To compute the limit of the system
	$$\xymatrix{M \ar[r]^-x & M \ar[r]^-x & M \ar[r]^-x & M \ar[r]^-x & \cdots}$$
	we can replace $M$ by $M' = M/\Gamma_x M$, where $\Gamma_x M$ are the elements killed by some composition of the maps $\xymatrix{M \ar[r]^-x & M}$.
	$$\xymatrix{M' \ar[r]^-x & M' \ar[r]^-x & M' \ar[r]^-x & \cdots \\ M' \ar[r]^-1 & \frac{1}{x} M' \ar[r]^-1 & \frac{1}{x^2} M' \ar[r]^-1 &}$$ 
	so the direct limit is $M_x$. Note that we have a commutative square
	
	\[\xymatrix{ M' \ar[r]^-{x^t}\ar[d]^-{1} & M' \ar[d]^{1/x^t}\\ M' \ar[r]^-{1} & \frac{1}{x^t} M'},\]
	so we can identify $\xymatrix{M' \ar[r]^-{x^t} & M'}$ with $\xymatrix{M' \ar[r]^-{1} & \frac{1}{x^t} M'}$.
	
	Now consider a directed system of (cohomological) Koszul complexes.
	$$\xymatrix{K^\bullet(1;M) \ar[r] & K^\bullet(x;M) \ar[r] & K^\bullet(x^2;M) \ar[r] & K^\bullet(x^3;M) \ar[r] & \cdots}$$
	that is,
	$$\xymatrix{0 \ar[d] & 0 \ar[d] & 0 \ar[d] & \\
	M \ar[r]^-1 \ar[d]^-1 & M \ar[r]^-1 \ar[d]^-{x} & M \ar[r]^-1 \ar[d]^-{x^2} & \cdots \\
	M \ar[r]^-x \ar[d] & M \ar[r]^-x \ar[d] & M \ar[r]^-x \ar[d] & \cdots \\
	0 & 0 & 0}$$ 

$$\xymatrix@R=5mm@C=5mm{0 \ar[dd] && 0 \ar[dd] && 0 \ar[dd] && &&& 0 \ar[dd]\\
\\
	M \ar[rr]^-1 \ar[dd]^-1 && M \ar[rr]^-1 \ar[dd]^-{1} && M \ar[rr]^-1 \ar[dd]^-{1} && \cdots &&& M \ar[dd]_-1\\
	&&&&&&& \ar@{~>}[r]_-{\varinjlim} & \\
	M' \ar[rr]^-1 \ar[dd] && \frac{1}{x} M' \ar[rr]^-1 \ar[dd] &&  \frac{1}{x^2} M' \ar[rr]^-1 \ar[dd] && \cdots &&& M_x \ar[dd]\\
	\\
	0 && 0 && 0 &&&&& 0}$$ 
	The limit of this system of Koszul complexes is the {\bf \v{C}ech complex} of $x$ on $M$:
	$${\check{C}}^\bullet(x;M) := \left( \xymatrix@R=1mm{0 \ar[r] & M \ar[r] & M_x \ar[r] & {\tiny 0} \\ & \textrm{\tiny{0}} & \textrm{\tiny{1}}} \right)$$
	Given a sequence of elements $f_1, \ldots, f_t \in R$, the maps $\xymatrix{K^\bullet(f_i^t;R) \ar[r] & K^\bullet(f_i^{t+1};R)}$ given by $1$ on $K^0$, $f_i$ on $K^1$, induce maps
	$$\xymatrix@R=2mm{K^\bullet(f_1^n) \otimes \cdots \otimes K^\bullet(f_t^n) \otimes M \ar@{=}[d] \ar[r] & K^\bullet(f_1^{n+1}) \otimes \cdots \otimes K^\bullet(f_t^{n+1}) \otimes M \ar@{=}[d] \\ K^\bullet(f_1^n, \ldots, f_t^n;M) & K^\bullet(f_1^{n+1}, \ldots, f_t^{n+1};M)}$$
	Note that
	$$\varinjlim_n K^\bullet(f_1^n, \ldots, f_t^n;M) = \bigotimes^t_{i=1} \varinjlim K^{\bullet}(f_i^n) \otimes M = \bigotimes^t_{i=1} {\check{C}}^\bullet(f_i) \otimes M.$$
	
\begin{definition}[\v{C}ech complex]\index{\v{C}ech complex}\index{$\check{C}(f_1, \ldots, f_t;M)$}\index{$K^\bullet(f_1^\infty,\dots,f_t^\infty;M)$}	We define the {\bf \v{C}ech complex} of $f_1, \ldots, f_t$ on $M$ as
	$${\check{C}}^\bullet(f_1^n, \ldots, f_t^n;M) = {\check{C}}^\bullet(f_1) \otimes \cdots \otimes {\check{C}}^\bullet(f_t) \otimes M.$$
	This is also sometimes denoted as $K^\bullet(f_1^\infty,\dots,f_t^\infty;M)$.
\end{definition}

\begin{example}
	$$ 
	\xymatrix@R=2mm@C=2mm{
	&&&&&& 0 && 0 && \\ 
	&&&&&&&&&&&&&\\
	&&&& 0 \ar[rr] && M_g \ar[rr]_-{-1} \ar[uu] && M_{fg} \ar[uu] \ar[rr] && 0 &&&&&&  \\ 
	{\check{C}}^\bullet(f,g;M) & = &&&&&&&&&&& = && 0 \ar[rr] && M \ar[rrr]^-{{1 \choose 1}} &&& M_f \oplus M_g \ar[rrr]^-{(1 \,\, -1)} &&& M_{fg} \ar[rr] && 0 && \\
	&&&& 0 \ar[rr] && M \ar[uu]^-{1} \ar[rr]_-{1} && M_f \ar[rr] \ar[uu]_-{1} && 0 &&&&& \\ 
	&&& &&&&& &&&&&&& \\
	&&&& && 0 \ar[uu] && 0 \ar[uu] &&&& \textrm{\tiny{2}} \ar@{..}@[blue][uuuuuullllll] \\
	&&&&&&&&&&& \textrm{\tiny{1}} \ar@{..}@[blue][uuuuuullllll] &&&&&& \\
	&&&&&&&&&& \textrm{\tiny{0}} \ar@{..}@[blue][uuuuuullllll]
	 }  
	$$
\end{example}


As with the Koszul complex, easy inductions show that

\begin{itemize}
	\item $\C(f_1, \ldots, f_t;M) \cong \displaystyle\bigoplus_{\{j_1,\dots,j_i\} \subseteq [t]} M_{f_{j_1} \cdots f_{j_i}}$
	\item The maps between components corresponding to subsets $I, J$ are zero if $I \not\subseteq J$, and $\pm 1$ if $J = I \cup \lbrace k \rbrace$.
\end{itemize}


Note that
$$\varinjlim \H^i (f_1^n, \ldots, f_t^n;M) = \H^i \left( \C (f_1, \ldots, f_t;M) \right) =: \check{H}^i(\underline{f};M).$$\index{$\check{H}^i(\underline{f};M)$}







We will now study these cohomology modules.

\begin{proposition}
	Let $\underline{f} = f_1, \ldots, f_t \in R$ and $I = (f_1, \ldots, f_t)$.
	\begin{enumerate}[(1)]
		\item Given a short exact sequence of $R$-modules
		$$\xymatrix{0 \ar[r] & A \ar[r] & B \ar[r] & C \ar[r] & 0}$$
		there is a long exact sequence
		$$\xymatrix{0 \ar[r] & \check{H}^0(\underline{f};A) \ar[r] & \check{H}^0(\underline{f};B) \ar[r] & \check{H}^0(\underline{f};C) \ar[r] & \check{H}^1(\underline{f};A) \ar[r] & \cdots}.$$
		\item For an arbitrary direct limit system, $\check{H}^j(\underline{f}; \varinjlim M_\lambda) \cong \varinjlim \check{H}^j(\underline{f}; M_\lambda)$.
		\item For any family of modules $\{M_\lambda\}_{\lambda\in \Lambda}$, $\check{H}^j(\underline{f}; \bigoplus_{\lambda\in \Lambda} M_\lambda) \cong \bigoplus_{\lambda\in \Lambda} \check{H}^j(\underline{f}; M_\lambda)$.
		\item (invariance of base)\index{invariance of base} If $\xymatrix{R \ar[r]^-\varphi & S}$ is a ring map, $M$ an $S$-module, then
		$$\check{H}^j(\underline{f}; \, _{\varphi} M) \cong \, _{\varphi}\!\check{H}^j(\underline{\varphi({f})};  M).$$
	\end{enumerate}
\end{proposition}


\begin{proof}
	$\,$
	\begin{enumerate}[(1)]
		\item Since $\check{C}^\bullet(\underline{f};R)$ consists of flat modules,
		$$\xymatrix@R=2mm{0 \ar[r] & \check{C}^\bullet(\underline{f};A) \ar[r] & \check{C}^\bullet(\underline{f};B) \ar[r] & \check{C}^\bullet(\underline{f};C) \ar[r] & 0 \\ &
		\check{C}^\bullet(\underline{f};R) \otimes A \ar@{=}[u] & \check{C}^\bullet(\underline{f};R) \otimes B \ar@{=}[u] & \check{C}^\bullet(\underline{f};R) \otimes C \ar@{=}[u]}$$
		is a short exact sequence of complexes, so this induces a long exact sequence in cohomology.
		
		\item \begin{align*} \check{H}^j(\underline{f};  \varinjlim M_\lambda) = \H^j(\check{C}^\bullet(\underline{f}) &\otimes \varinjlim M_\lambda ) = \H^j(\varinjlim (\check{C}^\bullet(\underline{f})\otimes  M_\lambda)) \\
		&=\varinjlim \H^j( \check{C}^\bullet(\underline{f})\otimes  M_\lambda)  
		=\varinjlim \check{H}^j(\underline{f};  M_\lambda).\end{align*}
		\item This is easy to see, since the \v{C}ech complex is compatible with the direct sum decomposition.
		\item Follows from the same property noted for Koszul complexes.\qedhere
	\end{enumerate}
\end{proof}


\begin{theorem}[Fundamental Theorem of Local Cohomology]
	Let $R$ be a noetherian ring and $I = (f_1, \ldots, f_t)$ an ideal. Then, for all $R$-modules $M$,
	$$\xymatrix@R=5mm@C=5mm{R^i\Gamma_I(M)  \ar@{}[r]|*=0[@]{\cong}  \ar@{}[d]|*=0[@]{\cong} & \check{H}^i(\underline{f};M)  \ar@{}[d]|*=0[@]{\cong} \\ 
	\displaystyle\varinjlim_n \Ext^i_R(R/I^n,M)  \ar@{}[r]|*=0[@]{\cong} & \displaystyle\varinjlim_n \H^i (f_1^n, \ldots, f_t^n;M)}$$
	These isomorphisms are functorial in $M$ and extend to isomorphisms of long exact sequences given a short exact sequence
	$$\xymatrix{0 \ar[r] & A \ar[r] & B \ar[r] & C \ar[r] & 0}.$$
\end{theorem}


\begin{proof}
	We have seen that $\Gamma_I(M) \cong \displaystyle\varinjlim_n \Ext^i_R(R/I^n,M)$ and $\check{H}^i(\underline{f};M) \cong \displaystyle\varinjlim_n \H^i (f_1^n, \ldots, f_t^n;M)$. To show that $R^i\Gamma_I(M) \cong \check{H}^i(\underline{f};M)$, we proceed in the following steps:
	\begin{enumerate}[Step 1:]
		\item Show $\Gamma_I(M)$ and $\check{H}^0(\underline{f};M)$ are canonically isomorphic.
		\item Show that $\check{H}^{>0}(\underline{f};E) = 0$ for any injective module $E$.
		\item Use the previous steps to conclude the proof.
	\end{enumerate}
	\begin{enumerate}[Proof of Step 1:]
		\item 
		\begin{align*}
			\check{H}^0(\underline{f};M) & = \H^0 \left( \xymatrix@C=5mm{0 \ar[r] & M \ar[r] & \oplus_i M_{f_i}} \right) \\
			& = \lbrace m \in M \, | \, \left[ \frac{m}{1} \right] = 0 \textrm{ in } M_{f_i} \text{ for all } i \rbrace \\
			& = \lbrace m \in M \, | \, f_i^{\gg 0} \cdot m = 0  \text{ for all } i \rbrace \\
			& = \Gamma_I(M).
		\end{align*}
		We note that the last equality uses finite generation of $I$ in a crucial way; only the containment ``$\supseteq$'' holds in general without this.
		\item By the structure theorem for injectives over noetherian rings, $E \cong \oplus E_\lambda$, where 
		$$E_{\lambda} = E_R(R/P) \cong E_{R_P} \left( R_P / P R_P \right).$$
		By the direct sum property, we may replace $E$ by $E_R(R/P)$.
	By the invariance of base property, we may replace $R$ by $R_P$. Now, $E$ is an injective hull of the residue field, so it is artinian, and we write $E = \varinjlim E_t$ where the $E_t$ are modules of finite length. It suffices to show that the vanishing holds for modules of finite length.
	
	We claim that if the desired vanishing holds for $M=K$, then it holds for all modules of finite length (which would complete Step 2).
	We induce on the length of $L$. If $1<\ell(M)<\infty$, then write $0\to L \to M \to K\to 0$, with $\ell(L)<\ell(M)$. The long exact sequence gives
	\[\cdots \to \check{H}^i(\underline{f};L) \to \check{H}^i(\underline{f};M) \to \check{H}^i(\underline{f};K) \to \cdots,\]
	and by the induction hypothesis,
		\[\cdots \to 0 \to \check{H}^i(\underline{f};M) \to 0 \to \cdots,\]
		for $i>0$, establishing the claim.
		
	 Applying the invariance of base property again, we may assume without loss of generality that $R = K$.
		
		There are multiple ways to deal with this case. We note that if $f_i=0$, then $\check{C}^\bullet(f_i;K)= (0 \to K \to 0)$, and if $f_i\neq 0$, then $\check{C}^\bullet(f_i;K)= (0 \to K \stackrel{1}{\longrightarrow} K \to 0)$. It is then an easy exercise, which we leave to you, to show that $\check{H}^i(\underline{f};K)=K$ for $i=0$ and $0$ for $i>0$ if all $f_i$'s are zero, and that $\check{H}^i(\underline{f};K)=0$ for all $i$ otherwise.
		
		Of course, this step relied crucially on the structure theorem for injectives over noetherian rings.
 
		\item This follows in complete generality from the previous steps.\index{looks like a functor, smells like a functor}
		
		We proceed by induction on $i$, with the base case being Step 1. Now, let $i>0$.
		
We assume that we have a canonical isomorphism between $H^j_I(M)$ and $\check{H}^j(\underline{f};M)$ for all $M$ and all $j<i$. Embed $M$ into an injective $E$ to get a short exact sequence
\[ 0 \to M \to E \to W \to 0.\]
Then, there is a commutative diagram

$$\xymatrix{R^{i-1}\Gamma_I(E) \ar[r] \ar[d]^{\cong} & R^{i-1}\Gamma_I(W) \ar[r] \ar[d]^{\cong} & R^{i}\Gamma_I(M)\ar[r] & 0 \\ \check{H}^{i-1}(\underline{f};E) \ar[r]  & \check{H}^{i-1}(\underline{f};W) \ar[r]  & \check{H}^{i}(\underline{f};M)\ar[r] & 0 ,}$$ 
where bottom zero on the right comes from Step 2.
This induces an isomorphism $H^{i}_I(M)\cong \check{H}^{i}(\underline{f};M)$. We omit the verification that this isomorphism does not depend on the choice of embedding into an injective, and that these isomorphisms are compatible with the connecting maps of long exact sequences.
	\end{enumerate}	
\end{proof}

These four different descriptions 
$$\xymatrix@R=5mm@C=5mm{{\blue{(1)}} \ R^i\Gamma_I(M)  \ar@{}[r]|*=0[@]{\cong}  \ar@{}[d]|*=0[@]{\cong} & {\blue{(2)}} \ \check{H}^i(\underline{f};M)  \ar@{}[d]|*=0[@]{\cong} \\ 
	{\blue{(1')}} \ \displaystyle\varinjlim_n \Ext^i_R(R/I^n,M)  \ar@{}[r]|*=0[@]{\cong} & {\blue{(2')}} \ \displaystyle\varinjlim_n \H^i (f_1^n, \ldots, f_t^n;M)}$$
of local cohomology all have different advantages for attacking problems. 

The descriptions (1) and (1') are computed from injective resolutions, as opposed to (2) and (2'), which are computed from generators. We might think of the former as being more natural, and the latter as being more flexible.

 We note that the descriptions (1) and (2) are made entirely from ``big'' modules that are somehow nice, whereas the descriptions (1') and (2') realize local cohomology as limits of finitely generated modules (if $M$ is). Some natural questions to ask already are whether we can realize the limits in (1') and (2') as filtered limits / unions, and whether the resulting limits are determined in some sense by finite stages in the limit system. We will see a few results of this form, but it's worth noting that questions of this form are an active topic of research.

\section{Worksheet on Computing local cohomology using the \v{C}ech complex}

	
\begin{enumerate}[1)]\setcounter{enumi}{0}
	
	\item\index{116esque game} If $I=(f_1,\dots,f_n)$ is an $n$-generated ideal, then
	\[ \H^n_I(M) = \text{ cohomology of } \left( \bigoplus_{i=1}^n M_{f_1 \cdots \widehat{f_i} \cdots f_n} \to M_{f_1 \cdots f_n} \to 0 \right), \]
	so elements in the $n$-th local cohomology can be realized as equivalence classes of fractions.
	
	Show that \[\left[\frac{m}{f_1^t\cdots f_n^t}\right] \neq 0 \text{ in } H^n_I(M) \text{ if and only if } f_1^k \cdots f_t^k m \notin \left( f_1^{t+k}, \ldots, f_n^{t+k} \right)M \textrm{ for all } k\geq 0.\]
	

	
	
	
	\item Let $k$ be a field, $R=k[x_1,\dots,x_n]$, and $\m=(x_1,\dots,x_n)$.
	
	
	\begin{enumerate}[a)]
			\item Show that $\displaystyle\left[ \frac{\underline{x}^{\underline{\alpha}}}{x_1^t\cdots x_n^t} \right]$ is nonzero in $\H^n_\m(R)$ if and only if $\underline{x}^{\underline{\alpha}} \notin (x_1^t,\dots, x_n^t)$.
	
	
	\item Compute $\H^n_\m(R)$: give a $k$-basis and describe the $R$-module structure.
	
		
		\item Show that $\H^1_{(x,y)}(k[x,y])=0$. Beware that a potential element is represented by a pair of elements in $R_x$ and $R_y$, and that problem \#1 does not apply.
	\end{enumerate}
	

	
	\item Let $R$ and $\m$ be as above, and $S = k[\underline{x}]^{(d)}$ be the subalgebra generated by the polynomials whose degrees are multiples of $d$. Let $\n$ be its homogeneous maximal ideal (the ideal generated by all $d$-forms in $S$).
	

	
	
	
	\begin{enumerate}[a)]
		\item Show that $\H^i_{(x_1,\dots,x_n)}(R)=\H^i_{(x_1^d,\dots,x_n^d)}(R)$ for all $i$.
		

		
		\item Show that $(R_{x_1^d\cdots x_i^d})^{(d)}=S_{x_1^d\cdots x_i^d}$ for all $i$.
		

		\item Show that $\check{C}^{\bullet}(x_1^d,\dots,x_n^d;S)=\check{C}^{\bullet}(x_1^d,\dots,x_n^d;R)^{(d)}$; i.e., this is the complex consisting of sums of elements whose degree is a multiple of $d$ in $\check{C}^{\bullet}(x_1^d,\dots,x_n^d;R)$.
		

		
		\item Conclude that $\H^n_\n(S)=\H^n_\m(R)^{(d)}$. Find two linearly independent elements of highest degree in $\H^2_{(x^3,x^2y,xy^2,y^3)}(k[x^3,x^2y,xy^2,y^3])$.
	\end{enumerate}
	

	
	\item Let $T =\displaystyle \frac{k[x,y,u,v]}{(xu-yv)}$. Note that $T$ admits an $\NN^2$-grading via 
	\[ \deg(x)=\begin{bmatrix} 1 \\ 0 \end{bmatrix} ,\deg(y)= \begin{bmatrix} 0 \\ 1 \end{bmatrix}, \deg(u)= \begin{bmatrix} 0 \\ 1  \end{bmatrix}, \deg(v)= \begin{bmatrix} 1 \\ 0 \end{bmatrix}; \]
	since the defining equation is homogeneous with respect to this grading, we get a well-defined grading on $T$.
	

	
	
	
	\begin{enumerate}
		\item Show that $\displaystyle \left( \frac{v}{x}, \frac{u}{y} \right)$ is a cocycle in the \v{C}ech complex $\check{C}^1(x,y;T)$.
		

		\item Show that the class $\displaystyle \left[ \frac{v}{x}, \frac{u}{y} \right]$ of the cocycle in the previous part gives a nonzero class in $\H^1_{(x,y)}(T)$.
		

		
		\item Let $\displaystyle \eta_a=\left[\frac{v^{a-1} y^{a-1}}{x^a y^a}\right]\in \check{H}^2(x,y;T)$.
		Use the grading defined above to show that $\eta_a\neq 0$ in $\H^2_{(x,y)}(T)$.
		

		
		\item Show that each of the elements $\eta_a$ is killed by the ideal $\m=(x,y,u,v)$. Conclude that the socle of this local cohomology module (the submodule annihilated by the maximal ideal $\m$) is infinite-dimensional.

		
		\item Congratulate yourself; you have disproven a conjecture of Grothendieck!
		
	\end{enumerate}
	

	
	\item Let $R = \displaystyle k\begin{bmatrix} u & v & w \\ x & y & z\end{bmatrix}$ and $\p=(uy-vx,uz-wx,vz-wy)$. Is $\H^3_{\p}(R)$ nonzero?
\end{enumerate}


\begin{comment}
If $I=(f_1,\dots,f_n)$ is an $n$-generated ideal, then
\[ H^n_I(M) = \text{ cohomology of } \left( \bigoplus_{i=1}^n M_{f_1 \cdots \widehat{f_i} \cdots f_n} \to M_{f_1 \cdots f_n} \to 0 \right), \]
so elements in the $n$-th local cohomology can be realized as equivalence classes of elements $\frac{m}{f_1^t\cdots f_n^t}$. We need to see when such a class is zero or not.

$$	\left[ \frac{m}{f_1^n \cdots f_t^n} \right] \neq 0 \textrm{ in } \H^n_{(f_1, \ldots, f_n)} (M)$$
$\Leftrightarrow$
$$\left[ \frac{m}{f_1^n \cdots f_t^n} \right] \notin \im \left( \bigoplus R_{f_1 \cdots \widehat{f_i} \cdots f_t} \right) \textrm{ in } M_{f_1 \cdots f_t}$$
$\Leftrightarrow$
$$ \frac{m}{f_1^n \cdots f_t^n}  \neq \frac{m_i}{f_1^{n+k} \cdots \widehat{f_i^{n+k}} \cdots f_t^{n+k}} \textrm{ for all } k, \textrm{ and all } m_i \in M$$
$\Leftrightarrow$
$$f_1^k \cdots f_t^k m \neq \sum f_i^{n+k} m_i \textrm{ for all } k$$
$\Leftrightarrow$
$$f_1^k \cdots f_t^k m \notin \left( f_1^{n+k}, \ldots, f_t^{n+k} \right)M \textrm{ for all } k.$$


\begin{example}
	Let $k$ be a field, $R = k[x_1, \ldots, x_n]$, and $\m = ( \underline{x} )$. From the \v{C}ech complex, we see that
	
	$$\H^n_\m(R) = \frac{R_{x_1 \cdots x_n}}{\displaystyle\sum_i R_{x_1 \cdots \widehat{x_i} \cdots x_n}}.$$

	As noted above, a class $[\frac{f}{x_1^t\cdots x_n^t}]$ is nonzero if and only if $(x_1\cdots x_n)^k f \notin (x_1^{t+k},\dots, x_n^{t+k})$ for all~$k$. An polynomial in a polynomial ring is contained in a monomial ideal if and only if each of its monomials is, so, writing $f=\sum c_{\underline{\alpha}}\underline{x}^{\underline{\alpha}}$ as a sum of monomials, $f$ gives a nonzero class if and only if one of its monomials satisfies 
	\[ (x_1\cdots x_n)^k \underline{x}^{\underline{\alpha}} \notin (x_1^{t+k},\dots, x_n^{t+k}) \ \text{ for all } k,\]
	which happens if and only if $\alpha_i<t$ for all $t$.
	
	In summary, $\H^n_\m(R)$ is the $k$-vector space structure
	$$\bigoplus_{\textrm{all } a_i > 0} k \cdot \frac{1}{x_1^{a_1} \cdots x_n^{a_n}},$$
	with $R$-module structure given by
	$$x_1^{b_1} \cdots x_n^{b_n} \cdot \frac{\gamma}{x_1^{a_1} \cdots x_n^{a_n}} =
	\left\lbrace \begin{array}{ll}
	\frac{\gamma}{x_1^{a_1-b_1} \cdots x_n^{a_n-b_n}} & \textrm{ if all } b_i < a_i \\
	0 & \textrm{otherwise.}
	\end{array} \right.$$
\end{example}


\begin{remark}
	If $R$ is a graded ring, $M$ a graded module, and $I$ is an ideal generated by homogeneous elements $f_1,\dots,f_t$, then the \v{C}ech complex $\check{C}^{\bullet}(\underline{f};M)$ is a complex of graded modules. This endows $H^i_I(M)$ with a grading. One could alternatively define injective objects and resolutions in the category of graded $R$-modules, and pursue the other definitions of local cohomology. The Fundamental Theorem above holds with these definitions, are there are some advantages to developing this point of view. For our purposes this semester, this will not be necessary.
\end{remark}




\begin{example}[The $d$-th Veronese subring]
	Let $R = k[\underline{x}]$ be a polynomial ring with $\m = ( \underline{x} )$ and $S = k[\underline{x}]^{(d)}$ be the subalgebra generated by the polynomials whose degrees are multiples of $i$. Let $\n$ be its homogeneous maximal ideal (the ideal generated by all $d$-forms in $R$). Since $\Gamma_{\m}(-)=\Gamma_{(x_1^d, \ldots, x_n^d)}(-)$ as functors, $\H^i_{\m}(-)=\H^i_{(x_1^d, \ldots, x_n^d)}(-)$, and in particular,
	$$\H^n_{\m}{(R)} = \frac{R_{x_1^d \cdots x_n^d}}{\displaystyle\sum_i R_{x_1^d \cdots \widehat{x_i^d} \cdots x_n^d}}.$$
	
	Applying the $d$-th veronese functor to the \v{C}ech complex $\check{C}^\bullet(x_1^d,\dots,x_n^d)$, we get that
	$$\H^n_{\n}(S) = \left( \H^n_{\m}({R}) \right)^{(d)}.$$
	
	For example, when $n = 2$ and $d=3$,
	$$\H^2_{\n}{(k[x^3,x^2y,xy^2,y^3])} = k \left< \frac{1}{x^2y}, \frac{1}{xy^2}, \frac{1}{x^5y}, \frac{1}{x^4y^2}, \ldots, \frac{1}{xy^5}, \frac{1}{x^8y}, \ldots \right>.$$
\end{example}


\begin{example}
	Let $T = \frac{k[x,y,u,v]}{(xu-yv)}$. The class $\left[ \frac{x}{v}, \frac{y}{u} \right] \in \H^1_{(x,y)}(T)$ is nonzero. It is a cycle, since in $T_{xy}$,
	$$\frac{xu}{uv} - \frac{yv}{uv} = 0.$$
	This does not come from an element of $R$ (degree $0$, no way!).
	
	The second local cohomology of the same ideal is also nonzero. There are many nonzero elements, but I want to find some that are the ``biggest'' in some sense. Set $\nu_a={\left[\frac{v^{a-1}}{x^a y}\right]}=\left[\frac{v^{a-1} y^{a-1}}{x^a y^a}\right]$. We claim that each $\nu_a$ is nonzero in $\H^2_{(x,y)}(T)$. For this, we note that $T$ admits an $\NN^2$-grading: set the weights of $x,y,u,v$ to be
	\[ \begin{bmatrix} 1 \\ 0 \end{bmatrix} , \begin{bmatrix} 0 \\ 1 \end{bmatrix}, \begin{bmatrix} 0 \\ 1  \end{bmatrix}, \begin{bmatrix} 1 \\ 0 \end{bmatrix}, \]
	respectively; since the defining equation is homogeneous with respect to these weights, this gives a well-defined grading on $T$.
	
	Then, the degrees of the elements $(xy)^t (vy)^{a-1}$, $x^{t+a}$, and $y^{t+a}$ are,
		\[ \begin{bmatrix}
		t+a-1 \\ t+a-1  \end{bmatrix} , \begin{bmatrix} t+a \\ 0 \end{bmatrix}, \begin{bmatrix} 0 \\ t+a \end{bmatrix}, \]
		respectively, so by degree considerations, $(xy)^t (vy)^{a-1} \notin (x^{t+a}, y^{t+a})$, and hence each $\nu_a\neq 0$ in $\H^2_{(x,y)}(T)$.
\end{example}

\begin{exercise}
	Show that each $\nu_a$ is killed by the ideal $(x,y,u,v)$ in $T$, and conclude that the socle of $\H^2_{(x,y)}(T)$ is an infinite-dimensional vector space.
\end{exercise}

\end{comment}


\section{Basic properties}

Let's collect some basic properties of local cohomology. We note that many (but not all) of the following facts can be proven quickly from more than one characterization of local cohomology.

\begin{proposition}
	Let $R$ be a noetherian ring, $I$ an ideal, and $M$ an $R$-module. 
	Let $\psi:R\to S$ be a ring homomorphism, and $N$ an $S$-module.
	\begin{enumerate}
		\item $\H^i_I(M)$ is $I$-torsion for every $i\geq 0$.
		\item If $\sqrt{J}=\sqrt{I}$, then $\H^i_I(M)=\H^i_J(M)$ for every $i\geq 0$.
		\item (Invariance of base)\index{invariance of base} $\H^i_I(_\psi N)$ has a natural $S$-module structure, and $\H^i_I(_\psi N)\cong \H^i_{\psi(I)S}(N)$ as $S$-modules. We often write $\H^i_I(N)=\H^i_{IS}(N)$ to abbreviate this when the map is implicit.
		\item For any arbitrary direct limit system, $\H^i_I(\varinjlim M_\lambda) \cong \varinjlim \H^i_I(M_\lambda)$.
		\item (Flat base change)\index{flat base change} If $\psi$ is flat, then
		$ S \otimes_R \H^i_I(M)\cong \H^i_I(S \otimes_R M) \cong \H^i_{IS}(S \otimes_R M). $
		\item If $\p\in \Spec(R)$, then $\H^i_I(M)_\p \cong \H^i_{I_\p}(M_\p)$.
	\end{enumerate}
\end{proposition}
\begin{proof}
	\begin{enumerate}
		\item Any submodule or quotient module of an $I$-torsion module is $I$-torsion. Thus, the cohomology of a complex of $I$-torsion modules, e.g., $\Gamma_I(E^\bullet)$ for some injective resolution $M\to E^\bullet$, is also $I$-torsion.
		\item The functors $\Gamma_I$ and $\Gamma_J$ are the same, so they yield the same thing when applied to an injective resolution.
		\item For any $x\in S$, the $S$-linear map $N\stackrel{\cdot x}{\longrightarrow} N$ is the same as the $R$-linear map $_\psi N\stackrel{\cdot x}{\longrightarrow} {_\psi N}$; this gives a map $\H^i_I(_\psi N) \stackrel{\cdot x}{\longrightarrow} \H^i_I(_\psi N)$ by functoriality; it follows from functoriality that the map $\cdot xy$ agrees with the composition of maps $\cdot x$ and $\cdot y$, so this is an $S$-module action.
		
		The noted isomorphism follows from the \v{C}ech cohomology isomorphism $\check{H}^i({\underline{f}};{ _\psi N})\cong \check{H}^i(\underline{\psi(f)};N)$.
		
		\item This again follows from the \v{C}ech cohomology statement.
		
		\item $\check{C}^\bullet (\underline{f};M) \otimes_R S \cong \check{C}^\bullet (\underline{f\otimes 1};M \otimes_R S)$. By flatness of $S$, cohomology commutes with taking the tensor product.
		
		\item Special case of flat base change.
	\end{enumerate}
\end{proof}

We will find that we have the best understanding of local cohomology modules $\H^i_I(M)$ in two situations: when $I$ is a maximal ideal, or when $M=R$ is a regular ring. Apropos the first of these settings:

\begin{proposition}
	Let $R$ be a noetherian ring, $I$ an ideal, and $M$ an $R$-module. Let $\m$ be a maximal ideal of $R$.
	\begin{enumerate}
		\item If $M$ is finitely generated, then $\H^i_\m(M)$ is artinian for all $i$.
		\item $\H^i_\m(M)\cong \H^i_\m(M) _\m \cong \H^i_{\m R_\m}(M_\m)$.
		\item If $(R,\m)$ is local, then $\H^i_\m(M)\cong \H^i_{\m \widehat{R}}{(\widehat{R} \otimes_R M)}$. In particular, if $M$ is finitely generated, then $\H^i_\m(M)\cong \H^i_{\m \widehat{R}}{(\widehat{M})}$.
		\item If $(R,\m)\to (S,\n)$ is a local homomorphism, and $S$ is module-finite over the image of $R$, then $\H^i_{\m}(S)=\H^i_{\n}(S)$.
	\end{enumerate}
\end{proposition}
\begin{proof}
	\begin{enumerate}
		\item By Problem \#6 of HW \#1, if $M\to E^{\bullet}$ is an injective resolution,
		\[\Gamma_{\m}(E^\bullet) = 0 \to E_R(R/\m)^{\mu(0,\m)}\to E_R(R/\m)^{\mu(1,\m)}\to \cdots. \]
		The Bass number $\mu(i,\m)(M)$ is finite, so the complex above is a complex of artinian modules. Thus, $H^i_\m(M)$ is a quotient of a submodule of a finite direct sum of copies of $E_R(R/\m)$, hence, artinian.
		\item If $M$ is $\m$-torsion, then any element outside of $\m$ acts on $M$ invertibly (check!). Then the second is a special case of 6 above.
		
		\item By flat base change, $\widehat{R} \otimes_R \H^i_\m(M) \cong \H^i_{\m\widehat{R}}(\widehat{R} \otimes_R M)$. Since $\H^i_\m(M)$ is $\m$-torsion, it is already the same as $\widehat{R} \otimes_R \H^i_\m(M)$.
		
		\item $\H^i_{\m}(S)=\H^i_{\m S}(S)=\H^i_{\n}(S)$, since $\sqrt{\m S}=\n$.
	\end{enumerate}
\end{proof}

\begin{remark}
	Both \#1 and \#2 of the previous proposition fail for the module $\displaystyle \H^2_{(x,y)}\left(\frac{K[x,y,u,v]}{(xu-yv)}\right)$ from worksheet \#3, with $\m$ replaced by $\p=(x,y)$.
\end{remark}

We want to note now that if $R$ is a graded ring, $M$ a graded module, and $I$ a homogeneous ideal (i.e., an ideal generated by homogeneous elements $f_1,\dots,f_t$) then the local cohomology modules $\H^i_I(M)$ are graded as well. This can be seen from the \cC ech complex:

\[ 0 \to M \to \bigoplus_{1\leq i \leq t} M_{f_i} \to \bigoplus_{1\leq i < j \leq t} M_{f_i f_j} \to \cdots \to \bigoplus_{1\leq i \leq t} M_{f_1
	\cdots \widehat{f_i} \cdots f_t} \to M_{f_1\cdots f_t} \to 0,  \]
which is evidently a complex of graded modules in this case.

We could also see the grading from the other descriptions of local cohomology. This clear for the Koszul description, and is easily seen to give the same grading. There is also a classification of which graded modules are injective \emph{as objects in the category of graded modules}. This endows the other two descriptions of local cohomology with a grading, and the Fundamental Theorem is compatible with this extra structure. We won't develop this approach (unless I change my mind!), but note that it is carried out throughly in Bruns \& Herzog as well as Brodmann \& Sharp.


\section{Basic vanishing theorems}

Our goal now is to understand, for an ideal $I$ in a noetherian ring $R$, and an $R$-module $M$, what are the least and greatest $i$, respectively, for which $\H^i_I(M)\neq 0$.

There is an obvious guess (and obvious lower bound) for the least nonvanishing index: the depth of $I$ on $M$. This guess turns out to be correct.

\begin{theorem}
	Let $R$ be a noetherian ring, $I$ an ideal, and $M$ a finitely generated $R$-module. Then,
	\[ \min\{ i \ | \ \H^i_I(M)\neq 0 \} = \depth_I(M)\,. \]
	Our convention is that $\min(\varnothing) =\depth_I(M)=\infty$ if $IM=M$.
	In particular, if $\p$ is prime and $R$ is Cohen-Macaulay, then 
	\[ \min\{ i \ | \ \H^i_\p(R)\neq 0 \} = \height(\p)\,. \]
\end{theorem}
\begin{proof}
	If $IM=M$, then there is some $f\in I$ that acts as the identity on $M$, so $I^n \H^i_I(M) = f^n \H^i_I(M) = \H^i_I(M)$ for all $n$. On the other hand, $\H^i_I(M)$ is $I$-torsion, so it must be the zero module.
	
	We now assume that $IM\neq M$ and argue by induction on the depth.
	
	If $\depth_I(M)=0$, then every element of $I$ is a zerodivisor on $M$, so $I$ is contained in the union of the associated primes of $M$, and hence in some associated prime $\p$ of $M$ by prime avoidance. Then, the copy of $R/\p$ in $M$ is killed by $I$, hence nonzero in $\H^0_{I}(M)$.
	
	Now, if the depth is $d>0$, take a regular element $x\in I$ on $M$. The SES
	\[0 \to M \stackrel{x}{\longrightarrow} M \to M/xM \to 0\]
	yields the LES
	\[ \cdots \to H^{i-1}_I(M) \to H^{i-1}_I(M/xM) \to H^{i}_I(M) \stackrel{x}{\longrightarrow} H^{i}_I(M) \to \cdots. \]
	For $i<d$, we obtain that $x$ is a nzd on $H^{i}_I(M)$, but this module is $I$-torsion (hence $x$-torsion), so it must be zero.
	Then, the LES shows that $0\neq H^{d-1}_I(M/xM)$ injects into $H^{i}_I(M)$, so the latter is nonzero.
\end{proof}

We turn our attention to the top nonvanishing local cohomology module. This will be of recurring interest, so we give it some nomenclature.

\begin{definition} Let $R$ be a ring, $I$ an ideal, and $M$ an $R$-module. The \emph{cohomological dimension}\index{cohomological dimension}\index{$\cd(I,M)$} of $I$ on $M$ is
	\[ \cd(I,M):=\max\{ i \ | \ \H^i_I(M)\neq 0 \}. \]
\end{definition}

This is closely related to another invariant of independent interest.

\begin{definition} Let $R$ be a ring, $I$ an ideal. The \emph{arithmetic rank}\index{arithmetic rank}\index{$\ara(I)$} of $I$ is
	\[\ara(I):= \min\{ t \ | \text{ there exist } f_1,\dots,f_t \text{ such that } \sqrt{I}=\sqrt{(f_1,\dots,f_t)} \}. \]
\end{definition}

The following fact, now easy to prove, is one of the key points to many applications of local cohomology. 

\begin{theorem}\label{theorem:cd-ara} Let $R$ be a noetherian ring, $I$ an ideal. Then
	$\ara(I) \geq \cd(I,M)$  for all $R$-modules~$M$.
\end{theorem}
\begin{proof}
	Let $\sqrt{(f_1,\dots, f_t)}=\sqrt{I}$. Then $\H^i_I(M)=\check{H}^i(f_1,\dots, f_t;M)$, and the latter vanishes for $i>t$, since the \v{C}ech complex on $t$ elements lives only in cohomological degrees less than or equal to $t$.
\end{proof}

This Theorem is useful both for understanding rank and for understanding cohomological dimension. We will employ it for the latter purpose first.

\begin{example}
	Let $K$ be a field, and $\displaystyle T=\frac{K[x,y,u,v]}{(xu-yv)}$. Let $I=(x,y)$. We saw in worksheet \#3 that $\H^2_I(T)\neq 0$. We claim that the support of $\H^2_I(T)$ is $\V((x,y,u,v))$, so $\Ass(\H^2_I(T))=\{(x,y,u,v)\}$. If $\p$ is a prime that does not contain $x$ or $y$, then $I_\p$ is the unit ideal, so $\H^2_I(T)_\p=\H^2_{I_\p}(T_\p)=0$. If $\p$ does not contain $u$, then $x=\frac{yv}{u}$ in $T_\p$, so $I_\p=(y)$. Thus, $\H^2_I(T)_\p=\H^2_{I_\p}(T_\p)=0$. Similarly, if $\p$ does not contain $v$, the same vanishing occurs.
\end{example}

\begin{proposition}
	Let $R$ be a noetherian ring, $I$ an ideal. For any $R$-module,
	$\cd(I,M)\leq \cd(I,R)$.
\end{proposition}
\begin{proof}
	Let $c=\cd(I)$. Since local cohomology commutes with direct sums, we have that $\H^i_I(F)=0$ for any free module $F$ and any $i>c$. Now, given an arbitrary module $M$, take a short exact sequence
	\[ 0\to M' \to F \to M \to 0 \]
	with $F$ free. The LES of local cohomology gives isomorphisms
 $\H^{i+1}_I(M')\cong \H^{i}_I(M)$ for all $i>c$. Repeating this, we find for all $a>0$, that there is some module $L$ such that $\H^i_I(M)\cong \H^{i+a}_I(M^{(a)})$. But, since $I$ is finitely generated, $\ara(I)$ is finite, and $\cd(I,(M^{(a)})$ is less than this number for all modules. Hence, we must have that $\H^i_I(M)=0$.
\end{proof}

Following the last proposition, we write $\cd(I)$ for $\cd(I,R)$.\index{$\cd(I)$} When $I=\m$ is a maximal ideal, we can say a bit more about cohomological dimension. Recall that, by the dimension\index{dimension} of a module, we mean simply the dimension of $R/\ann(M)$. We note that, if $M$ is finitely generated, this agrees with the dimension of the support of $M$ as a subset of $\Spec(R)$, but this is \emph{not} true if $M$ is arbitrary (e.g. take $M=E_R(k)$ for $R$ of positive dimension).

\begin{proposition}
	Let $(R,\m)$ be local, and $M$ an $R$-module. Then $\cd(\m,M)\leq \dim(M)$.
\end{proposition}
\begin{proof}
	By the invariance of base property, we may replace $R$ by $R/\ann(M)$, and $\m$ by its image there, thus we can assume that $\dim(M)=\dim(R)$. The maximal ideal of $R$ is generated by $\dim(R)$ elements up to radical, so $\cd(\m,M)\leq \dim(R)$, as required.
\end{proof}

\begin{corollary}
	Let $(R,\m)$ be local. The ring $R$ is Cohen-Macaulay if and only if $\H^i_\m(R)= 0$ for all $i\neq \dim(R)$. 
\end{corollary}

We want to now extend our cohomological dimension bounds to all ideals.

\begin{theorem}
	If $I$ is a proper ideal in a local ring $(R,\m,k)$ of dimension $d$, then $\ara(I)\leq d$.
\end{theorem}
\begin{proof}
	If $I=\m$, this is standard, so we assume that the height of $I$ is less than $d$.
	
	Let $\cP_n=\{\p \in \Spec(R) \ | \ \mathrm{height}(\p)=n \text{ and } \p \not\supseteq I\}$. We will inductively find 
	\[r_0,\dots,r_n\in I \text{ such that } (r_0,\dots,r_n)\not\subseteq \p \text{ for any } \p\in \cP_n.\] 
	
	Once we have done this for $n=d-1$, we have $d$ elements such that $\V((r_0,\dots,r_{d-1}))=\V(I)$, and we are done.
	
	To choose $r_0$, we only need to avoid a subset of the minimal primes of $R$, which is finite, so we can do this by prime avoidance.
	
	Suppose that we have elements satisfying the specified condition for all $i<n$. The set of minimal primes of $(r_0,\dots,r_n)$ of height $n+1$ not containing $I$, $\Min((r_0,\dots,r_n)) \cap \cP_{n+1}$, is finite (and $I$ is clearly not any such $I$), so we can choose an element $r_{n+1}$ in $I$ not in any of these.
	
	Now, suppose that $(r_0,\dots,r_n,r_{n+1})$ is contained in some $\p$ in $\cP_{n+1}$. Then, $(r_0,\dots,r_n)\subseteq \p$ as well. If $\p$ is not minimal over $(r_0,\dots,r_n)$, then take some $\q$ in between. The height of $\q$ is less than $n+1$, so $\q$ contradicts the induction hypothesis. If $\p$ is minimal over $(r_0,\dots,r_n)$, then $\p\in \Min((r_0,\dots,r_n)) \cap \cP_{n+1}$, and $r_{n+1}\in \p$ contradicts the choice of $r_{n+1}$.
\end{proof}


\begin{corollary}
	If $I$ is an ideal in a noetherian ring, and $M$ an $R$-module, then $\cd(I,M)\leq \dim(M)$.
\end{corollary}
\begin{proof}
	Given a counterexample, we can localize at an associated prime of $\H^i_I(M)$, and since $\H^i_I(M)_\p=\H^i_{I_\p}(M_{\p})$ for all $\p$, and $\dim(M_\p)\leq \dim(M)$, it suffices to assume that $R$ is local. Moreover, by invariance of base, we can replace $R$ by $R/\ann(M)$, and assume that $\dim(R)=\dim(M)$. Then, applying the previous theorem, $\cd(I,M)\leq \ara(I)\leq \dim(R)=\dim(M)$.
\end{proof}


\section{The $2\times 2$ minors of a $2\times 3$ matrix in characteristic zero}

Our goal now is to apply Theorem~\ref{theorem:cd-ara} to answer one of the questions from the first day of class. Namely, we will show that in 
\[R = K\big[X_{2\times 3}\big] =\displaystyle K \begin{bmatrix} x_{11} & x_{12} & x_{13} \\ x_{21} & x_{22} & x_{23} \end{bmatrix}, \]\index{$K\big[X_{m\times n}\big]$}
where $K$ is a field of characteristic zero, the ideal
\[I_2(X_{2\times 3}) = (\Delta_1, \Delta_2, \Delta_3) = (x_{11}x_{22}-x_{12}x_{21},x_{11}x_{23}-x_{13}x_{21},x_{12}x_{23}-x_{13}x_{22}) \]\index{$I_t(X_{m\times n})$}
is not generated up to radical by fewer than three elements. Geometrically, this says that to cut out the variety of rank at most one matrices, we need more than two equations, even though the codimension is two. Put yet another way, $\ara(I_2(X_{2\times 3}))=3$. We will show that $\cd(I_2(X_{2\times 3}))=3$. By flat base change, we can assume that $K$ is algebraically closed, which we do for the rest of the section.

To do this, we will use a little bit of representation theory, which we will mostly blackbox. A linear algebraic group $G$ is \emph{linearly reductive}\index{linearly reductive} if every finite dimensional representation of $G$ splits into a direct sum of irreducible representations. If $V$ is a finite dimensional representation of $G$, then the subspace of \emph{invariants}\index{invariants}\index{$V^G$} splits off: $V=V^G\oplus V'$, with a natural projection map $\rho:V\to V^G$, the \emph{Reynolds operator}\index{Reynolds operator}.

Given a representation of $G$ on $V$, one obtains an action of $G$ by degree-preserving automorphisms on the polynomial ring $K[V]=\mathrm{Sym}(V^*)$. The \emph{ring of invariants}\index{ring of invariants} $K[V]^G$ is the subspace of all invariant polynomials; it is closed under addition and multiplication. Naturality properties of the Reynolds operator ensure that $\rho(rs)=r \rho(s)$ for any $r\in K[V]^G$. That is, $\rho$ is a $K[V]^G$-linear retraction of the inclusion $K[V]^G \to K[V]$.

As an example of this, if $G$ is a finite group, and $K=\overline{K}$ of characteristic zero, $G$ is linearly reductive: this is Schur's Lemma. We can take the Reynolds operator to be $\rho(r)=\frac{1}{|G|} \sum_{g\in G} g(r)$: averaging over the group. Reynolds operators can be realized as integration analogues of this.

Here is what we need for our purposes:

\begin{itemize}
	\item $\mathrm{SL}_n(K)$ is linearly reductive.
	\item If $G=\mathrm{SL}_n(K)$ acts on $V=K^{n \times m}$, thought of as the space of $n\times m$-matrices, by multiplication on the left, then $K[V]^G$ is the algebra generated by the maximal minors.
\end{itemize}

A proof of the second assertion will be in the next homework assignment.

Thus, $S=K[\Delta_1,\Delta_2,\Delta_3]=K[X_{2\times 3}]^{\mathrm{SL}_2}$ is a subring of $R=K[X_{2\times 3}]$, and there is an $S$-linear map $R\to S$ that is a retraction of the inclusion. We say that $S$ is a \emph{direct summand}\index{direct summand} of $R$ to indicate this.

\begin{lemma}
	The minors $\Delta_1,\Delta_2,\Delta_3$ are algebraically independent in $R$.
\end{lemma} 
\begin{proof}
	It suffices to show that they are algebraically independent after specializing: 
	\[x_{11}\mapsto 1,\, x_{21}\mapsto 0  \quad \leadsto \quad \Delta_1\mapsto x_{22},\, \Delta_2 \mapsto x_{23},\, \Delta_3 \mapsto x_{12}x_{23}-x_{13}x_{22},\]
	whence it is clear.
\end{proof}

\begin{theorem}
	If $K$ is a field of characteristic zero, $\cd(I_2(X_{2\times 3}))=\ara(I_2(X_{2\times 3}))=3$.
\end{theorem}
\begin{proof}
	As noted above, we can assume that $K=\overline{K}$ by flat base change. Since $K[\Delta_1,\Delta_2,\Delta_3] \to K[X_{2\times 3}] \to  K[\Delta_1,\Delta_2,\Delta_3]$ as $K[\Delta_1,\Delta_2,\Delta_3]$-linear maps composes to the identity, so does 
	\[ \H^3_{(\underline{\Delta})}(K[\Delta_1,\Delta_2,\Delta_3]) \to \H^3_{(\underline{\Delta})}(K[X_{2\times 3}]) \to \H^3_{(\underline{\Delta})}(K[\Delta_1,\Delta_2,\Delta_3]),  \]
	as maps of $K[\Delta_1,\Delta_2,\Delta_3]$-modules. Since $(\underline{\Delta})$ is a maximal ideal in the polynomial ring $K[\Delta_1,\Delta_2,\Delta_3]$, $\H^3_{(\underline{\Delta})}(K[\Delta_1,\Delta_2,\Delta_3])\neq 0$, and hence $\H^3_{(\underline{\Delta})}(K[X_{2\times 3}])\neq 0$ as well.
\end{proof}

Note that the invariance of base property was used in a crucial way.

\begin{remark}
	The group $\mathrm{SL}_2(K)$ is \emph{not} linearly reductive in positive characteristic, so we cannot infer that $K[\Delta_1,\Delta_2,\Delta_3]$ is a direct summand of $K[X_{2\times 3}]$ in this case. We will resolve this case later.
\end{remark}




\chapter{Local duality, Gorenstein rings, and canonical modules}

Let $\m$ be the maximal ideal of $R$. We know that:
\begin{itemize}
	\item If $M$ is a finitely generated $R$-module, then $\H^i_\m(M)$ is an artinian module;
	\item  If $R=M$ is a polyonomial ring over a field $k$, then $\H^d_\m(M) \cong E_R(k)$.
\end{itemize}
The Matlis duals of $\H^\bullet_\m(M)$ are evidently finitely generated modules (if $R$ is complete), and we might hope that they can be realized by formulas in terms of finitely generated elements.

We will see that this turns out to be true. We will establish formulas of this form for an increasingly general class of rings. Along the way, to understand the new class of rings we will meet, we will pursue a more refined study of injective resolutions.

\section{Local duality for regular rings}

\begin{lemma}
	If $(R,\m,k)$ is a regular local ring of dimension $d$, then $\H^d_\m(R) \cong E_R(k)$.
\end{lemma}

We will give two proofs of this fact.

\begin{proof}
	First, we note that both $\H^d_\m(R)$ and $E_R(k)$ stay the same if $R$ is replaced by its completion, so we may assume that $R$ is complete. By Cohen's Structure Theorem, $R=K \llbracket \underline{x} \rrbracket, V \llbracket \underline{x} \rrbracket ,$ or $V \llbracket \underline{x} \rrbracket / (f)$ where $K$ is a field and $V$ a DVR.
	
	We have seen this by explicit computation for $R = k\llbracket\underline{x}\rrbracket$ (worksheet) or $R = V\llbracket\underline{x}\rrbracket$, where $V$ is a DVR (\#2 on HW \#2). Also, if $f \in V\llbracket\underline{x}\rrbracket$, then, from the SES $0\to R \to R \to R/fR \to 0$, we get the LES
	$$\xymatrix{\cdots \ar[r] & 0 \ar[r] & \H^{d-1}_\m \left( V\llbracket\underline{x}\rrbracket/(f) \right) \ar[r] & \H^{d}_\m \left( V\llbracket\underline{x}\rrbracket \right) \ar[r]^-f & \H^{d}_\m \left( V\llbracket\underline{x}\rrbracket \right) \ar[r] & 0},$$
	where the last terms is zero since $\dim(R/fR)=d-1$. Consequently,
	$$\H^{d-1}_\m \left( V\llbracket\underline{x}\rrbracket/(f) \right) = \ann_{\H^{d}_\m \left( V\llbracket\underline{x}\rrbracket \right)}(f) = \ann_{E_{V\llbracket\underline{x}\rrbracket}}(f) = E_{V\llbracket\underline{x}\rrbracket/(f)} (k).$$
	Thus, this holds for all complete regular rings.
\end{proof}

Here is an alternative proof:

\begin{proof}
	When $R$ is regular, the following is an injective resolution of $R$ (by \#6 HW \#2):
	\[0 \, \big(\to R \, \big) \, \to  E_R(R) \to \displaystyle\bigoplus_{\height \mathfrak{p} = 1} E_R(R/\mathfrak{p}) \to \displaystyle\bigoplus_{\height \mathfrak{p} = 2} E_R(R/\mathfrak{p}) \to \cdots \to \displaystyle\bigoplus_{\height \mathfrak{p} = d} E_R(R/\mathfrak{p}) \to 0.\]
	By applying $\Gamma_\m$ to this resolution, we are only left with $E(R/\m)$ in the $d$-th spot.
\end{proof}

If you don't believe in homework, don't worry; we will generalize this soon.


\begin{exercise}$\,$
	\begin{enumerate}[1)]
		\item If $P$ is a flat $R$-module, then $\Tor^R_i(P,M)=0$ for all $i>0$ and all $R$-modules $M$.
		\item If
		$$\xymatrix{\cdots \ar[r] & P_n \ar[r] & \cdots \ar[r] & P_1 \ar[r] & P_0 \ar[r] & (M \ar[r] & ) 0 }$$
		is exact and each $P_i$ is flat (we say this is a {\bf flat resolution}\index{flat resolution} of $M$), then $\Tor^R_i(M,N)=\H_i(P_\bullet \otimes_R N)$ for all $i$.
	\end{enumerate}
\end{exercise}

\begin{proposition}
	If $(R,\m)$ is Cohen-Macaulay, and $M$ is an $R$-module, then $\H^i_\m(M) \cong \Tor^R_{d-i}(M,\H^d_\m(R))$ for all $i$. This isomorphism is functorial in $M$.
\end{proposition}

\begin{proof} Let $x_1,\dots,x_d$ be an SOP for $R$. The augmented \v Cech complex
	$$\xymatrix@R=1mm{
	\textrm{\tiny{flat resolution}} && & \textrm{\tiny{d}} & \textrm{\tiny{d-1}} & & \textrm{\tiny{0}} \\
	\textrm{\tiny{\v{C}ech indexing}} && & \textrm{\tiny{0}} & \textrm{\tiny{1}} & & \textrm{\tiny{d}} \\
	&& 0 \ar[r] & R \ar[r] & \bigoplus_i R_{x_i} \ar[r] & \cdots \ar[r] & R_{x_1\cdots x_d} \ar[r] & ( \H^d_\m(R) \ar[r] & ) 0}$$
	is exact, since the lower local cohomologies vanish. Thus, $\check{C}^{\bullet}(\underline{x};R)$ is a flat resolution of $\H^d_{\m}(R)$. Then, \[\H^i_\m(M)=\check{H}^i(\check{C}^{\bullet}(\underline{x};M))=\check{H}^i(\check{C}^{\bullet}(\underline{x};R)\otimes_R M)=\Tor^R_{d-i}(\H^d_\m(R),M).\] We note that there is a switch from cohomological indexing of \v Cech complex and homological indexing of a flat resolution.
\end{proof}


\begin{proposition}[Ext-Tor dualities]\index{Ext-Tor dualities}
	If $(R,\m)$ be a local ring of dimension $d$, and let $(-)^{\vee}$ denote the Matlis duality functor.
	\begin{enumerate}[1)]
		\item For any (general) $R$-modules $M$ and $N$, $\Tor^R_i(M,N)^{\vee} \cong \Ext^i_R(M,N^{\vee})$.
		\item If $M$ is a finitely generated $R$-module, then $\Tor^R_i(M,N^{\vee}) \cong \Ext^i_R(M,N)^{\vee}$.
	\end{enumerate}
These isomorphisms are functorial in $M$.
\end{proposition}

\begin{proof}
Let $P_{\bullet} (\longrightarrow M)$ be a projective resolution of $M$.
\begin{enumerate}[1)]
		\item
		$$\Tor^R_i(M,N)^{\vee} \cong \H_i(P_{\bullet} \otimes N)^{\vee} \cong \H_i((P_{\bullet} \otimes N)^{\vee}) \cong \H_i(\Hom(P_{\bullet},N^{\vee})) \cong \Ext^i_R(M,N^{\vee}).$$
		Given a map $M \to M'$, we can lift to a map on projective resolutions, and it is easy to see that we get commuting maps through all of the isomorphisms above.
		\item By taking a minimal resolution, we may assume that $P_{\bullet} (\longrightarrow M)$ is a complex of finitely generated free $R$-modules. In this case, there is a natural isomorphism (exercise!)
		$$P_{\bullet} \otimes \Hom_R(N,E) \cong \Hom_R(\Hom_R(P_\bullet, N), E).$$
		Taking homology gives the isomorphism.
	\end{enumerate}
\end{proof}


To help remember which hypothesis goes with which situation in the following, one might keep in mind that Matlis duals of artinian modules are complete.

\begin{theorem}[Local Duality]
	Let $(R,\m,k)$ be a regular local ring of dimension $d$. Then
	\begin{enumerate}[1)]
		\item If $M$ is a finitely generated $R$-module, then $\H^i_\m(M) = \Ext^R_{d-i}(M,R)^{\vee}$.
		\item If $R$ is complete and $M$ is arbitrary, then $\H^i_\m(M)^{\vee} = \Ext^R_{d-i}(M,R)$.
	\end{enumerate}
These isomorphisms are functorial in $M$.
\end{theorem}

\begin{proof}
	\begin{enumerate}
	\item	\[
			\H^i_\m(M)  \cong \Tor^R_{d-i}(M,\H^d_\m(R)) \cong
			 \Tor^R_{d-i}(M,R^{\vee}) \cong
			 \Ext_R^{d-i}(M,R)^{\vee}.
	\]
	\item Since $R$ is complete, $\H^d_{\m}(R)^\vee\cong R^{\vee\vee}\cong R$. Then,
	\[
			\H^i_\m(M)^\vee  \cong \Tor^R_{d-i}(M,\H^d_\m(R))^{\vee} \cong
			 \Ext_R^{d-i}(M,\H^d_\m(R)^{\vee}) \cong
			 \Ext_R^{d-i}(M,R).
	\]\qedhere
	\end{enumerate}
\end{proof}

One often finds the just the first statement as local duality, but the second ``opposite of local duality''\index{world peace} is quite useful as well.

\begin{remark}\label{Generalizing-local-duality}
	By the exact same proof, if $R$ is Cohen-Macaulay and $W$ is some finitely generated module such that $W^\vee \cong \H^d_\m(R)$, then
	\begin{itemize}
		\item If $M$ is a finitely generated $R$-module, then $\H^i_\m(M) = \Ext_R^{d-i}(M,W)^\vee$.
		\item If $R$ is complete, then $\H^i_\m(M)^{\vee} = \Ext_R^{d-i}(M,W)$ by the same proof.
	\end{itemize}
We will return to this later.
\end{remark}

Local duality is a powerful tool to study local cohomology modules. Part of its power comes from its flexibility: there are many different rings, modules, and indices to plug in. Here are some special cases:

\begin{example}
	Let $(R,\m)$ be a local ring, and $(S,\n)$ another local ring such that $S$ is regular, and $R$ is a quotient of $S$. (Such an $S$ exists whenever $R$ is complete, or essentially of finite type over a field or $\ZZ$.) Then, since $R$ is a finitely generated $S$-module, $\H^i_\m(R)\cong \H^i_\n(R) \cong \Ext^{\dim(S)-i}_S(R,S)^\vee$ for all $i$.
\end{example}

\begin{example}
	Let $(R,\m)\to (S,\n)$ be a map of complete local rings, and suppose that $R$ is regular, e.g., a power series ring over a field $K$. Then, $\H^{\dim(R)}_{\m}(S)^{\vee}\cong  \Hom_R(S,R)$.
\end{example}

Here is an important application of Local Duality. Note that we are \emph{not} assuming that $R$ is regular in the statement.

\begin{theorem}[Grothendieck nonvanishing]\index{Grothendieck nonvanishing}
	Let $(R,\m,k)$ be a local ring and $M$ a finitely generated $R$-module. Then $\cd(\m,M) = \dim(M)$.
\end{theorem}

\begin{proof}
	We already know $\leqslant$. Without loss of generality, we can assume that $M$ is a faithful module, by invariance of base. Complete; $\widehat{M}$ is $\widehat{R}$-faithful, $\dim(M) = \dim(\widehat{M})$, and $\H^\bullet_\m(M) \cong \H^\bullet_{\m \widehat{R}} (\widehat{M})$. Therefore, we may assume without loss of generality that $R$ and $M$ are complete.
	
	Now $R$ is a quotient of a power series ring, so by invariance of base we may assume without loss of generality that $R$ is a regular ring. Note, however, that $M$ is not necessarily faithful anymore.
	
	We claim that if the depth of $\mathrm{ann}(M)$ on an $R$-module $N$ is $t$, then $\mathrm{Ext}^{<t}_R(M,N)=0$. This is essentially the same as Rees's Theorem, but we include the argument anyway. Indeed, by induction on the depth (if positive), we can assume that $\mathrm{Ext}^{<t-1}_R(M,N/xN)=0$ for $x$ an $N$-regular element in $\mathrm{ann}(M)$. From the usual LES, we see that, for $i<t$, $x$ acts injectively on $\mathrm{Ext}^{i}_R(M,N)=0$, but $x$ annihilates this module as well, so it must be the zero module. This establishes the claim.
	
	Now, by Local Duality, $\mathrm{H}^i_{{\m}}(M)\cong \mathrm{Ext}_R^{\mathrm{dim}(R)-i}(M,R)^\vee$. Since Matlis Duality is faithful, the indicated Ext is nonzero if and only if its dual is. Thus,
	\begin{align*} \mathrm{cd}(\m,M)=\max\{ j \ | \ \mathrm{H}^j_m(M)\neq 0 \} &= \max\{ \mathrm{dim}(R)-i \ | \ \mathrm{Ext}_R^{\mathrm{dim}(R)-i}(M,R)\neq 0 \} \\ &= \mathrm{dim}(R) - \min\{ i \ | \ \mathrm{Ext}_R^{i}(M,R)\neq 0 \} \\ 
	&\geq \mathrm{dim}(R) - \mathrm{depth}_{\mathrm{ann}(M)}(R) \\ 
	&\geq\mathrm{dim}(R) - \mathrm{height}{(\mathrm{ann}(M))} \\ &\geq \mathrm{dim}(R/\mathrm{ann}(M)) = \dim(M).\end{align*}
	Since $\dim(M)\geq \mathrm{cd}(\m,M)$, equality holds throughout.
\end{proof}

\begin{remark}
	A consequence of this argument, by taking $M=R/I$, is that if $R$ is a regular local ring (or any ring for which Local Duality holds!) there are equalities for any ideal $I\subset R$:\index{catenary}
	\[ \mathrm{depth}_I(R)= \mathrm{height}(I) = \dim(R)-\dim(R/I). \]
	Of course, these can be obtained more directly (for Cohen-Macaulay rings).
\end{remark}

Following Remark~\ref{Generalizing-local-duality}, we should be able to generalize local duality, so that we can compute local cohomology as duals of Ext modules over rings that are more relevant. The best generalization would be in the case of a Cohen-Macaulay local ring $R$ such that $R^{\vee}\cong \H^d_{\m}(R)$. Failing that, we would like to understand when a f.g. module $K$ such that $K^\vee\cong H^d_{\m}(R)$ exists over a CM local ring, and how else we might recognize such a $K$.







\section{Gorenstein rings}

Now, we pursue the injective analogues of the questions we addressed in the Section on Auslander, Buchsbaum, and Serre: What is the injective dimension of a finitely generated module when it is finite? Are there natural conditions on a ring that ensure finite injective dimension for all, or for some reasonable class, of finitely generated modules? To start, we make an observation about Bass numbers.

\begin{definition}
	The \emph{injective dimension}\index{injective dimension} of a finitely generated $R$-module $M$, denoted $\mathrm{injdim}_R(M)$,\index{$\mathrm{injdim}_R(M)$} is the length of its minimal injective resolution.  Note that any injective resolution of $M$ has length at least equal to that of the minimal injective resoltuion, since a Bass number can be computed as an Ext, whose nonvanishing implies nonvanishing in that spot for any injective resolution.
\end{definition}

\begin{proposition}
Let $R$ be noetherian, and $M$ finitely generated. If $\mu_{i,\p}(M)\neq 0$, for some prime $\p$, then $\mu_{i+1,\q}(M)\neq 0$ for all $\q$ with $\height(\q/\p)=1$.
\end{proposition}
\begin{proof}
Since Bass numbers behave well under localization, we can localize at $\q$, and assume that $\dim(R/\p)=1$. Pick $x\in \q \setminus \p$. From the SES
\[0 \to R/\p \stackrel{x}{\longrightarrow}  R/\p \to R/(\p+(x)) \to 0  \]
we get the LES
\[\cdots \to \Ext^i_R(R/\p,M) \stackrel{x}{\longrightarrow} \Ext^i_R(R/\p,M) \to \Ext^{i+1}_R(R/(\p+(x)),M) \to \cdots. \]
Suppose that $\mu_{i+1,\q}(M)=0$. Then, $\Ext^{i+1}_R(R/\q,M)=0$. The module $R/(\p+(x))$ has finite length, and an induction on length (similar arguments we saw earlier) shows that $\Ext^{i+1}_R(R/(\p+(x)),M)=0$ as well. It then follows by NAK that $\Ext^i_R(R/\p,M)=0$, so $\mu_{i,\p}(M)=0$.
\end{proof}

\begin{corollary}\label{inj-dim-maxl} Let $R$ be noetherian, and $M$ a finitely generated $R$-module.
\begin{enumerate}
\item $\mathrm{injdim}_R(M)= \max\{i \ | \ \Ext^i_R(R/\m,M)\neq 0 \ , \ \m \text{  a maximal ideal } \}.$
\item $\mathrm{injdim}_R(M)\geq \dim(M)$.
\end{enumerate}
\end{corollary}
\begin{proof}
The first statement is clear. For the second, we recall that the associated primes of $M$ are the same as those of $E_R(M)$, so the zeroth Bass numbers are nonzero for the associated primes of $M$. Then, we are guaranteed a chain of Bass numbers as long as $\dim(M)=\max\{\dim(R/\p) \ | \ \p\in \Ass(M)\}$.
\end{proof}

The following is the injective analogue of Auslander--Buchsbaum.

\begin{theorem}
	Let $(R,\m,k)$ be a local ring, and $M$ a finitely generated module.  If $M$ has finite injective dimension, then $\mathrm{injdim}_R(M)=\depth(R)$.
\end{theorem}
\begin{proof}
	Set $e=\mathrm{injdim}_R(M)$ and $d=\depth (R)$. Let $\underline{x}=x_1,\dots,x_d$ be a maximal $R$-sequence.
	
	To see $e\geq d$, compute $\Ext^d_R(R/\underline{x}R,M)$ by the Koszul complex: this is $H^d(\underline{x};M)=M/\underline{x}M\neq 0$, so the injective resolution of $M$ is at least this long.
	
	To see $e \leq d$, we can take a SES $0\to k \to R/\underline{x}R \to C \to 0$ and the LES
	\[ \cdots \to \Ext^e_R(R/\underline{x}R,M) \to \Ext^e_R(k,M) \to \Ext^{e+1}_R(C,M) \to \cdots.\]
	From the definition of $e$, the last term vanishes. Then, by Corollary~\ref{inj-dim-maxl}(1), $\Ext^e_R(k,M)\neq 0$, so $\Ext^e_R(R/\underline{x}R,M)\neq 0$. Thus, $e\leq \pd(R/\underline{x}R)=d$.
\end{proof}

We now pursue an analogue of Auslander--Buchsbaum--Serre. Here is one such statement:

\begin{remark}
	Let $(R,\m,k)$ be local. If $\mathrm{injdim}_R(k)<\infty$, then $R$ is regular (and conversely). Indeed, we know
	$\mathrm{injdim}_R(k)=\max\{ t \ | \ \Ext^t_R(k,k)\neq 0\}$. If we take a minimal resolution $P_\bullet \to k$, the maps in $\Hom_R(P_\bullet,k)$ are all zero, so $\Ext^t_R(k,k)\cong k^{\beta_t}$. Thus, $k$ has finite injective dimension if and only if it has finite projective dimension.
\end{remark}


\begin{definition}[Gorenstein local ring]\index{Gorenstein}
	A local ring $(R,\m,k)$ is \emph{Gorenstein} if for every system of parameters $x_1,\dots,x_d$,
	\begin{itemize}
		\item $x_1,\dots,x_d$ is a regular sequence (so $R$ is CM)
		\item the ideal $(x_1,\dots,x_d)$ is irreducible\index{irreducible ideal}: it cannot be written as $I\cap J$ for $I,J\supsetneq (x_1,\dots,x_d)$.
	\end{itemize}
\end{definition}

This class of rings can be characterized in many ways\index{ubiquity}. Bass was the first to point this out, and to illustrate to importance of this class of rings. We will start this pursuit with artinian rings.

\begin{theorem}
	Let $(R,\m,k)$ be an artinian local ring. TFAE:
	\begin{enumerate}[1)]
		\item $R$ is Gorenstein: $(0)$ is irreducible
		\item $\dim_k(\mathrm{soc}(R))=1$
		\item $E_R(k)\cong R$
		\item $\mathrm{injdim}_R(R)<\infty$
		\item[4')] $R$ is an injective $R$-module
	\end{enumerate}
\end{theorem}
\begin{proof}
	(1)$\Rightarrow$(2): Given two linearly independent elements $f,g$ in the socle, $(f)\cap (g)=0$.
	
	(2)$\Rightarrow$(1): $R$ is $\m$-torsion, hence is an essential extension of  its socle, so any ideal contains a nonzero element there. If the socle is 1-dimensional, any ideal contains the whole socle.
	
		(2)$\Rightarrow$(3): $R$ is an essential extension of $k$, so it embeds into $E_R(k)$. Since $\ell(R)=\ell(R^\vee)=\ell(E_R(k))$, this is an isomorphism.
	
	(3)$\Rightarrow$(2): The socle of $E$ is a copy of $k$.
	
	
	
	(3)$\Rightarrow$(4'): Trivial.
	
		(4')$\Rightarrow$(3): The only injectives are copies of $E$, and $R$ is an indecomposable module, so this is the only option from the structure theory.
	
	(4')$\Rightarrow$(4): Trivial.
	
		(4)$\Rightarrow$(4'): Because injective dimension is the depth.
\end{proof}

We note that if $R$ is artinian, then it contains a copy of $k$, and we can reinterpret (3) as saying that $R\cong \Hom_k(R,k)$.

We now want to extend this theorem to higher dimensions. We will use another theorem of Rees on Ext.

\begin{theorem}
	Let $M,N$ be $R$-modules, and $x\in \ann(M)$ be $R$-regular and $N$-regular. Then $\Ext^{i+1}_R(M,N)\cong \Ext^{i}_{R/xR}(M,N/xN)$ for all $i\geq 0$.
\end{theorem}
\begin{proof}
	We will apply the same strategy as in the Fundamental Theorem of Local Cohomology to see that for the left-exact functor $F(-)=\Hom_{R/xR}(-,N/xN)$ from $R/xR$-modules to $R/xR$-modules, its right derived functors are $R^i F(-)=\Ext^{i+1}_R(-,N)$. Note that $M$ is an $R/xR$-module by hypothesis. By definition, $R^i F(-)=\Ext^{i}_{R/xR}(M,N/xN)$, so this will establish the theorem.
	
	Step 1: The functors agree when $i=0$. Indeed, for the SES of $R$-modules $0\to N \stackrel{x}{\longrightarrow} N \to N/xN \to 0$, there is an LES
	\[ \cdots \to \Hom_R(M,N) \to \Hom_R(M,N/xN) \to \Ext^1_{R}(M,N) \stackrel{x}{\longrightarrow} \Ext^1_{R}(M,N) \to \cdots.   \]
	We observe that $\Hom_R(M,N)=0$ (any element in $M$ has to map to something killed by $x$), that $\Hom_R(M,N/xN)=\Hom_{R/xR}(M,N/xN)$ (since both sides are killed by $x$), and $x$ kills $\Ext^1_{R}(M,N)$ (since it kills $M$). The specified isomorphism follows.
	
	Step 2: $\Ext^{i+1}_R(-,N)$ vanishes for free $R/xR$-modules for  $i>0$. Indeed, a free $R/xR$-module has a free $R$-resolution of length one, so computing the Ext from this resolution shows the vanishing.
	
	Step 3: This follows in the same way as Step 3 of the Fundamental Theorem of Local Cohomology\index{looks like a functor, smells like a functor}. We leave this as an exercise.
\end{proof}


\begin{theorem}
	Let $(R,\m,k)$ be a local ring of dimension $d$. TFAE:
	\begin{enumerate}[1)]
		\item $R$ is Gorenstein
		\item[1')] $R$ is CM and some SOP generates an irreducible ideal
		\item 	$\Ext^i_R(k,R)\cong \begin{cases} 0 & i<d \\
			k & i=d. \end{cases}$
		\item $R$ is CM and $\H^d_\m(R)\cong E_R(k)$.
		\item $\mathrm{injdim}_R(R)<\infty$
		\item[4')] $\mathrm{injdim}_R(R)=d$
	\end{enumerate}
\end{theorem}
\begin{proof}
	First we want to observe that every condition implies that $R$ is Cohen-Macaulay. For (2), this is due to Rees's theorem on depth and Ext (the one from a while ago). For (4), and consequently for (4'), this follows from $\dim(R)\leq \mathrm{injdim}_R(R) = \depth(R)$. For the others, this is explicit. We assume that $R$ is Cohen-Macaulay henceforth.
	
	(1)$\Rightarrow$(1'): trivial
	
	(1')$\Rightarrow$(2): The Ext vanishings follow from CM as noted above. Now, let $(\underline{x})$ be the given irreducible parameter ideal. The zero ideal in $R/(\underline{x})$ is then irreducible, and by the artinian case, $\Hom_{R/\underline{x}R}(k,R/\underline{x}R)\cong k$. Applying the previous theorem $d$ times, we obtain that $\Ext^d_R(k,R)\cong k$.
	
	(2)$\Rightarrow$(1): Given any SOP $\underline{x}$ of $R$, as in the previous implication (backwards), we see that $\Hom_{R/\underline{x}R}(k,R/\underline{x}R)\cong k$, and apply the artinian case to see that $(0)$ is irreducible in $R/\underline{x}R$, so $(\underline{x})$ is irreducible in $R$.
	
	As a consequence of these implications, we see that if $R$ is Gorenstein local, and $\underline{x}$ a SOP, then $R$ is Gorenstein iff $R/\underline{x}R$ is.
	
	(1)$\Rightarrow$(4')$\Rightarrow$(4)$\Rightarrow$(1): Applying Rees's recent theorem again, we find that if $\underline{x}$ is an SOP, then
	\[ \mathrm{injdim}_R(R) = \max\{ t \ | \ \Ext^t_R(k,R)\neq 0 \} = d+\max\{ t \ | \ \Ext^t_{R/\underline{x}R}(k,R/\underline{x}R)\neq 0 \} = d+\mathrm{injdim}_{R/\underline{x}R}({R/\underline{x}R}). \]
	Then, $R$ is Gorenstein implies $R/\underline{x}R$ is too, and that it has injective dimension zero (by the artinian case), so $R$ has injective dimension $d$. If $R$ has finite injective dimension, so does $R/\underline{x}R$, so it is Gorenstein, and $R$ is too.

	
(2) + (4') $\Rightarrow$(3): By (2), know that $\mu_{i,\m}(R)$ is zero for $i<d$ and is one for $i=d$; by (4) it is zero for $i>d$. Thus, taking $\Gamma_\m$ of an injective resolution of $R$ leaves just one copy of $E_R(k)$ in cohomological degree $d$.
	
(3)$\Rightarrow$(2):  Again, the Ext vanishing is a consequence of Cohen-Macaulayness. By the Lemma on ascending Bass numbers, $\Ext^d_R(k,R)\neq 0$. In the Theorem characterizing Bass numbers in terms of Ext, we saw that if $E^\bullet$ is an injective resolution of $R$, $\Hom_R(k,E^\bullet)$ has vanishing differentials; this was explicitly stated and established as a claim. This means that, in a minimal injective resolution, any socle element is in the kernel of the differential. Now consider $\Gamma_{\m}(E^\bullet)$. This is zero up to cohomological dimension $d$. Then, we have
\[ 0 \to E_R(k)^{\oplus\mu_{d,\m}} \stackrel{d}{\longrightarrow} E_R(k)^{\oplus\mu_{d+1,\m}} \to \cdots\]
and $k^{\oplus \mu_{d,\m}}\cong \mathrm{soc}(E_R(k)^{\oplus\mu_{d,\m}})\subseteq \ker(d) = \H^d_{\m}(R)$.
\end{proof}

The following is now evident from the remark after the proof of Local Duality for regular rings.

\begin{corollary}[Local Duality for Gorenstein rings] 
	Let $(R,\m,k)$ be a Gorenstein local ring of dimension $d$. Then
\begin{enumerate}[1)]
	\item If $M$ is a finitely generated $R$-module, then $\H^i_\m(M) = \Ext^R_{d-i}(M,R)^{\vee}$.
	\item If $R$ is complete and $M$ is arbitrary, then $\H^i_\m(M)^{\vee} = \Ext^R_{d-i}(M,R)$.
\end{enumerate}
These isomorphisms are functorial in $M$.
\end{corollary}


\section{Worksheet on Gorenstein rings}


\begin{enumerate}
	\item Let $(R,\m,k)$ be a local ring. Show\footnote{or note that we have already shown} the following:
	
	
	\begin{enumerate}
		\item $R$ is Gorenstein if and only if $\widehat{R}$ is Gorenstein.
		
		
		
		\item If $x_1,\dots,x_i$ is a regular sequence, then $R$ is Gorenstein if and only if $R/(x_1,\dots,x_i)$ is Gorenstein.
		
		
		
		\item If $R$ is Gorenstein, and $\p \in \Spec(R)$, then $R_\p$ is Gorenstein.
	\end{enumerate}
\end{enumerate}




\begin{definition} A local ring $(R,\m,k)$ is a \emph{complete intersection}\index{complete intersection} if there is a surjection from a complete regular local ring $S$ onto $\widehat{R}$ with the kernel generated by a regular sequence. 
\end{definition}

\begin{remark} The following are equivalent:
\begin{itemize}
	\item $R$ is a complete intersection;
	\item For every\footnote{This quantifier is never vacuous by Cohen's Structure Theorem.} surjection from a complete RLR $S \twoheadrightarrow \widehat{R}$, the kernel is generated by a regular sequence;
\end{itemize}
and \emph{\bf IF} there exists a surjection from an RLR onto $R$ itself,
\begin{itemize}
	\item For every surjection from an RLR $S \twoheadrightarrow {R}$, the kernel is generated by a regular sequence.
\end{itemize}
Not all of these equivalences are obvious, but we will use them freely.
\end{remark}

\begin{enumerate}\setcounter{enumi}{1}
	
	\item Show that if $R$ is a complete intersection, then $R$ is Gorenstein.
	
	\
	
	\item Let $K$ be a field. For each of the following rings $R$ determine: Is $R$ Gorenstein? Is $R$ Cohen-Macaulay? Is $R$ a complete intersection? Reuse your work from old worksheets and HW when convenient.
	

	
	\begin{enumerate}
		
		\item  $\displaystyle R=\frac{K\llbracket x,y \rrbracket}{(x^2,xy)}$.
		
		
		
		\item  $\displaystyle R=\frac{K\llbracket x,y,z \rrbracket}{(xy,xz,yz)}$.
		
		
		
		\item  $\displaystyle R=\frac{K\llbracket x,y,z \rrbracket}{(x^2,y^2,z^2,x(y-z),(x-y)z)}$.
		
		
		
		\item  $\displaystyle R=\frac{K[X_{2\times 3}]_{\m}}{I_2(X_{2\times 3})}$, where $\m$ is the ideal generated by the entries of $X$.
		
		
		
		\item $\displaystyle R=K[x,y]^{(2)}_{\m}$, where $\m$ is the ideal generated by the positive degree forms.
		
		
		
		\item $\displaystyle R=K[x,y]^{(3)}_{\m}$, where $\m$ is the ideal generated by the positive degree forms.
		
		
		
		\item $\displaystyle R=K[x,y,z]^{(3)}_{\m}$, where $\m$ is the ideal generated by the positive degree forms.
		
	\end{enumerate}
	
	
	
	\item Let $(R,\m)$ and $(S,\n)$ be two complete Gorenstein local rings, with $R=S/I$.
	\begin{enumerate}
		\item Use Local Duality to show that $\Ext^t_S(R,S)=\begin{cases} 0 & t<\dim(S)-\dim(R) \\
		R & t=\dim(S)-\dim(R). \end{cases}$
		
	
		\item Suppose moreover that $S$ is regular. Let $P_\bullet\to R$ be the minimal free resolution of $R$ as an $S$-module. Show that,  $P_{\bullet}\cong \Hom_S(P_\bullet,S)$.\footnote{To match up the indexing, $P_{\bullet}\cong [\Hom_S(P_\bullet,S)]^{d-\bullet}$}\footnote{You can use without proof the fact that any two minimal resolutions are isomorphic.}
		
	
		
		\item With the same assumptions as in the previous part, show that $\Tor^S_i(R,M)\cong \Ext^i_S(R,M)$ for all $S$-modules $M$.
		
	
		
	\end{enumerate}
	
	\item A \emph{numerical semigroup} is a subsemigroup $S$ of $\NN$; our convention is that $0\in S$. A \emph{numerical semigroup ring} is a ring of the form $K[S]:=K[\{x^s \ | \ s\in S\}]\subseteq K[x]$. Assume that the GCD of the elements in $S$ is 1. Then, there is a largest number $f_S \in \NN$ such that $f_S \notin S$, called the \emph{Frobenius number of $S$}.
	
	
	
	\begin{enumerate}
		\item Show that $\H^1_{\m}(K[S])$ is generated as a $K$ vector space by $\{x^a \ | \ a\leq f_S \text{ and } a\notin S \}$.\footnote{Hint: Consider the ideal $J=x^{f_S +1}K[x]$ in $K[S]$.} 
		
		
		\item Show that $K[S]_\m$ is Gorenstein if and only if \[\{ c \ | \ 0 \leq c\leq f_S, c \notin S \} = \{ f_S -d \ | \ 0\leq d \leq f_S, d\in S \}.\]
		
		\item Check this criterion with $K\llbracket x^3, x^7\rrbracket$, $K\llbracket x^3, x^5, x^7 \rrbracket$, and $K\llbracket x^4, x^5, x^6 \rrbracket$.
	\end{enumerate}
	

	
	\item Show that if $R$ is a Gorenstein local ring, and $M$ is a finitely generated $R$-module, then $M$ has finite projective dimension if and only if $M$ has finite injective dimension.
\end{enumerate}


We summarize some implications and non-implications on the structural properties of local rings we have encountered:

\[ \text{regular} \Rightarrow \text{complete intersection} \Rightarrow \text{Gorenstein} \Rightarrow \text{Cohen-Macaulay}\]

\noindent$\text{complete intersection} \not\Rightarrow \text{regular}$: $K[x]/(x^2)$, $K[x^2,xy,y^2]$, $\frac{K[x,y,z,u,v,w]}{(u^2+v^2+w^2,x^2+y^2+z^2)}$,\dots

\noindent$\text{Gorenstein} \not\Rightarrow \text{complete intersection}$:  $R=\frac{K\llbracket x,y,z \rrbracket}{(x^2,y^2,z^2,x(y-z),(x-y)z)}$, $R=K[x,y,z]^{(3)}_{\m}$,\dots

\noindent$\text{Cohen-Macaulay} \not\Rightarrow \text{Gorenstein}$: $R=\frac{K\llbracket x,y,z \rrbracket}{(xy,xz,yz)}$, $R=\frac{K[X_{2\times 3}]_{\m}}{I_2(X_{2\times 3})}$, $K\llbracket x^3, x^5, x^7 \rrbracket$,\dots


\section{Canonical modules}

\begin{definition} A \emph{canonical module}\index{canonical module}\index{$\omega_R$} over a Cohen-Macaulay local ring $(R,\m,k)$ is a finitely generated module $\omega_R$ such that $\Hom_R(\omega_R,E_R(k)) \cong \H^{\dim(R)}_\m (R)$.
\end{definition}

\begin{example}
 For a Cohen-Macaulay local ring $(R,\m,k)$, the rank one free module $R$ is a canonical module if and only if $R$ is Gorenstein.
 \end{example}

\begin{example}
	If $R$ is complete local (and CM), then, by Matlis duality, $\omega_R=\H^{\dim(R)}_{\m}(R)^\vee$ is noetherian and $\omega_R^\vee=\H^{\dim(R)}_{\m}(R)^{\vee\vee}=\H^{\dim(R)}_{\m}(R)$, so $\omega_R$ is a canonical module. Moreover, if $M$ is noetherian and $M^\vee\cong \H^{\dim(R)}_{\m}(R)$, then $M\cong M^{\vee\vee}\cong \H^{\dim(R)}_{\m}(R)^\vee = \omega_R$, so all canonical modules of $R$ are isomorphic.
\end{example}

\begin{example}
	If $R$ is artinian local (and hence complete), then all of $R$ is $\m$-torsion, so $R=\H^0_\m(R)$. Since $E_R(k)^{\vee}\cong R$, $E_R(k)$ is a canonical module in this case.
\end{example}


In our original proof of local duality in the regular case, we noted that the proof worked in greater generality. Our definition of canonical module is designed to exactly fulfill that situation.

\begin{theorem}[Local Duality for Cohen-Macaulay rings] Let $(R,\m,k)$ be a Cohen-Macaulay local ring of dimension $d$, and $\omega_R$ a canonical module.
	\begin{enumerate}
		\item If $M$ is a finitely generated $R$-module, then $\H^i_\m(M) = \Ext^R_{d-i}(M,\omega_R)^{\vee}$.
		\item If $R$ is complete and $M$ is arbitrary, then $\H^i_\m(M)^{\vee} = \Ext^R_{d-i}(M,\omega_R)$.
	\end{enumerate}
These isomorphisms are functorial in $M$.
\end{theorem}

	Of course, we want to find conditions under which canonical modules exist, and to have methods to find them.
	
	\begin{lemma}
		Let $\varphi:(A,\n,l) \to (R,\m,k)$ be a homomorphism of local rings. Suppose that $R$ is module-finite over the image of $A$: e.g., $R=A/I$, or $A\subseteq R$ is a module-finite inclusion.
		
		Set $(-)^{\vee_A}=\Hom_A(-,E_A(l))$ and $(-)^{\vee_R}=\Hom_R(-,E_R(k))$.
		
		For any $R$-module $M$, $M^{\vee_A}\cong M^{\vee_R}$, as $A$-modules or as $R$-modules.
	\end{lemma}
\begin{proof}
	This follows from the lemma on the behavior of the injective hull of the residue field under such maps and Hom-tensor adjunction:
	\[ \Hom_A(M,E_A(l))= \Hom_A(M \otimes_R R ,E_A(l))=\Hom_R(M, \Hom_A( R ,E_A(l))= \Hom_R(M,E_R(k)).  \]
	These isomorphisms are all valid as $A$-modules or as $R$-modules. 
\end{proof}

The following proposition is the key source of canonical modules.

\begin{proposition}
	Let $\varphi:(A,\n,l) \to (R,\m,k)$ be a homomorphism of local rings. Suppose that $R$ is module-finite over the image of $A$: e.g., $R=A/I$, or $A\subseteq R$ is a module-finite inclusion.
	
	Suppose that $A$ and $R$ are Cohen-Macaulay, and that $\omega_A$ is a canonical module for $A$. Then $\Ext^{\dim(A)-\dim(R)}_A(R,\omega_A)$ is a canonical module for $R$.
\end{proposition}
\begin{proof}
	Since $R$ and $\omega_A$ are finitely generated $A$-modules, the $A$-modules $\Ext^\bullet_A(R,\omega_A)$ are noetherian $A$-modules. They are $R$-modules as well, and noetherian $R$-modules as such.
	
	We then apply local duality over $A$, and the previous lemma: 
	\[ \H^{\dim(R)}_{\m}(R) = \H^{\dim(R)}_{\n}(R) =\Ext^{\dim(A)-\dim(R)}_A(R,\omega_A)^{\vee_A} = \Ext^{\dim(A)-\dim(R)}_A(R,\omega_A)^{\vee_R}. \]
	Since local duality is functorial, the map $R \stackrel{\cdot r}{\longrightarrow} R$ for any $r\in R$ induces the same map on both sides, so this is an isomorphism of $R$-modules.
\end{proof}

\begin{corollary}
	If $R$ is a CM quotient of a Gorenstein local ring $A$, then $R$ has a canonical module, namely, $\omega_R=\Ext^c_A(R,A)$, where $c=\dim(A)-\dim(R)$.
\end{corollary}

\begin{example}
	In the first homework, you showed that for $A=K[X_{2\times 3}]$ and $R=A/I_2(X)$, $R$ is Cohen-Macaulay, and $\Ext^2_A(R,A)$ is the cokernel of the map $A^3\to A^2$ given by the matrix $X^T$.
 Evidently, this two-generated module is a canonical module for $R$. 
\end{example}

\begin{example}
	Let $R=K[x^3,x^2 y, xy^2, y^3]$, and $A=K[x^3,y^3]$. We can write $R=A\oplus x^2 y A \oplus xy^2 A$. We have that $\Hom_A(R,A)$ is a canonical module for $R$. To understand this module more concretely, note that $\Hom_A(R,A)$ is generated by the maps $\phi_1,\phi_{x^2y},\phi_{xy^2}$ dual to the basis of $R$ over $A$ specified above. Evidently, $\phi_1=x^2y \cdot \phi_{x^2 y}=x y^2 \cdot \phi_{x y^2}$, so we can ignore $\phi_1$ as a generator. The maps $\phi_{x^2y},\phi_{xy^2}$ both decrease degrees by 3, so neither is a multiple of the other. One relation between the maps is given above. It is easy to find a few more: $x^3 \cdot \phi_{x^2 y}=x^2 y \cdot \phi_{x y^2}$ and $x y^2 \cdot \phi_{x^2 y}=y^3 \cdot \phi_{x y^2}$.
\end{example}

Our next goal is to show that canonical modules are unique up to isomorphism when they exist. We want to do this by reducing to the complete case, where we have already observed this. To this end, we will  collect a few facts on completion and Matlis duality.

\begin{lemma}
	Let $(R,\m,k)$ be local, and $M$ and $N$ be finitely generated $R$-modules.\begin{enumerate}
		\item If $\widehat{M}\cong\widehat{N}$, then $M\cong N$.
		\item $M^{\vee\vee}\cong \widehat{M}$.
		\item $M^{\vee}\cong \widehat{M}^\vee$, where the latter dual is as a $\widehat{R}$-module.
	\end{enumerate}
\end{lemma}
\begin{proof}
	\begin{enumerate}
		\item Let $\phi:\widehat{M}\to\widehat{N}$ be an isomorphism, in particular, surjective. First, we note that \[\Hom_{\widehat{R}}(\widehat{M},\widehat{N})\cong \widehat{R}\otimes_R \Hom_R(M,N) \cong \widehat{\Hom_R(M,N)}.\]
		Thus, we can pick $\alpha\in \Hom_R(M,N)$ such that $\phi - \widehat{\alpha} \in \m \widehat{\Hom_R(M,N)}$. If $n\in N$ satisfies $n=\phi(m')$, with $m'\in \widehat{M}$, take $m\in M$ with $m-m'\in \m \widehat{M}$, so $\alpha(m)\in n + \m N$. Thus, $N\subseteq \im(\alpha)+\m N$, and hence $\im(\alpha)=N$ by NAK. 
		
		Similarly, we can find a surjection $\psi:N\to M$, and hence a surjection $\psi\circ \alpha:M\to M$. Since $M$ is finitely generated, $\psi\circ \alpha:M\to M$ must be an isomorphism, hence injective. Then, $\alpha:M\to N$ must be injective too, hence an isomorphism.
		
		\item We have already seen that $R^{\vee\vee}\cong \widehat{R}$. Then, given a presentation 
		\[ R^a \stackrel{A}{\longrightarrow} R^b \to M \to 0, \]
		applying double duality gives
			$$\xymatrix{(R^m)^{\vee\vee} \ar[d]_-{\cong} \ar[r]^A & (R^n)^{\vee\vee} \ar[d]_-{\cong} \ar[r] & M^{\vee\vee} \ar[r] & 0 \\
			\widehat{R}^m \ar[r]^A & \widehat{R}^n \ar[r] & \widehat{M} \ar[r] & 0}$$
		and thus $M^{\vee \vee}\cong \widehat{M}$.
		
		\item Recall that $E_R(k) \cong \widehat{R}\otimes_R E_R(k) \cong E_{\widehat{R}}(k)$. Since $M^\vee$ is artinian, and applying flat base change
		\[\Hom_R(M,E_R(k)) \cong \widehat{R}\otimes_R \Hom_R(M,E_R(k)) \cong  \Hom_{\widehat{R}}(\widehat{R}\otimes_R M,\widehat{R}\otimes_R E_R(k)) \cong \Hom_{\widehat{R}}(\widehat{M},E_{\widehat{R}}(k)).\]
	\end{enumerate}
\end{proof}

\begin{proposition}
	If $(R,\m,k)$ is a CM local ring, then a finitely generated module $\omega$ is a canonical module for $R$ if and only if $\widehat{\omega}$ is a canonical module for $\widehat{R}$. Consequently, any two canonical modules for $R$ are isomorphic.
\end{proposition}
\begin{proof}
	The first statement follows immediately from part (3) above.
	
	If $M$ and $N$ are canonical modules for $R$, then $\widehat{M}$ and $\widehat{N}$ are canonical modules for $\widehat{R}$. As noted earlier, this implies that $\widehat{M}\cong \widehat{N}$, so by part (1) of the previous lemma, $M\cong N$.
\end{proof}

Here is one application of the uniqueness of canonical modules.

\begin{corollary} Let $(R,\m,k)$ be a RLR, and $I\subseteq R$ an ideal. If $R/I$ is Gorenstein, then the minimal free resolution $P_\bullet$ of $R/I$ as an $R$-module is symmetric:
	\[ 0\to R \stackrel{A_{c-1}}{\longrightarrow} R^{\beta_1} \stackrel{A_{c-2}}{\longrightarrow} R^{\beta_2} \cdots \stackrel{A_{2}}{\longrightarrow} R^{\beta_2} \stackrel{A_{1}}{\longrightarrow} R^{\beta_1} \stackrel{A_{0}}{\longrightarrow} R (\to R/I) \to 0,\]
	with $A_{c-1} = A_0^T$, $A_{c-2}=A_{1}^T$ (up to change of bases).
\end{corollary}
\begin{proof}
	Let $c=\dim(R)-\dim(R/I)$. More naturally, the claim is that $P_\bullet \cong \Hom_R(P_\bullet,R)$ after reindexing the latter (changing the indices from cohomological $0,1,\dots,c$ to homological $c,c-1,\dots,0$). The complex $\Hom_R(P_\bullet,R)$ has homology $\Ext^\bullet_R(R/I,R)$. The complex vanishes past position $c$ by Auslander-Buchsbaum. The homology below degree $c$ vanishes by Rees (or local duality). The homology at position $c$ is a canonical module for $R/I$, so must be $R/I$ itself, since $R/I$ is Gorenstein. Thus,  $\Hom_R(P_\bullet,R)$ after the reindexing is a minimal free resolution for $R/I$. Any two minimal free resolutions are isomorphic (exercise!).
\end{proof}

\begin{proposition}
	Let $(R,\m,k)$ be Cohen-Macaulay, $\omega_R$ be a canonical module for $R$, and $\underline{f}=f_1,\dots,f_t$ be a regular sequence on $R$. Then
	\begin{enumerate}
				\item $\omega_R / \underline{f} \omega_R$ is a canonical module for $R/\underline{f} R$, and
		\item $\underline{f}$ is a regular sequence on $\omega_R$.
	\end{enumerate}
In particular, a canonical module is a maximal Cohen-Macaulay module.
\end{proposition}
\begin{proof}
	For the first statement, compute $\Ext^t_R(R/\underline{f}R,\omega)\cong H^t(\underline{f};\omega)\cong \omega_R / \underline{f} \omega_R$.
	
	We prove (2)  by induction on $t$. Suppose both statements are true for $\underline{f}'=f_1,\dots,f_{t-1}$, and set $\overline{M}$ to be $M/\underline{f}' M$. Then, $\ann_{\bar{\omega}}(f_t)\cong \Hom_{\bar{R}}(\bar{R}/f_t \bar{R},\bar{\omega})$. Applying (1), $\bar{\omega}\cong \omega_{\bar{R}}$. We apply local duality to see that $\Hom_{\bar{R}}(\bar{R}/f_t \bar{R},\bar{\omega})^\vee\cong \H_\m^{\dim(\bar{R})}(\bar{R}/f_t \bar{R})=0$. Thus, $f_t$ is a nonzerodivisor on~$\bar{\omega}$. 
\end{proof}

\begin{lemma}
	Let $(R,\m,k)$ be a Cohen-Macaulay local ring with canonical module $\omega_R$. Then $R\cong \Hom_R(\omega_R,\omega_R)$ by the map $r \mapsto \text{``multiply by $r$''}$.
\end{lemma}
\begin{proof}
	Since $\widehat{R}$ is faithfully flat over $R$, it suffices to check to isomorphism after tensoring with $\widehat{R}$. Since both sides are finitely generated, this is the same as completing, which turns $R$ into $\widehat{R}$, and $\Hom_R(\omega_R,\omega_R)$ into $\Hom_{\widehat{R}}(\omega_{\widehat{R}},\omega_{\widehat{R}})$. Thus, we can assume that $R$ is complete. Then, if $f_1,\dots,f_d$ is a SOP for $R$, write $R_t=R/(f_1^t,\dots,f_d^t)$. Then $\omega_R=\varprojlim \omega_{R}\otimes_R R_t=\varprojlim \omega_{R_t}$. 
	
	We claim that $\Hom_R(\omega_R,\omega_R)\cong \varprojlim \Hom_{R_t}(\omega_{R_t},\omega_{R_t})$. Indeed, an $R$-linear map $f:\omega_R\to \omega_R$ induces a sequence of maps $f_t=f\otimes_R R_t: \omega_{R_t} \to \omega_{R_t}$ such that $f_{t+1} \otimes_{R_{t+1}} R_t = f_t$. This gives an element in the inverse limit. Conversely, given such a sequence of maps $\{f_n\}$ with the same compatibility property, one can define an $R$-linear map $f$ from $\omega_R$ to $\omega_R$ by the rule 
	\[f(w) \ \mathrm{mod} \,(x_1^t,\dots,x_d^t) \omega_R := f_n(w) \ \mathrm{mod} \, (x_1^t,\dots,x_d^t) \omega_R.\]
	
	Since $R_t$ is artinian, $\omega_{R_t}\cong E_{R_t}$. Then, $\Hom_{R_t}(E_{R_t},E_{R_t})\cong R_t$ by the natural map, and passing to the inverse limit gives the isomorphism.
\end{proof}


A CM local ring has a canonical module if and only if it is a quotient of a Gorenstein ring. Given a ring $R$ and a module $M$, the \emph{trivial extension}\index{trivial extension} or \emph{idealization}\index{idealization} of $R$ by $M$ is the ring $R \rtimes M$ with $R$-module structure $R \rtimes M\cong R \oplus M$ and multiplication $(r,m)(r',m')=(rr',rm'+r'm)$. It is easy to check that this structure makes $R\rtimes M$ into a ring in which $0\oplus M$ is an ideal with square zero, and $R\cong (R\rtimes M) / (0\oplus M)$. If $(R,\m)$ is local, then $(R\rtimes M, \m \oplus M)$ is local as well.

\begin{proposition} Let $(R,\m,k)$ be a Cohen-Macaulay local ring with canonical module $\omega_R$. The trivial extension $R\rtimes \omega_R$ is a Gorenstein local ring. Thus, if $R$ has a canonical module, $R$ is a quotient of a Gorenstein ring.
\end{proposition}
\begin{proof}
	Note that $R\rtimes \omega_R$ is a finitely generated $R$-module. Since a regular sequence on $R$ is also regular on $\omega_R$, this ring is also Cohen-Macaulay.
	
	We compute a canonical module for $R\rtimes \omega_R$ as $\Hom_R(R\rtimes \omega_R,\omega_R)$. As an $R$-module, this Hom is isomorphic to $\Hom_R(R,\omega_R) \oplus \Hom_R(\omega_R,\omega_R)\cong \omega\oplus R$. I'll leave to you as an exercise the routine check that the module structure on this $\omega \oplus R$ induced by the premultiplication action on $\Hom_R(R\rtimes \omega_R,\omega_R)$ agrees with the structure of $R\rtimes \omega_R$.
\end{proof}

We now show that canonical modules localize. We could work with the construction above to do this, but we will give a slightly more flexible proof. We prepare for this with a lemma.

\begin{lemma}
	Let $(R,\m,k)$ be a Cohen-Macaulay local ring, and $I\subseteq R$ be an ideal. Then $\mathrm{height}(I)=\dim(R)-\dim(R/I)$.
\end{lemma}
\begin{proof}
	Since $\mathrm{height}(I)=\min\{ \mathrm{height}(\p) \ | \ \p\in \Min(I) \}$ and $\dim(R/I)=\max\{ \dim(R/\p) \ | \ \p \in \Min(I) \}$, it suffices to show the equality for prime ideals, so let $\p$ be prime. By the worksheet on CM rings, we know that $\mathrm{height}(\p) = \depth_{\p}(R)$, and
	 $\dim(R)=\dim(R/\q)$ for all $\q\in \Ass(R)$. 
Setting $h=\mathrm{height}(\p)$, take a regular sequence $f_1,\dots,f_h\subseteq \p$. Since $\underline{f}$ is a regular sequence, $\mathrm{height}(\underline{f})=h$, so $\p$ must be a minimal prime of $(\underline{f})$. Then $R/(\underline{f})$ is CM of dimension $\dim(R)-h$. But $\p\in \Ass(R/(\underline{f}))$, so $\dim(R/\p)=\dim(R)-h$, as required.
\end{proof}

\begin{proposition}
	If $(R,\m,k)$ is a Cohen-Macaulay local ring, $\omega_R$ is a canonical module, and $\p \in \Spec(R)$, then $\omega_{R_\p}$ is a canonical module for $R_\p$.
\end{proposition}
\begin{proof}
	Let $(S,\n,l)$ be a Gorenstein ring mapping onto $R$, so that $\omega_R\cong \Ext^{\dim(S)-\dim(R)}_S(R,S)$. Let $\p\in \Spec(R)$, and $\q$ be the contraction of $\p$ in $S$. We note that if $R=S/I$, since $S$ is Cohen-Macaulay, by the previous lemma,
	\[\dim(S_\q) - \dim(R_\p) = \mathrm{height}_{S_\q}(I S_\q) = \mathrm{height}_{S}(I) = \dim(S) - \dim(R). \]
	Then, 
	\[(\omega_R)_{\p} \cong (\Ext^{\dim(S)-\dim(R)}_S(R,S))_\p \cong \Ext^{\dim(S)-\dim(R)}_{S_\q}(R_\p,S_\q)\cong \Ext^{\dim(S_\q)-\dim(R_\p)}_{S_\q}(R_\p,S_\q) \]
	is a canonical module for $R_\p$, since $S_\q$ is Gorenstein.
\end{proof}

\begin{exercise}
	Show that the minimal injective resolution of a canonical module has the same form as the minimal injective resolution of a RLR we found in the last homework.
\end{exercise}

\begin{exercise}
	Show that if $(R,\m,k)$ is a Cohen-Macaulay local ring that is a quotient of a Gorenstein ring, a module $M$ is a canonical module for $R$ if and only if $M$ is finitely generated and
	\[\Ext^i_R(k,M)\cong\begin{cases} k & \text{if} \ i=\dim(R) \\ 0 & \text{if} \ i\neq\dim(R). \end{cases}\]
\end{exercise}

\begin{proposition}
Let $(R,\m,k)$ be a CM local ring with canonical module $\omega_R$. Suppose that for every minimal prime $\p$ of $R$, $R_\p$ is Gorenstein\footnote{We say that such an $R$ is \emph{generically Gorenstein}\index{generically Gorenstein}}, e.g., $R$ is reduced. Then there is some ideal $I$ of $R$ such that $\omega_R\cong I$. If $I\cong \omega_R$, then every associated prime of $R/I$ has height one. 
\end{proposition}
\begin{proof}
We note that if $R$ is reduced, and $\p\in \Min(R)$, then $R_\p$ is a field, so ``e.g.'' is valid.

First, we show that $\omega_R$ is isomorphic to an ideal. The point is that $(\omega_R)_{\p}\cong \omega_{R_\p} \cong R_\p$ for all minimal primes $\p$ of $R$, using the exercise above and the hypothesis. If $W$ is the set of nonzerodivisors of $R$, which is the same as the set of nonzerodivisors on $\omega_R$, then $W^{-1} \omega_R \cong \prod \omega_{R_\p} \cong \prod R_\p \cong W^{-1}R$. Then, an isomorphism $W^{-1}\omega_R \cong W^{-1} R$ restricts to an injection from $\alpha: \omega_R \hookrightarrow W^{-1}R$. If $w_1,\dots,w_t$ is a generating set for $\omega_R$, and $\alpha(w_i)=r_i/s_i$, then $s_1\cdots s_t \alpha$ is an injective map from $\omega_R$ to $R$.

Now, we show that such an ideal has all associated primes of height one. To obtain a contradiction, suppose we have some $\q\in \Ass(R/I)$ of height at least two. We have that $R_\q$ is CM of dimension at least two, with canonical module $I R_\q$, so $\depth(I R_{\q})\geq 2$. On the other hand, $\depth(R_{\q}/ I R_{\q})=0$, and $\depth(R_{\q})\geq 2$, so $\depth(I R_\q)=1$. This is the desired contradiction.
\end{proof}

We recall the following fact about factorization:

\begin{exercise} If $R$ is a UFD, and $I\subseteq R$ is such that every associated prime of $R/I$ has height one, then $I$ is principal.
\end{exercise}

The following is now evident.

\begin{theorem}
If $(R,\m,k)$ is a Cohen-Macaulay UFD, and $R$ is a quotient of a Gorenstein ring, then $R$ is Gorenstein.
\end{theorem}
\begin{proof}
$R$ has a canonical module isomorphic to an unmixed height one ideal, which is necessarily principal. Thus, the canonical module is isomorphic to $R$ itself.
\end{proof}

It turns out that one cannot drop the Cohen-Macaulay hypothesis in the previous theorem.

\begin{example}
	Let $S=\FF_2[x_1,x_2,x_3,y_1,y_2,y_3]$, and $\n=(x_1,\dots,y_3)$. Let $G=\{e,\sigma\}$ be a group of order two, where $e$ is the identity. Let $G$ act on $S$ by the rule $\sigma(x_i)=y_i$ and $\sigma(y_i)=x_i$ for all $i$. Consider the ring of invariants $S^G$ with maximal ideal $\m$, the contraction of $\n$. We claim that $(S^G_\m, \m, \FF_2)$ is a UFD that is not Cohen-Macaulay.
	
	\fbox{$S^G_\m$ is a UFD:} We show that $S^G$ is a UFD. Consider an element $f\in S^G$. Since $S$ is a UFD, $f$ admits a factorization into $S$-irreducibles: \[f=a_1 \, \cdots  \, a_t.\] Then, \[a_1 \, \cdots \, a_t=f=\sigma(f)=\sigma(a_1) \, \cdots \, \sigma(a_t).\] Each $\sigma(a_i)$ must be irreducible, since one could apply $\sigma$ to a nontrivial factorization to get a nontrivial factorization of $a_i$. Thus, there is some $\tau\in \mathcal{S}_t$ such that $\sigma(a_i)=u_i a_{\tau(i)}$ for some units $u_i$. But, the only unit in $S$ is $1$. Thus, we can regroup the $a_i$'s in such a way that
	\[f = b_1 \, \cdots \, b_r \, \cdot \,  c_1 \, \cdots \, c_s \, \cdot \, \sigma(c_1) \, \cdots \, \sigma(c_s), \]
	with all $b_i$'s and $c_i$'s irreducible in $S$, $\sigma(b_i)=b_i$, and $\sigma(c_i)\neq c_i$. In particular, any irreducible element of $S^G$ must be of the form $b_1$ or $\big(c_1 \, \sigma(c_1)\big)$. It is then clear that any factorization of $f$ into $S^G$-irreducibles must be of the (unique!) form
  \[f = b_1 \, \cdots \,  b_r \, \cdot \, \big(c_1 \, \sigma(c_1)\big) \, \cdots \, \big(c_s \,\sigma(c_s)\big). \]
  
  \fbox{$S^G_\m$ is Cohen-Macaulay:} By the Theorem on symmetric polynomials, $\FF_2[x_1,y_1]$ is rank two free module over the polynomial subring $\FF_2[x_1 + y_1, x_1 y_1]$. After self-tensoring, we see that $S$ is a rank eight free module over the polynomial subring $A=\FF_2[\{x_i + y_i, x_i y_i \ | \ i=1,2,3\}]$. Since $A$ consists of invariants, $A \subseteq S^G \subseteq S$, so $A$ is a Noether normalization of $S^G$. Hence, $\{x_i + y_i, x_i y_i \ | \ i=1,2,3\}$ is a SOP for $S^G_\m$.
  
  We claim that $x_1+y_1, x_2+y_2, x_3+y_3$ is not a regular sequence in $S^G_\m$. Indeed, we have the relation
  \[ (x_1+y_1)(x_2y_3 + x_3 y_2) + (x_2+ y_2)(x_1 y_3+x_3 y_1) + (x_3+y_3)(x_1 y_2 + x_2 y_1) = 0 \]
  since every monomial in the expansion appears twice and $S^G$ has characteristic two. Each of the $(-)$ elements above invariant, so this is a relation in $S^G$, and gives a relation in $S^G_\m$.
  
  Now, we observe that the set of linear forms fixed by the group action is generated over $\FF_2$ by $x_1+y_1, x_2+y_2, x_3+y_3$. The 2-form $x_1 y_2 + x_2 y_1$ cannot be generated by these linear forms, so $x_1 y_2 + x_2 y_1 \notin (x_1+y_1, x_2+ y_2 )S^G$. We claim that $x_1 y_2 + x_2 y_1 \notin (x_1+y_1, x_2+ y_2 )S^G_\m$ as well; we leave this as an easy exercise for you. Then, we conclude that $x_3+y_3$ is a zerodivisor in $S^G_\m / (x_1+y_1, x_2+ y_2 )S^G_\m$. Therefore, $S^G_\m$ is not Cohen-Macaulay.
\end{example}

\begin{example}
	We now give a brief indication of a CM local ring with no canonical module. The hard work for this example is due to Ferrand and Raynaud, \emph{Fibres formelles d'un anneau locale noth\'erian}, who give an example of a 1-dimensional local domain $(R,\m,k)$ such that $\widehat{R}$ is \emph{not} generically Gorenstein: for some minimal prime $\p$ of $\widehat{R}$, $\widehat{R}_\p$ is not Gorenstein.
	
	Note that $R$ is Cohen-Macaulay, simply because it contains a nonzerodivisor. Suppose, that $R$ has a canonical module $\omega$. Then, since $R$ is a domain, and hence generically Gorenstein, there is an ideal $I$ of pure height one, which hence is $\m$-primary, such that $\omega\cong I$. Then, $\widehat{R}$ is CM, with canonical module $\widehat{\omega}\cong \widehat{I}$, which is also $\m$-primary. Thus, $\widehat{I}$ is not contained in any $\p\in \Min(\widehat{R})$. Thus, for $\p\in \Min(\widehat{R})$, we have 
	\[ \widehat{R}_{\p} = \widehat{I}_{\p} \cong \widehat{\omega}_{\p}, \]
	which contradicts the fact that $\widehat{R}$ is not generically Gorenstein.
\end{example}

Later examples of T.~Ogoma exhibit Cohen-Macaulay UFDs that are not Gorenstein, hence, that have no canonical module.


\section{Graded local duality and regularity}

Let $R$ be a graded ring. Unless noted otherwise, this means an $\NN$-graded ring such that $R_0=K$ is a field, and $R$ is finitely generated over $R_0$. Then, the ideal $\m=\bigoplus_{i>0} R_i$ is a maximal ideal, the \emph{maximal homogeneous ideal}. We will say that $(R,\m,K)$\index{$(R,\m,K)$} is graded to refer to this setup.

We recall that if $M$ is graded, and $I$ generated by homogeneous elements, then the \v Cech complex is graded, so $\H^i_I(M)$ is $\ZZ$-graded. In particular, $\H^i_{\m}(M)$ is $\ZZ$-graded. 

For a graded module, we set the \emph{top degree}\index{top degree}\index{$\tp(M)$} and \emph{bottom degree}\index{bottom degree}\index{$\bt(M)$} of $M$ to be 
\[\tp(M):=\max\{ i \in \ZZ \ | \ [M]_i\neq 0\} \quad \text{and} \quad \bt(M):=\min\{ i \in \ZZ \ | \ [M]_i\neq 0\}.\]

\begin{theorem} Let $(R,\m,K)$ be graded, and $M$ a finitely generated graded module. Then 
\[\tp(\H^i_\m(M))<\infty \text{ for all } i, \quad \text{and} \quad \dim_K([\H^i_\m(M)]_j)<\infty \text{ for all }i,j.\]
\end{theorem}
\begin{proof}
We recall that since $\m$ is a maximal ideal and $M$ finitely generated, $\H^i_{\m}(M)$ is artinian.
The descending chain of submodules $M_n=[\H^i_{\m}(M)]_{\geq n}$ must stabilize, so that $[\H^i_{\m}(M)]_{\geq n}=[\H^i_{\m}(M)]_{>n}$ for all $n$ greater than some $N$; that is, $[\H^i_{\m}(M)]_n=0$ for all $n$ greater than some $N$.

Now, the modules $[\H^i_\m(M)]_j\cong [\H^i_\m(M)]_{\geq j}/[\H^i_\m(M)]_{>j}$ are also artinian, and are $K$-vector spaces, hence finite dimensional.
\end{proof}

\begin{example}
The simple example $\H^1_{(x)}(K[x,y])$ shows that both statements can fail for local cohomology not supported in a maximal ideal.
\end{example}

\begin{definition}
If $(R,\m,K)$ is graded of dimension $d$, we define the \emph{a-invariant}\index{a-invariant}\index{$\ai(R)$} of $R$ to be $\ai(R)=\tp(\H^d_{\m}(R))$.
\end{definition}

For two graded $R$-modules, $M$ and $N$, we define the \emph{homogeneous maps of degree $i$}\index{homogeneous maps}\index{$\Hom_R(M,N)_i$} as
\[\Hom_R(M,N)_i=\{ \phi:M\to N \ | \ \phi \text{ is $R$-linear and } \phi(M_j)\subseteq N_{i+j} \text{ for all $j$ }\},\]
and the \emph{module of graded homomorphisms}\index{graded homomorphisms}\index{$\grHom_R(M,N)$}
\[ \grHom_R(M,N)=\bigoplus_{i\in \ZZ} \Hom_R(M,N)_i .\]
If $M$ is a finitely generated graded $R$-module, and $N$ an arbitrary graded $R$-module, then any $R$-linear map from $M$ to $N$ can be written as a sum of homogeneous maps: if $M$ is generated by homogeneous elements $m_1,\dots,m_t$, then set $\varphi_d(m_i)=[\varphi(m_i)]_{d-\deg(m_i)}$ for all $i$; these extend to homogeneous maps from $M$ to $N$, only finitely many of which are nonzero, and they sum to $\varphi$. Thus, $\grHom_R(M,N)=\Hom_R(M,N)$, after ``forgetting the graded structure.'' However, this is false if $M$ is not finitely generated over $R$: for example, if $M$ is free, the LHS gives a direct sum whereas the RHS gives a direct product.

If $M$ is a finitely generated graded $R$-module, then $M$ admits a graded free resolution by finitely generated modules: $M$ can be generated by homogeneous elements, so there is a surjection from a finitely generated graded free module into $M$; moreover, we can choose this in such a way to induce an isomorphism $F_0\otimes R/\m \cong M \otimes R/\m$:

\[ F_0=\bigoplus_{j\in \ZZ} R(-{j})^{\beta_{0,j}} \longrightarrow M \longrightarrow 0, \]
with only finitely many $\beta_{0,j} \neq 0$. The kernel of this map is a finitely generated graded module, so we can choose a surjection from a finitely generated graded free module onto it, and again we can choose one that induces an isomorphism module $\m$. Repeating, we obtain a free resolution of the form

\[ \cdots \longrightarrow \bigoplus_{j\in \ZZ} R(-{j})^{\beta_{2,j}} \longrightarrow \bigoplus_{j\in \ZZ} R(-{j})^{\beta_{1,j}} \longrightarrow \bigoplus_{j\in \ZZ} R(-{j})^{\beta_{0,j}} (\longrightarrow M) \longrightarrow 0, \]
with the image of each differential contained in $\m$ times the next module. This a \emph{graded minimal free resolution}\index{minimal free resolution} of $M$, and the numbers $\beta_{i,j}$ are the \emph{graded betti numbers}\index{betti numbers}\index{$\beta_{i,j}$} of $M$.

Consequently, if $M$ is finitely generated, $\Ext^i_R(M,N)$ and $\Tor^R_i(M,N)$ admit natural gradings.


\begin{exercise}
	If $(R,\m,K)$ is graded, and $M$ is a finitely generated graded $R$-module, then $\beta_{i,j}=\dim_K [\Tor^R_i(M,K)]_j$. Use this to show that if $R$ is a polynomial ring, the minimal resolution of $M$ is finite.
\end{exercise}

Define the \emph{graded Matlis duality functor} \index{graded Matlis duality}\index{$M^\star$} $(-)^\star$ from graded $R$-modules to graded $R$-modules by the rule
$M^{\star}=\grHom_K(M,K)$. Note that $M(d)^\star\cong M^\star(-d)$. From worksheet \#2 we know that if $M$ is a finitely generated $R$-module, $M^{\star} \cong M^{\vee}$ after ``forgetting the grading.''

\begin{definition}\index{Cohen-Macaulay} A graded ring $(R,\m,K)$ is \emph{Cohen-Macaulay} if $R_\m$ is Cohen-Macaulay.
\end{definition}

\begin{remark} This definition is consistent with the general definition of Cohen-Macaulayness for non-local rings. To see this, one can take a homogeneous Noether normalization $K[x_1,\dots,x_d] \subseteq R$ and show that this map is flat if and only if $K[x_1,\dots,x_d]_{(\underline{x})} \subseteq R_\m$ is flat. You are encouraged to fill in the rest of the argument!
	\end{remark}

\begin{definition}\index{Gorenstein}
A graded ring $(R,\m,K)$ of dimension $d$ is \emph{Gorenstein} if it is Cohen-Macaulay and $R(a)^\star \cong \H^d_{\m}(R)$.
\end{definition}
Note that if $R(d)^\star\cong \H^d_{\m}(R)$ for some $d$, then $d=a$. We caution the reader that the phrase \emph{graded Gorenstein ring} is often reserved for the case when $\ai(R)=0$. To avoid any confusion, we will try to stick with ``Gorenstein graded ring'' to refer to the situation prescribed in the definition above.

\begin{example} Let $R=K[x_1,\dots,x_d]$ be a polynomial ring with $\deg(x_i)=d_i$. Then $R$ is a Gorenstein graded ring with $a$-invariant $-\sum_i d_i$.
\end{example}

\begin{lemma} Let $(R,\m,K)$ be a Gorenstein graded ring of dimension $d$. If $f$ is a nzd on $R$ of degree $e$, then $R/fR$ is Gorenstein with $\ai(R/fR)=\ai(R)+e$.
\end{lemma}
\begin{proof}
	Set $a=\ai(R)$ and $d=\dim(R)$. From the SES
	\[ 0 \to R(-e) \stackrel{f}{\longrightarrow} R \to R/fR \to 0, \]
	apply $\H^{\bullet}_{\m}(-)$ to get
		\[ 0 \to \H^{d-1}_{\m}(R/fR) \to \H^d_{\m}(R)(-e) \stackrel{f}{\longrightarrow} \H^d_{\m}(R) \to 0, \]
		and apply $(-)^{\star}(-a-e)$ to get
		\[ 0 \to (R/fR)^{\star}(-a-e) \to R^{\star}(-a-e) \stackrel{f}{\longrightarrow} R^{\star}(-a) \to 0. \]
		There are commuting isomorphisms between the last two elements in each SES, so the first terms are isomorphic too.
\end{proof}

\begin{example} $R=\frac{K[x,y,z]}{(x^2+y^2+z^2)}$ has a negative $a$-invariant, $\ai(R)=-1$, while $S=\frac{K[x,y,z]}{(x^4+y^4+z^4)}$ has a positive $a$-invariant, $\ai(S)=1$.
\end{example}

\begin{theorem}[Graded local duality]
Let $(R,\m,K)$ be a Gorenstein graded ring of dimension $d=\dim(R)$ with $a$-invariant $a$. If $M$ is a finitely generated graded $R$-module, then both dualities hold:
	\[ \H^i_{\m}(M)\cong \Ext^{d-i}_R(M,R)^\star(-a) \text{ and } \H^i_{\m}(M)^\star\cong \Ext^{d-i}_R(M,R)(a).\]
\end{theorem}
\begin{proof}
	This is on the homework. It follows by the same steps as the local Local Duality.
\end{proof}


We now want to apply this duality to show that a version of ``free resolution complexity'' is equivalent to a version of ``cohomological complexity.'' Let us define some of these notions. Beware that the names below are nonstandard and will just be used temporarily here.

\begin{definition}
	Let $(R,\m,K)$ be a Gorenstein graded ring of dimension $d=\dim(R)$ with $a$-invariant $a$. Let $M$ a finitely generated graded module of finite projective dimension. 
	\begin{enumerate}
		\item The \emph{Tor-regularity}\index{$\Treg(M)$} of $M$ is 
		\[\Treg(M):=\max_i\{ \tp(\Tor^R_i(M,K))-i\}+(a+d)= \max_{i,j}\{  j-i \ | \ \beta_{i,j}\neq 0\} +(a+d).\]
		
		\item The \emph{Ext-regularity}\index{$\Ereg(M)$} of $M$ is 
		\[\Ereg(M):=\max_i\{ -\bt(\Ext_R^i(M,R))-i\}+(a+d).\]
		
		\item The \emph{cohomological-regularity}\index{$\Lreg(M)$} of $M$ is 
		\[\Lreg(M):=\max_j\{ \tp(\H^j_{\m}(M))+j\}  .\]
	\end{enumerate}
\end{definition}

We note that $\Lreg(M)$ is finite, by the lemma above, and that $\Treg(M)$ and $\Ereg(M)$ are finite since $M$ has a finite free resolution by finitely generated free modules.
What we will show is the following.

\begin{theorem}
	Let $(R,\m,K)$ be a Gorenstein graded ring. Let $M$ be a finitely generated graded module of finite projective dimension. 
 One has equalities $\Treg(M)=\Ereg(M)=\Lreg(M)$. The common value of these numbers is simply called the \emph{regularity} of $M$, denoted $\reg(M)$.\index{regularity}\index{$\reg(M)$}
\end{theorem}
\begin{proof}
	\fbox{$\Ereg(M)=\Lreg(M)$:} This equality is a consequence of graded local duality. We have that $\Ext^{d-i}_R(M,R)^\star(-a)\cong \H^{i}_{\m}(M)$. Then,
	\begin{align*} \Lreg(M)=\max_i\big\{ \tp(\H^i_{\m}(M))+i\big\} 
	&=  \max_i\big\{ \tp(\Ext^{d-i}_R(M,R)^\star(-a))+i\big\} \\
		&=  \max_i\big\{ \tp(\Ext^{d-i}_R(M,R)^\star)+a+i\big\} \\
 	&= \max_i\big\{ -\bt(\Ext^{d-i}_R(M,R)) + a + i\big\} \\
 	&= \max_i\big\{ -\bt(\Ext^{d-i}_R(M,R)) - (d - i)\big\} + (a+d) = \Ereg(M).
 	\end{align*}
 	
 	\fbox{$\Ereg(M)\leq\Treg(M)$:} We will show that $-\bt(\Ext^i_R(M,R)) \leq \max\{ j \ | \ \beta_{i,j}\neq 0\}$.
 	
 	Given a minimal free resolution $P_\bullet \to M$, consider $F^\bullet=\Hom_R(P_\bullet,R)$. The module $\Hom_R(R(d),R)$ is free and cyclic, generated by a map of degree $-d$, hence is isomorphic to $R(-d)$. Thus, $F^\bullet$ is of the form:
 	
 	\[ \cdots \longleftarrow \bigoplus_{j\in \ZZ} R({j})^{\beta_{2,j}} \longleftarrow \bigoplus_{j\in \ZZ} R({j})^{\beta_{1,j}} \longleftarrow \bigoplus_{j\in \ZZ} R({j})^{\beta_{0,j}} \longleftarrow 0 \]
 	
 	Then, we see that $\bt(F^i) = -\max\{j \ | \ \beta_{i,j}\neq 0\}$. Since $\Ext^i_R(M,R)$ is a quotient of a submodule of $F^i$, $\bt(\Ext^i_R(M,R))\geq \bt(F^i)$. The desired inequality follows.
 	
 	\fbox{$\Ereg(M)\geq\Treg(M)$:} Let $t= \max_{i,j}\{ j-i \ | \ \beta_{i,j}\neq 0\}$; this is $\Treg(M)$ without the $(a+d)$. We want to find a nonzero element of  $\Ext$ of sufficiently low degree, namely in $[\Ext^i_R(M,R)]_{-t+i}$ for some $i$.
	
	Pick $(i,j)$ that witness the choice of $t$ such that $i$ is maximal. That is, pick $(i,j)$ such that 
 \[ \beta_{i,j}\neq 0; \quad j-i=t; \quad j'-i'>t \Rightarrow \beta_{i',j'}=0; \quad \ i'>i \text{ and }j'-i'\geq t \Rightarrow \beta_{i',j'}=0. \]
  We can do this since $M$ has finite projective dimension. In particular, we have that the maximal degree generator of $P_i$ is in degree $j$, and $P_{i+1}$ has no generator of degree greater than~$j$.
 
 We claim that the projection $\pi: P_i \twoheadrightarrow R(-j)$ of $P_i$ onto its generator of highest degree, as a map in $[\Hom_R(P_i,R(-j))]_0 \cong [\Hom_R(P_i,R)]_{-j}$, represents a nonzero class in $\Ext_R(P_i,R)$ of degree $-j=-t+i$. 
 
 Let $\delta$ be the differential from $P_{i+1}\to P_i$, which is degree-preserving. By minimality, $\delta$ has image in $\m P_i$. Since $\m R(-j)$ lives in degrees strictly greater than $j$, and the generators of $P_{i+1}$ live in degrees at most $j$, $\pi \circ \delta$ must map each generator of $P_{i+1}$ to $0$. Thus, $\pi$ represents a cocycle in $\Hom(P_\bullet,R)$. 

Let $\delta'$ be the differential from $P_{i}\to P_{i-1}$, which has image in $\m P_{i-1}$. Note that $\pi$ splits. Suppose that $\pi$ factors through $\delta'$. Then the identity on $R(-j)$ factors through $\delta'$:
	$$\xymatrix{P_i  \ar[r]^-{\delta'} \ar[dr]^-{\pi} & P_{i-1} \ar@{->>}[d] \\
	R(-j) \ar@{^(->}[u] \ar[r]_-{\cong} & R(-j)}$$
But then, the image of the generator of $R(-j)$ in $P_i$ must map to something in $\m P_{i-1}$, which must map into $\m R(-j)$. This is a contradiction. Thus, $\pi$ does not factor through $\delta'$; i.e., $\pi$ is not a coboundary in $\Hom(P_\bullet,R)$. We conclude that $\pi$ represents the desired nonzero Ext class.
\end{proof}

One usually encounters regularity in the context of standard graded polynomial rings. We specialize to this case as a corollary.

\begin{corollary}
Let $R=K[x_1,\dots,x_d]$ be a polynomial ring, with the degree of each $x_i$ equal to one. If $M$ is a finitely generated graded $R$-module, the regularity of $M$ is equal to
\[ \reg(M) = \max_i\{ \tp(\Tor^R_i(M,K))-i\} = \max_j\{ \tp(\H^j_{\m}(M))+j\}.\]
\end{corollary}

\begin{remark}
By taking $i=0$ in the definition of $\Treg$, if $R$ is a standard graded polynomial ring, we see that $M$ can be generated by elements of degree at most $\reg(M)$. This is the key to many of the applications of regularity: it can be used to bound the degrees of generators.
\end{remark}

\begin{remark}
If $\varphi:R\to S$ is a map of graded rings such that $S$ is module-finite over the image of $R$, both are Gorenstein, and $M$ has finite projective dimension over both, then $\reg( _\varphi M) = \Lreg( _\varphi M) = \Lreg(M) = \reg(M)$. This is not so clear from the description as $\Treg(M)$. 
\end{remark}



The following corollary is also important to a number of applications. Recall that the \emph{Hilbert function}\index{Hilbert function}\index{$H(M,t)$} of a graded module $M$ (e.g., a graded ring) is the function $H(M,t):=\dim_K \big( [M]_t \big)$. If $R$ is generated in degree one as a $K$-algebra, then there exists an integer-valued polynomial $P(M,t)\in \QQ[t]$ and some $N\in \NN$ such that $H(M,n)=P(M,n)$ for all $n>N$.

\begin{corollary}
	Let $(R,\m,K)$ be a Cohen-Macaulay graded ring generated over $K$ in degree one. If $\ai(R)<0$, then the Hilbert function of $R$ \emph{is} a polynomial. That is, in the notation above, $H(R,n)=P(R,n)$ for all $n\in \NN$.
\end{corollary}
\begin{proof}
	Let $d=\dim(R)$. Let $(S,\n,K)$ be a standard graded polynomial ring that surjects onto $R$, and let $D=\dim(S)$. Since $R$ has only one nonvanishing local cohomology module, we see that $\reg(R) = \ai(R) + d < d$. If we take a minimal graded free resolution $P_\bullet$ of $R$ as an $S$-module, its length, $\pd_S(R)$, is $D-d$. Since the regularity is less than $d$, this implies that every shift in the free resolution is greater than $-D$.
	
	We claim that $H(S(-b),t)$ agrees with a polynomial in $t$ for all $t\in \NN$ if $b<D$. Recall that, for all $t\geq 0$,
	\[H(S,t)=\binom{t+D-1}{D-1}=\frac{(t+D-1) (t+D-2)\cdots (t+1)}{(D-1) (D-2) \cdots 1} \]
	 which agrees with a polynomial $C_D(t)$ that has roots $-1,-2,\dots,-(D-1)$. Of course, $H(S,t)=0$ for $t<0$. Then,
	 \[ H(S(-b),t)=H(S,t-b)=\begin{cases} C_D(t-b) & \text{if} \ t-b\geq 0 \\  0 & \text{if} \ t-b< 0 \end{cases} =\begin{cases} C_D(t-b) & \text{if} \ t-b > -D \\  0 & \text{if} \ t-b \leq -D\,, \end{cases}\]
	 where in the last equality we used the observation on the roots. If $b<D$, then $t-b>-D$ for all $t\in \NN$, which establishes the claim.
	 
	 Now, since the Hilbert function of a direct sum is the sum of the Hilbert functions, each free module $P_i$ in the minimal resolution has a polynomial Hilbert function. Finally, $H(M,t)=\sum (-1)^i H(P_i,t)$ is then a polynomial function.
\end{proof}


\section{Advertisement for/translation to algebraic geometry}

It doesn't make much sense to cover scheme theory in detail in this course. We do, however, want to explain the geometric meaning of local cohomology at least to the extent so that one can translate geometric results into algebraic results and vice versa.

If $X$ is a topological space, we can view the collection of open sets with inclusion maps as a category; we denote this category as $\opens(X)$.
Recall that a \emph{sheaf of abelian groups}\index{sheaf} $\cF$ on $X$ is a contravariant functor from $\opens(X)$ to the category of abelian groups such that, for any $U\in \opens(X)$ and any open cover $\{U_i\}$ of $U$, 
\begin{itemize}
	\item if the image of $\alpha\in \cF(U)$ is zero in each $\cF(U_i)$, then $\alpha=0$, and
	\item if $\{\alpha_i\in \cF(U_i)\}$ are such that for all pairs $i,j$, the images of $\alpha_i$ and $\alpha_j$ agree in $\cF(U_i\cap U_j)$, then there is some $\alpha\in \cF(U)$ such that for each $i$, the image of $\alpha$ in $U_i$ is $\alpha_i$.
\end{itemize}

In short, a sheaf associates to each open set $U$ an abelian group $\cF(U)$, which in practice often are naturally functions on $U$, in a way that behaves well with respect to restriction, and with respect to taking open covers. The elements of $\cF(U)$ are called \emph{sections}\index{sections}.

\begin{example}
	To any topological space $X$ and abelian group $A$, we can define a \emph{constant sheaf}\index{constant sheaf}\index{$\underline{A_X}$} $\underline{A_X}$ given by $\underline{A_X}(U)=A^{\oplus \mu(U)}$, where $\mu(U)$ is the number of connected components of $U$. We think of $\underline{A_X}(U)$ as the locally constant functions from $U$ to $A$; we get the direct sum since locally constant functions can be specified independently on different connected components of a space.
\end{example}

The \emph{global sections functor}\index{global sections}\index{$\Gamma(X,\cF)$} from sheaves on a space $X$ to abelian groups is given by $\Gamma(X,\cF)=\cF(X)$. One can, and in a Hartshorne class does, make sense of the notions of kernel and cokernel of a map of sheaves, injective sheaves, and injective resolutions of sheaves. One proves that $\Gamma(X,-)$ is left-exact, and defines \emph{sheaf cohomology} as a right-derived functor $\H^i(X,-):=R^i\Gamma(X,-)$. This machinery is partly motivated by the following.

\begin{theorem}
	Let $X$ be a paracompact and locally contractible topological space, e.g., a CW complex. Let $A$ be an abelian group. Then, $\H^i_{\mathrm{sing}}(X;A)\cong \H^i(X,\underline{A_X})$. That is, singular cohomology can be computed as sheaf cohomology of the constant sheaf.
\end{theorem}

By the definition of sheaf, sections are determined locally, in the sense that the global sections can be recovered from any open cover. One can ask to what extent the global sections can be recovered from ``most'' of an open cover, like an open cover of $X\setminus Z$ for some closed subset $Z$.

\begin{definition}
	Let $X$ be a topological space, $\cF$ be a sheaf on $X$, $U\subseteq X$ be open, and $Z=X\setminus U$ closed. The group of \emph{sections of $\cF$ with support}\index{sections with support}\index{$\Gamma_Z(X,\cF)$} in $Z$ is $\Gamma_Z(X,\cF):=\ker(\cF(X)\to\cF(U))$, where the map is the restriction map coming from the definition of sheaf.
\end{definition}

One shows that this functor is also left exact, and then poses the following.

\begin{definition}
		Let $X$ be a topological space and $Z=X\setminus U$ closed. The \emph{local sheaf cohomology functors with support in $Z$} are the right derived functors of $\Gamma_Z(X,-)$, namely,
		$ \H^i_{Z}(X,-):= R^i \Gamma_Z(X,-).$ 
\end{definition}

If $U\subseteq X$ is open and $Z=X\setminus U$, then given an injective resolution of sheaves $\cF \to \cE^{\bullet}$, there is a short exact sequence of complexes
\[ 0 \to \Gamma_Z(X,\cE^{\bullet}) \to \Gamma(X,\cE^{\bullet}) \to \Gamma(U,\cE^{\bullet}) \to 0, \]
which yields a long exact sequence of cohomology:
\[ 0 \to  \H^0_Z(X,\cF)\to \H^0(X,\cF) \to \H^0(U,\cF) \to \H^1_Z(X,\cF) \to \H^1(X,\cF) \to \H^1(U,\cF) \to \H^2_Z(X,\cF)\to\cdots.\]

In light of this sequence and the theorem above, the following is not surprising.

\begin{theorem}
	Let $X$ be a paracompact and locally contractible topological space, e.g., a CW complex. Let $Z\subseteq X$ be closed. Let $A$ be an abelian group. Then, $\H^i_{\mathrm{sing}}(X, X\setminus Z;A)\cong \H^i_Z(X,\underline{A_X})$.
\end{theorem}

Now, let $R$ be a noetherian ring, and $X=\Spec(R)$. A basis of open sets for the topological space $X$ is given by $U_f=\Spec(R)\setminus \V(f)\cong \Spec(R_f)$. Any $R$-module $M$ has a \emph{sheafification}\index{sheafification}\index{$\widetilde{M}$}, $\widetilde{M}$, which is the unique sheaf on $X$ such that for each $f\in R$, $\widetilde{M}(U_f)\cong M_f$. In particular, $\Gamma(X,\widetilde{M})=M$. The fact that this prescription is compatible with the sheaf axioms, even when only considering open sets in the basis, requires a proof, but can be found in Mel's 614 notes. The sheafification of $R$ is called the \emph{structure sheaf}\index{structure sheaf}, and often denoted $\mathcal{O}_X:= \widetilde{R}$.\index{$\mathcal{O}_X$} We note that if $R$ is a domain, then the sections of the structure sheaf can be computed as a subset of the fraction field $K$: 
\[ \mathcal{O}_X(U)=\bigcap_{\p\in U} R_\p = \left\{ f\in K \ | \ \forall \p \in U, \exists a\in R, b\in R\setminus \p : f=a/b\right\}.\]

\begin{proposition}
	Let $R$ be a noetherian ring, and $X=\Spec(R)$. Let $Z=\V(I)$ be closed. Then $\Gamma_{Z}(X,\widetilde{M})\cong \Gamma_I(M)$ and $\H^i_{Z}(X,\widetilde{M})\cong \H^i_I(M)$ for all $i\geq 0$.
\end{proposition}
\begin{proof}
	By definition, $\Gamma_{Z}(X,\widetilde{M})\cong \ker\big( M \to \widetilde{M}(U) \big)$. Write $I=(f_1,\dots,f_t)$, so $U=\cup_i U_{f_i}$. An element of $M$ maps to zero in $\widetilde{M}(U)$ if and only if it maps to zero in each $\widetilde{M}(U_{f_i})$. But this is equivalent to being killed by a large power of each $f_i$; equivalently a large power of $I$. This takes care of the first assertion.
	
	For the second, we use (without proof) the fact that if $E$ is injective, then $\widetilde{E}$ is an injective sheaf; this uses noetherianity. Then, if $M$ is an $R$-module, and $M\to E^{\bullet}$ is an injective resolution, 
	\[\H^i_I(M) \cong H^i\big(\Gamma_I(E^{\bullet})\big) \cong H^i\big( \Gamma_{Z}(X,\widetilde{E^{\bullet}}) \big) \cong \H^i_{Z}(X,\widetilde{M}).\]
	\end{proof}

\begin{proposition}
	Let $R$ be a noetherian ring, and $X=\Spec(R)$. Let $Z=\V(I)$ be closed, and $U=X\setminus Z$. Let $M$ be an $R$-module. Then, there is a medium exact sequence
	\[ 0\to \H^0_I(M) \to M \to \Gamma(U,\widetilde{M}) \to \H^1_I(M)\to 0, \]
	and isomorphisms for all $i\geq 2$
	\[ \H^{i}_I(M) \cong \H^{i-1}(U,\widetilde{M}).\]
\end{proposition}
\begin{proof}
Since $\Gamma(X,\widetilde{M})=M$ for all modules $M$, the LHS as a functor of $M$ is exact. In particular, if $M\to E^{\bullet}$ is an injective resolution of $M$, the complex $\Gamma(X,\widetilde{E^{\bullet}})$ has homology only in the zeroth position, so $\H^i(X,\widetilde{M})=0$ for $i>0$.

Applying this vanishing and the previous proposition to the LES above gives the result.
\end{proof}

\begin{corollary}
	Let $R$ be a noetherian ring, and $X=\Spec(R)$. Let $Z=\V(I)$ be closed, and $U=X\setminus Z$. If $\depth_I(M)\geq 2$, then any section of $\widetilde{M}$ on $U$ extends uniquely to a section on $X$, and conversely.
\end{corollary}

\begin{example}
	Let $R=K[x,y]$ and $\m=(x,y)$. By the previous theorem, since $\H^0_\m(R)=\H^1_\m(R)=0$, there is an isomorphism $R\cong \mathcal{O}_{\Spec(R)}(\Spec(R)\setminus\{\m\})$. That is, if $f \in K(x,y)$ is such that for any $\p \not\supseteq \m$, $f$ can be written with a denominator not in $\p$, then $f\in R$. This is clear, since $R$ is a UFD, so any $f\in K$ can be written uniquely up to units in lowest terms as a quotient $g/h$ of elements of $R$. But then $h$ is contained in some height 1 prime $\p$, and $g/h\neq a/b$ for any $a,b$ with $b\notin \p$, so $f\notin R_{\p}$.
\end{example}

\begin{example}
	Let $\displaystyle S=\frac{K[x,y,u,v]}{(xu-yv)}$, and $I=(x,y)$. By the previous theorem, since $\H^1_\m(R)\neq 0$, some element of $\mathcal{O}_{\Spec(S)}(\Spec(S)\setminus \V(I))$ does not lie in $S$. Indeed, the element $\displaystyle \frac{v}{x}=\frac{u}{y} \in \mathrm{frac}(S)$ is well-defined on $\Spec(S)\setminus \V(I)$, but is not equal to an element of $S$.
\end{example}



There are especially nice connections between graded local cohomology and projective varieties. One way to describe projective space\index{projective space} $\PP^n$ is by its graded structure, $\PP^n=\mathrm{Proj}(S)$, where $S=K[x_0,\dots,x_n]$, and $\mathrm{Proj}$\index{$\mathrm{Proj}$} calls for the homogeneous primes of $S$ other than $\m$. This structure accounts for its nice compactness properties. Alternatively, $\PP^n$ can be described as a bunch of affine spaces glued together, which allows it to be compared to other classes of varieties. That is: $\PP^n=\bigcup_{i=0}^n \AA^n_i$, where 
\[\AA^n_i=\{ \p \in \mathrm{Proj}(S) \ | \ x_i \notin \p \} \cong \Spec\left(K\left[{x_0}/{x_i},\dots,{x_n}/{x_i}\right]\right).\] 

Since the $\AA^n_i$'s form an open cover, this also gives a recipe for a structure sheaf $\mathcal{O}_{\PP^n}$, setting\index{$\mathcal{O}_{\PP^n}$} $\mathcal{O}_{\PP^n}(\AA^n_i)=K\left[{x_0}/{x_i},\dots,{x_n}/{x_i}\right]$. Following this philosophy gives an analogue of sheafifications of modules on affine varieties. We say that $\cM$ is a \emph{coherent sheaf}\index{coherent sheaf} on $\PP^n$ if for each $i=0,\dots,n$, the restriction of $\cM$ to each open set $\AA^n_i\subseteq \PP^n$ agrees with the sheaf $\widetilde{M}$ on $\AA^n_i$ for some finitely generated module $M$.

Coherent sheaves, and the structure sheaf of $\PP^n$ can also be characterized using the graded structure. If $f$ is homogeneous, let $W_f=\{ \p \in \mathrm{Proj}(S) \ | \ f\notin \p\}$. The set of $W_f$'s forms a basis of open sets for $\PP^n$.

\begin{definition}
	Let $S=K[x_0,\dots, x_n]$. If $M$ is a graded $S$-module, we define the \emph{graded sheafification}\index{sheafification}\index{$\dtil{M}$} $\dtil{M}$ to be the sheaf on $\PP^n$ such that $\dtil{M}(W_f)=[M_f]_0$ for all homogeneous $f$.
\end{definition}

We opt here for such egregious notation to avoid any confusion with the sheafification $\widetilde{M}$, which is a sheaf on $\AA^{n+1}$.

\begin{example}
	One has $\dtil{S}\cong \mathcal{O}_{\PP^n}$. Indeed, granted the assertion that both sides are sheaves on $\PP^n$, it suffices to check the equivalence on an open cover. We compute $\dtil{S}(\AA^n_i)=[S_{x_i}]_0\cong K[x_0/x_i,\dots,x_n/x_i]$, as required.
\end{example}

The following theorem of Serre is worth noting.

\begin{theorem}
Let $S=K[x_0,\dots, x_n]$. Every coherent sheaf on $\PP^n$ is of the form $\dtil{M}$ for some finitely generated graded $S$-module $M$, and conversely. One has $\dtil{M}\cong \dtil{N}$ if and only if there is some $t\in \ZZ$ such that $[M]_{\geq t}\cong [N]_{\geq t}$.
\end{theorem}


We can now state the relationship between graded local cohomology and sheaf cohomology of projective varieties.

\begin{theorem}
	Let $S=K[x_0,\dots, x_n]$, with homogeneous maximal ideal $\m$, and let $M$ be a finitely generated graded $S$-module. Then, for each $t\in \ZZ$, there is medium exact sequence
	\[ 0\to [\H^0_{\m}(M)]_t \to [M]_t \to \Gamma(\PP^n,\dtil{M(t)}) \to [\H^1_\m(M)]_t \to 0, \]
	and isomorphisms for all $i\geq 2$
	\[ [\H^{i}_{\m}(M)]_t \cong \H^{i-1}(\PP^n,\dtil{M(t)}).\]
\end{theorem}
\begin{proof}
	One can argue analogously to the affine version, using modules and resolutions consisting of injectives in the category of graded modules. Instead, we will use the geometry analogue of the Fundamental Theorem of Local Cohomology. We can prove the medium exact sequence with using neither though.
	
	Let $M$ be a graded module. Then, 
	\[ [\check{C}^\bullet(\underline{x};M)]_0 = 0 \to [M]_0 \stackrel{\delta^1}{\longrightarrow} \bigoplus_i [M_{x_i}]_0 \stackrel{\delta^2}{\longrightarrow} \bigoplus_{i,j} [M_{x_i x_j}]_0 \to \cdots. \]
	By definition, $\ker(\delta^1)=[\H^0_\m(M)]_0$. We compute
	\[\ker(\delta^2)=\ker\Big( \bigoplus_i \Gamma(\AA^n_i,\dtil{M}) \to \bigoplus_{i,j} \Gamma(\AA^n_i \cap \AA^n_j,\dtil{M}) \Big) = \Gamma(\PP^n,\dtil{M}) ,\]
	where the last equality comes from the definition of sheaf. Stitching together, we get the medium exact sequence in the statement.
	
	For the higher cohomologies, we use the fact that sheaf cohomology can be computed by a \v Cech complex on an affine cover: for a sheaf $\cF$,
	\[ \H^t(\PP^n, \cF) = H^t \left( 0 \to \bigoplus_i \Gamma(\AA^n_i, \cF) \to \bigoplus_{i,j}\Gamma(\AA^n_i \cap \AA^n_j,\cF) \to \cdots \to \Gamma(\cap_i \AA^n_i,\cF) \to 0 \right). \]
	Picking $\cF=\dtil{M}$, this gives
	\[\H^t(\PP^n, \dtil{M}) = H^t \left( 0 \to \bigoplus_i [M_{x_i}]_0 \to \bigoplus_{i,j} [M_{x_i x_j}]_0 \to \cdots \to [M_{x_0\cdots x_n}]_0 \to 0 \right),\]
	which is a truncation of the \v Cech complex $[\check{H}(\underline{x};M)]_0$. In particular, for $i\geq 2$, we compute $[\H^{i}_{\m}(M)]_0$ and $\H^{i-1}(\PP^n,\dtil{M})$ as cohomology of the same pair of maps.
	
	For other $t\in \ZZ$, the statement follows by shifting degrees.
\end{proof}




\chapter{Mayer-Vietoris and connectedness results}

\section{Worksheet on Mayer-Vietoris sequence}

\begin{enumerate}
\item Let $R$ be a ring, $M$ an $R$-module, and $\aa,\bb,\cc$ ideals of $R$.


\begin{enumerate}
\item Show that if $\aa\subseteq \cc$, there is an injective map $\Gamma_{\cc}(M)\to \Gamma_{\aa}(M)$, functorial in $M$.


\item Show that 
\[ 0\to \Gamma_{\aa+\bb}(M) \to \Gamma_{\aa}(M) \oplus \Gamma_{\bb}(M) \to \Gamma_{\aa\cap\bb}(M)\]
is left exact. 


\item Show that if $R$ is noetherian, and $M=E$ is injective, then the sequence above is exact on the right.


\item Show that if $R$ is noetherian, then there is a LES 



\[ 0 \to \H^0_{\aa+\bb}(M) \to \H^0_{\aa}(M) \oplus \H^0_{\bb}(M) \to \H^0_{\aa\cap\bb}(M) \to \H^1_{\aa+\bb}(M) \to \H^1_{\aa}(M) \oplus \H^1_{\bb}(M) \to \H^1_{\aa\cap\bb}(M) \to \cdots\]


This is called the \emph{Mayer-Vietoris sequence}\index{Mayer-Vietoris} of local cohomology.
\end{enumerate}

\

\item \begin{enumerate}

\item Compute the cohomological dimension of $I=(x,y)\cap(u,v)$ in $K[x,y,u,v]$.



\item Compute the cohomological dimension of $J=(x,y,z)\cap(u,v,w)$ in $K[x,y,z,u,v,w]$



\item Based on the previous computations and the number of generators of the ideals, give a range of possible values for $\mathrm{ara}(I)$ and $\mathrm{ara}(J)$.

\end{enumerate}
\end{enumerate}



\begin{definition} If $(R,\m,k)$ is a local ring, the \emph{punctured spectrum}\index{punctured spectrum}\index{$\Spec^{\circ}(R)$} of $R$ is the topological space $\Spec^{\circ}(R):=\Spec(R) \setminus \{\m\}$.
\end{definition}


\begin{enumerate}\setcounter{enumi}{2}
\item Let $(R,\m,k)$ be a local ring.



\begin{enumerate}
	\item Prove that the (unpunctured) spectrum of $R$, $\Spec(R)$, is connected as a topological space.

\item Prove that $\Spec^{\circ}(R)$ is disconnected (as a topological space) if and only if there exist ideals $\aa,\bb\subseteq R$, neither of which $\m$-primary, such that $\sqrt{\aa \cap \bb}=\sqrt{(0)}$ and $\sqrt{\aa + \bb} = \m$.


\item Show that if $\depth(R)\geq 2$, then $\Spec^{\circ}(R)$ is connected.

\item Show that if $R$ is Cohen-Macaulay, and $\mathrm{height}(I)>1$, then $\Spec(R) \smallsetminus \V(I)$ is connected.

\end{enumerate}

\

\item We will also use another long exact sequence. Let $R$ be a noetherian ring, $I$ an ideal, and $x\in R$. Then for any $R$-module $M$, 
\[ 0\to \H^0_{I+(x)}(M)\to \H^0_I(M)\to \H^0_{I}(M_x)\to \H^1_{I+(x)}(M) \to \cdots. \]



\begin{enumerate}
	\item Show that $0 \to \Gamma_{I+(x)}(E) \to \Gamma_I(E) \to \Gamma_I(E_x) \to 0$ is exact for any injective module $E$.
	

	
	\item Prove the existence of the long exact sequence above.
	
	
	
	\item Show that if $I=(f_1,\dots,f_t)$, then there is a short exact sequence of complexes 
	\[0 \to \check{C}^{\bullet}(\underline{f};M_x)[-1] \to \check{C}^{\bullet}(\underline{f},x;M) \to \check{C}^{\bullet}(\underline{f};M) \to 0.  \]
	
	
	
	\item Give a second proof of the long exact sequence above.
	
	
\end{enumerate}

\item Compute $\mathrm{ara}(I)$ and $\mathrm{ara}(J)$ from \#2.


\end{enumerate}



\section{The Hartshorne-Lichtenbaum vanishing theorem}

We will be able to use the Mayer-Vietoris sequence to prove even stronger results once we have established the following vanishing theorem for local cohomology.

\begin{theorem}[Hartshone-Lichtenbaum vanishing]
	Let $(R,\m,k)$ be a complete local domain of dimension $d$. If $\sqrt{I}\neq \m$, then $\H^d_{I}(R)=0$.
\end{theorem}

Combined with Grothendieck nonvanishing, we have that $\cd(J)=d$ if and only if $J$ is $\m$-primary; in the other case, ``$<$'' holds. The rough outline of the proof is
\begin{enumerate}
	\item Reduce to the case $\p$ is a prime with $\dim(R/\p)=1$,
	\item Reduce to the case that $R$ is Gorenstein,
	\item Compute the local cohomology via symbolic powers: $\H^d_{\p}(R)=\varinjlim \Ext^{d}_R(R/\p^{(t)},R)$.
\end{enumerate}

We will use the following lemma in step 2.

\begin{lemma}
	Let $R$ be a normal domain, and $S=R[s]$ a domain generated by one integral element over $R$. Then, the minimal monic polynomial $f(x)$ of $s$ over the fraction field of $R$ has coefficients in $R$, and $S\cong R[x]/(f)$.
\end{lemma}
\begin{proof}
	Let $K=\mathrm{frac}(R)$. Let $g(x)$ be some equation of integral dependence for $s$ over $R$. Viewing $g(x)$ as an element of $K[x]$, we find that $f(x) | g(x)$, so all roots of $f$ (in some fixed algebraic closure of $K$) are roots of $g$, and hence integral elements over $R$. The coefficients of $f$ are elementary symmetric functions of the roots, hence are integral over $R$, and lie in $K$. Since $R$ is normal, we get that $f(x)\in R[x]$.
	
	Now, we claim that $(f)$ generates the kernel of $R[x]\to R[u]$. Since $f(x)$ is monic, we can run the division algorithm on any element $h(x)\in R[x]$ by $f(x)$ to write $h(x)=f(x)a(x)+b(x)$, for some unique $a(x),b(x)\in R[x]$ such that $\deg(b)<\deg(f)$. But then we have $0=h(s)=b(s)$, which that $f(s)$ is the minimal polynomial of $s$ over $K$ unless $b=0$. This establishes the claim.
\end{proof}

To prepare for step 3, we prove a couple more preliminary results.

\begin{theorem}[Chevalley's theorem]
	Let $(R,\m,k)$ be a complete local ring, and $E=E_R(k)$. Let $\{I_t\}$ be a descending chain of ideals of $R$. Then $\bigcap_t I_t=0$ if and only if for each $n$ there is a $t$ such that $I_{t} \subseteq \m^n$.
\end{theorem}
\begin{proof}
	``If'' is an immediate consequence of the Krull intersection theorem.
	
Set $V_{t,n}=(I_t + \m^n) / \m^n \subseteq R/\m^n$. Since $R/\m^n$ is artinian, for any $n$, the descending chain of ideals $\{ V_{t,n} \}_t$ must stabilize: call this stable ideal $V_{\infty,n}$. The surjections $R/\m^{n+1}\twoheadrightarrow R/\m^{n}$ induce surjections $V_{t,n+1}\twoheadrightarrow V_{t,n}$ for all $t,n$, and in particular, $V_{\infty,n+1}\twoheadrightarrow V_{\infty,n}$. By taking inverse limits we obtain an ideal $V=\varprojlim_n V_{\infty,n} \subseteq \varprojlim R/\m^n = R$.
We see that 
\[V = \bigcap_{t,n} I_t + \m^n = \bigcap_t \Big( \bigcap_n I_t + \m^n \big) = \bigcap_t I_t =0.\]
Since the maps in the inverse limit system are surjective, a nonzero element of $V_{\infty,n}$ yields a nonzero element of $V$, which is a contradiction. Then, each $V_{\infty,n}=0$, so $V_{t,n}=0$ for some large $t$; that is, $I_t\subseteq \m^n$ for some large $t$. 
\end{proof}

\begin{example}
	The completeness hypothesis is necessary. Let $k$ be a field of characteristic zero, and $(R,\m,k)$ the localization of $k[x,y]$ at $(x,y)$. Set $e_n(x)=\sum_{i=1}^n \frac{x^i}{i!} \in R$, and $e(x)= \sum_{i=1}^{\infty} \frac{x^i}{i!} \in \widehat{R}$. Consider the sequence of ideals $I_t=(y-e_{t-1}(x),y^t,x^t)$. We claim that $\{I_t\}_t$ is a descending sequence of ideals with  $\bigcap_t I_t = 0$, but $\{I_t\}_t$ is not cofinal with $\{\m^n\}_n$. The latter statement is clear, since $y-e_{t-1}(x)\notin \m^2$. It is clear that $I_{t+1}\subseteq I_t$ for all $t$. Note that $I_t \widehat{R} = (y-e(x),x^t,y^t)$ for all $t$. It is then clear that $\bigcap_t (I_t \widehat{R}) = (y-e(x))\widehat{R}$, so $\bigcap_t I_t \subseteq (y-e(x))\widehat{R} \cap R = (0)$.
\end{example}

\begin{corollary}
	Let $(R,\m,k)$ be a complete local domain, and $\p$ be a prime with $\dim(R/\p)=1$. Then the sequences of ideals $\{\p^{(m)}\}_{m \in \NN}$ and $\{\p^{n}\}_{n \in \NN}$ are cofinal.
\end{corollary}
\begin{proof}
	Clearly $\p^{n} \subseteq \p^{(n)}$ for all $n$, so we need to show that for each $n$, there is some $m$ such that $\p^{(m)}\subseteq \p^n$. 
	
	Since $\V(\p)=\{\p,\m\}$, every $\p^n=\p^{(n)}\cap I_n$ for some $\m$-primary ideal $I_n$. By Krull intersection, $(\bigcap \p^{(n)})R_\p \subseteq \bigcap \p^t R_\p = 0$, so $\bigcap \p^{(n)}=0$, since $R$ is a domain. Since $I_n$ is $\m$-primary, there is some $m$, WLOG larger than $n$, such that $\p^{(m)}\subseteq I_n$. Then $\p^{(m)}\subseteq I_n \cap \p^{(n)} = \p^n$, as required.
\end{proof}

We now begin the proof of the theorem.

\begin{proof}[Proof of Hartshorne-Lichtenbaum:]
	
	\
	
	{\it Reduction to case $\dim(R/\p)=1$, $\p$ prime:} Let $I$ be an ideal maximal wrt the property that $\H^d_I(R)\neq 0$ and $I$ is not $\m$-primary. If $R/I$ is not a 1-dimensional domain, there is some $x\notin I$ such that $\dim(R/(I+(x)))\geq 1$. Now use the LES from the worksheet:
	\[ \H^d_{I+(x)}(R) \to \H^d_{I}(R) \to \H^d_{I_x}(R_x) \to 0. \]
	Since $R$ is a local domain, $\dim(R_x)<d$, and then $\H^d_{I}(R)\neq 0$ implies $\H^d_{I+(x)}(R)\neq 0$. This contradicts the maximality of our counterexample. Thus, we can assume that $R/I$ is a 1-dimensional domain.
	
		\
	
	{\it Reduction to case $R$ is Gorenstein:} Our goal in this step is to find some complete Gorenstein local domain $B$ such that $B\subseteq R$ is module-finite, and $\p=\sqrt{\q R}$ for some prime $\q=\p \cap B\in \Spec(B)$ with $\dim(B/\q)=1$. Once we have this, if we know the theorem for $\q \subseteq B$, then
	\[\dim(R)=\dim(B) > \cd(\q,B) \geq \cd(\q,R) = \cd(\q R,R) = \cd(\p, R),\]
	establishing the theorem for $\p \subseteq R$. 
	
	Since $R$ is complete, and hence the image of a Cohen-Macaulay ring, we have the equality $d-1 = \dim(R)-\dim(R/\p) = \mathrm{height}(\p)$. Let $V$ be a coefficient field or coefficient DVR for $R$. By a prime avoidance argument, we can pick $x_1,\dots,x_{d-1} \in \p$ such that $\mathrm{height}(x_1,\dots,x_{d-1})=d-1$, and if $(V,pV)$ is a DVR and $p\in \p$, also $x_1=p$. Pick $x_d \in \p$ that is not in any other minimal prime of $(x_1,\dots,x_{d-1})$, so $\sqrt{(x_1,\dots,x_{d-1},x_d)}=\p$. 
	
	We want to pick $y$ such that $V\llbracket x_1,\dots,x_{d-1},y\rrbracket\subseteq R$ is module-finite. By NAK, it suffices to find $y$ such that the maximal ideal of this power series ring expands to an $\m$-primary ideal of $R$. If $V$ is a field, or a DVR $(V,pV)$ and $p\in \p$, picking any $y \notin \p$ makes $x_1,\dots,x_{d-1},y$ a SOP for $R$, so this works. If $V$ is a DVR $(V,pV)$ and $p \notin \p$, then $x_1,\dots,x_{d-1},p$ is a SOP for $R$, so set $y=0$.
	
	Now, if $A=V\llbracket x_1,\dots,x_{d-1},y\rrbracket$, then $B=A[x_d]$ is module-finite over $A$, since $x_d\in R$. The unique maximal ideal of $B$ is $\m\cap B$, so it is local. By module-finiteness, $B$ is complete wrt the topology of $A$, which agrees with the $\m\cap B$-adic topology, so it is complete lcoal domain. Since $A$ is regular, and hence normal, the lemma above ensures that $B\cong A[x]/(f)$ for some regular element $f$. Thus $B$ is a complete intersection, and hence Gorenstein.
	
	Now, $B\subseteq R$ and $B/ (\p \cap B) \subseteq R/\p$ are module-finite, so $\dim(B)=\dim(R)$, and $\dim(B/ (\p \cap B))=\dim(R/\p)=1$. By construction, $(x_1,\dots,x_d)\subseteq (\p \cap B)R$, so $\sqrt{(\p \cap B)R}=\p$, as required.
	
	
		\
	
	{\it Proof in case $R$ is Gorenstein, $\p$ prime, $\dim(R/\p)=1$:}
	By the corollary above, we know that the symbolic powers of $\p$ form a cofinal system with with powers of $\p$. Thus, $\H^d_{\p}(R)=\varinjlim \Ext^{d}_R(R/\p^{(t)},R)$. We claim that every term in the direct system is zero. Indeed, by local duality, $\Ext^{d}_R(R/\p^{(t)},R)\cong \H^0_{\m}(R/\p^{(t)})^{\vee}$. But $\m\notin\Ass(R/\p^{(t)})$, so $\depth(R/\p^{(t)})>0$, hence $\H^0_{\m}(R/\p^{(t)})$, as required.
	\end{proof}




\section{Connectivity results}

It is clear that the punctured spectrum of a domain is connected: for any cover of the punctured spectrum, one of the covering sets must contain $(0)$, and hence must contain the whole punctured spectrum. One might hope that if $R$ is close to being a domain in some sense, then the punctured spectrum of $R$ is still connected. If $R$ is complete, then it is the quotient of a regular ring, hence of a domain. Thus, one could sensibly ask whether if a domain quotiented out by sufficiently few equations has a connected punctured spectrum. This turns out the have a positive answer.

\begin{theorem}[Faltings' connectedness theorem]\index{Faltings' connectedness theorem}
	Let $(R,\m,k)$ be a complete local domain of dimension $d$, and $I$ an ideal with arithmetic rank at most $d-2$. Then $\Spec^{\circ}(R/I)$ is connected.
\end{theorem}
\begin{proof}
	Let  $\aa$ and $\bb$ be ideals such that $\V(\aa)$ and $\V(\bb)$ give a (possibly improper) disconnection of $\V(I)$ in $\Spec^{\circ}(R)$. That is, $\aa$ and $\bb$ such that $\sqrt{\aa \cap \bb}=\sqrt{I}$ and $\sqrt{\aa + \bb}=\m$. We will show that either $\aa$ or $\bb$ is $\m$-primary.
	
	We have that $\H^d_{\aa \cap \bb}(R)=\H^d_{I}(R)=0$, and $\H^{d-1}_{\aa \cap \bb}(R)=\H^{d-1}_{I}(R)=0$, by the hypothesis on arithmetic rank. The Mayer-Vietoris sequence reads
	
	\[ \cdots \to 0 \to \H^{d}_{\aa + \bb}(R) \to \H^d_{\aa}(R) \oplus \H^d_{\bb}(R) \to 0, \]
	and, since $\H^{d}_{\aa + \bb}(R)= \H^d_{\m}(R)\neq 0$, we must have that either $\H^d_{\aa}(R)\neq 0$ or $\H^d_{\bb}(R)\neq 0$. By HLVT, this means either $\aa$ or $\bb$ is $\m$-primary, so in fact the disconnection is improper.
\end{proof}

We now want to apply this statement to intersections of projective varieties. First, we give a couple of lemmas that will give us an appropriate complete domain to work with.

\begin{lemma}
	Let $K$ be an algebraically closed field, and $R$ and $S$ be two finitely generated $K$-algebras that are domains. Then $R\otimes_K S$ is also a domain.
\end{lemma}
\begin{proof}
	Let $L=\mathrm{frac}(S)$. First, we will show that $R\otimes_K L$ is a domain. Write $R=K[\underline{x}]/(\underline{h})$. If $R\otimes_K L$ is not a domain, there are two polynomials in $L[\underline{x}]$ whose product lies in $(\underline{h})$. We can write this as a system of equations:
	\[ \Big(\sum f_{\alpha} x^{\alpha} \Big) \Big( g_\beta x^{\beta} \Big) = \sum \Big( \sum r_{\gamma} x^{\gamma} \Big) \Big( h_{i, \zeta} x^{\zeta} \Big), \]
	where each greek letter is a multiindex. By expanding and collecting coefficients of monomials, this gives a system of polynomial equations, where the $f_\alpha$'s, $g_\beta$'s, and $r_\gamma$'s are all variables. This system of equations has coefficients in $K$. If there is a solution over $L$, then $1$ is not in the ideal of equations over $L[\{ f_\alpha , g_\beta, r_\gamma \}]$, so $1$ is not in the ideal of equations over  $K[\{ f_\alpha , g_\beta, r_\gamma \}]$. By the Nullstellensatz, there must be a solution over $K$, contradicting that $R$ is a domain.
	
	Now, since $R$ is flat over $K$, we have that $R\otimes_K S \subseteq R \otimes_K L$. Thus, $R\otimes_K S$ must also be a domain.
\end{proof}

\begin{lemma}
	Let $(R,\m,K)$ be a graded domain. Then $\widehat{R_\m}$ is also a domain.
\end{lemma}
\begin{proof}
	Since $\{[R]_{\geq t}\}$ and $\{\m^t\}$ form cofinal sequences of ideals, we can consider $\widehat{R_\m}$ as the completion with respect to the former topology. Now, let $f=f_d+f'$ and $g=g_e+g'$ be elements of $\widehat{R_\m}$, where $f_d$ is the lowest degree term of $f$ and $g_e$ is the lowest degree term of $g$. Then $fg\equiv f_d g_e$ modulo $[R]_{> d+e}\widehat{R_\m}$. Since $f_d g_e$ is nonzero in $R$, hence in $R/[R]_{> d+e}$, we see that $fg$ must be nonzero as well.
\end{proof}

\begin{theorem}[Fulton-Hansen connectedness theorem]\index{Fulton-Hansen connectedness theorem}
	Let $K$ be an algebraically closed field, and $X,Y\subseteq \PP^n$ be irreducible subvarieties. If $\dim(X) + \dim(Y) > n$, then $X\cap Y$ is connected.
	\end{theorem}
\begin{proof}
	Let $\p,\q \subset K[x_0,\dots,x_n]$ be the defining homogeneous primes of $X$ and $Y$. We then have ${\mathrm{Proj}(K[x_0,\dots,x_n]/(\p+\q))=X\cap Y}$. We can write
	\[ R\cong \frac{K[x_0,\dots,x_n]}{\p+\q} \cong \frac{K[x_0,\dots,x_n,y_0,\dots,y_n]}{\p+\q' + \Delta},  \]
	 where $\q'$ is the copy of $\q$ with the $x$-variables replaced with $y$-variables, and $\Delta={(x_0-y_0,\dots,x_n-y_n)}$. 
	
	By the last two lemmas, $S=\displaystyle \frac{K\llbracket x_0,\dots,x_n,y_0,\dots,y_n \rrbracket}{\p+\q'}$ is a domain. Since $\dim(R)=\dim(X)+1+\dim(Y)+1 \geq n+3$, and $\ara(\Delta)\leq n+1$ the punctured spectrum of $S/\Delta$ is connected by Faltings' connectedness theorem.
	
	Now, if $X\cap Y$ is disconnected, there are homogeneous ideals $\aa,\bb\subseteq K[x_0,\dots,x_n,y_0,\dots,y_n]$ such that $\sqrt{\aa+\bb}=\m$, $\sqrt{\aa+\bb}=\p+\q'+\Delta$, and neither $\aa$ nor $\bb$ are $\m$-primary. But then the expansions of these ideals to $K\llbracket x_0,\dots,x_n,y_0,\dots,y_n \rrbracket$ satisfy the same conditions, contradicting the connectedness of the punctured spectrum of $S/\Delta$.
\end{proof}



\chapter{Local cohomology in positive characteristic}

\section{Kunz' theorem and the Peskine-Szpiro functors}

Let $R$ be a ring of positive prime characteristic $p$. The \emph{Frobenius endomorphism}\index{Frobenius} is the map $F:R\to R$\index{$F$} given by $F(r)=r^p$. This is a ring endomorphism of $R$: it clearly respects multiplication, and if $r,s\in R$, 
\[ F(r+s)=(r+s)^p = \sum_{i=0}^p \binom{p}{i} r^i s^{p-i} = r^p + s^p = F(r)+F(s),\]
since $p \,  | \, \binom{p}{i}$ for $0<i<p$. We write $F^e$\index{$F^e$} for the e-th iterate of Frobenius, and call it the $e$th Frobenius map for short.

It is easy to see that
\begin{itemize}
	\item $F$ is injective if and only if $F^e$ is injective for all $e$ if and only if $R$ is reduced.
	\item The Frobenius endomorphism extends to the Frobenius map on any localization $R_\p$ for $\p\in \Spec(R)$.
	\item If $R$ is noetherian, and $F$ is surjective, then $R$ is a field.
	\item The image of an ideal $I$ under $F^e$ is an ideal $I^{[p^e]}$, and if $I=(a_1,\dots,a_t)$, then $I^{[p^e]}=(a_1^{p^e},\dots,a_t^{p^e})$.
\end{itemize}

If $R$ is a domain, and $K$ its fraction field, fix an algebraic closure $\overline{K}$. Every element $r\in R$ has a unique $p$th root in $\overline{K}$, since if $x^p=y^p=r$ in $\overline{K}$, then $0=x^p-y^p=(x-y)^p$, so $x-y=0$. It is easy to see that 
\[ R^{1/p} := \{ r^{1/p}\in \overline{K} \ | \ r\in R\}\] \index{$R^{1/p}$} 
is a subring of $\overline{K}$. Furthermore, the Frobenius map on $R^{1/p}$ is injective with image $R$, so $R\cong R^{1/p}$, via the map sending $r\mapsto r^{1/p}$. We define $R^{1/p^e}$ in the same way.

If $R$ is reduced, then by working with the total ring of fractions of $R$, which is a product of fields, we can construct $R^{1/p^e}$ in the same way. These rings give as another useful perspective on the Frobenius map: The following diagram commutes:

\[ \xymatrix{ R \ar[r]^-{\subseteq} \ar[d]_{1}^{\cong} & R^{1/p^e}  \ar[d]_{F^e}^{\cong} \\ R \ar[r]^-{F^e}  & R .}\]
We can use this in many situations to identify the Frobenius map with the inclusion $R\subseteq R^{1/p^e}$.

Like any ring homomorphism, the Frobenius induces two functors on modules: restriction of scalars, and base change. Since the source and target of Frobenius are the same, these can get a bit disorienting. We will write $F:R_s \to R_t$ for the Frobenius, where $R_s$ denotes the source copy of $R$, and $R_t$ denotes the target copy of $R$ (which coincidentally are the same!).

\begin{definition}
	Let $M$ be an $R (=R_t)$-module. Then $M^{1/p^e}:= {}_{F^e} M$\index{$M^{1/p^e}$} is the $R (=R_s)$-module  obtained from $M$ by restriction of scalars along the $e$th Frobenius map.
\end{definition}

Let's unpackage this definition. If $M$ is an $R=R_t$-module, then ${}_{F^e} M$ agrees with $M$ as an abelian group. Thus, we can write 
${}_{F^e} M = \{ \widetilde{m} \ | \ m\in M\}$ with addition $\widetilde{m}+\widetilde{n}=\widetilde{m+n}$. The $R=R_s$-action is given by $r\cdot \widetilde{m} = \widetilde{F(r)m}=\widetilde{r^{p^e}m}$. If we replace the purely decorative $\widetilde{ }$ 's with purely decorative ${}^{1/p^e}$ 's, we get
\begin{itemize}
\item ${}_{F^e} M = M^{1/p^e} = \{ m^{1/p^e} \ | \ m\in M \}$,
\item $m^{1/p^e} + n^{1/p^e} = (m+n)^{1/p^e}$,
\item $r \, m^{1/p^e} = (r^{p^e} m)^{1/p^e}$.
\end{itemize}
We emphasize that the ${}^{1/p^e}$ 's are just formal, as opposed to the case of a ring where this took place inside a (product of) field(s). However, the two structures do agree in that case.

Some other notations for this construction are ${}^e M$ and $F^e_{*}(M)$.

\begin{example} Let $K$ be a perfect field, and $R=K[ x,y ]$. Let us compute the  $R$-modules $R^{1/p^e}$. We have $R^{1/p^e}=K[x^{1/p^e},y^{1/p^e}]$ as an overring of $R$. For any polynomial $f(x^{1/p^e},y^{1/p^e})\in R^{1/p^e}$, collect the monomials by the congruence classes of their exponents modulo 1, to write
	\[ f(x^{1/p^e},y^{1/p^e})= \sum_{i,j=0}^{p^e-1} x^{i/p^e} y^{j/p^e} f_{i,j}(x,y). \]
This expresses any $f$ uniquely as an $R$-linear combination of $\{ x^{i/p^e} y^{j/p^e} \ | \ 0\leq i,j \leq p^e-1 \}$, so $R^{1/p^e}$ is a free module on this basis. Consequently, $F^e$ is flat: the target $R$ is a free module over the source $R$.
	\end{example}

\begin{example}\label{freebasispolypowerseries}
	The previous example generalizes to $K[x_1,\dots,x_n]$ and $K\llbracket x_1,\dots,x_n\rrbracket$: for each ring $R$, the module $R^{1/p^e}$ is free, generated by the monomials with each exponent bounded by $\frac{p^e-1}{p^e}$.
\end{example}
	
\begin{example} Let $S=\FF_2[ x^2,xy,y^2 ]$. Let us compute the  $S$-module $S^{1/2}$. We have $S^{1/2}=\FF_2[x,\sqrt{xy},y]$ as an overring of $S$. We claim that 
	\[ S^{1/2} \cong S \oplus S\sqrt{xy} \oplus (Sx+ Sy) \oplus (Sx\sqrt{xy} + Sy\sqrt{xy})\]
	is a decomposition of $S^{1/2}$ into indecomposable $S$-modules. Indeed, we have that $S^{1/2}=\FF_2[x,y] \oplus \sqrt{xy} \,\FF_2[x,y]$ (monomials that are/aren't multiples of $\sqrt{xy}$), and $\FF_2[x,y] = S \oplus (Sx+Sy)$ (even and odd degree parts), so the direct sum decomposition above is valid. The modules $(Sx+ Sy)$ and $(Sx\sqrt{xy} + Sy\sqrt{xy})$ are indecomposable, since they are both isomorphic to the ideal $(x^2,xy)S$. In particular, $S^{1/2}$ is not free. Consequently, $F$ is flat: the target $S$ is not a flat module over the source $S$.
\end{example}

We note that the assignment $M\mapsto M^{1/p^e}$is functorial, and is an exact functor. However, it does not necessarily take free modules to free modules.

Along these lines, we obtain an Frobenius action on local cohomology. For any ring map $\varphi:R\to S$, we get an $R$-module map $\varphi:R\to {}_{\varphi}S$, and, for an ideal $I$ and integer $i$, an $R$-module map
\[ \H^i_I(R) \stackrel{\varphi}{\longrightarrow} \H^i_I({}_{\varphi}S)= \H^i_{\varphi(I)}(S). \]
In particular, for the Frobenius map $F^e:R_s\to R_t$, we get a map
\[ \H^i_I(R) = \H^i_I(R_s) \stackrel{F^e}{\longrightarrow} \H^i_{I^{[p^e]}}(R_t) = \H^i_{I^{[p^e]}}(R) = \H^i_{I}(R),\]
since $\sqrt{I^{[p^e]}}=\sqrt{I}$. To compute with \v Cech cohomology, we note that this is the map induced by applying the Frobenius map to the \v Cech complex on a generating set for $I$.
\begin{definition}
	The \emph{Frobenius action on local cohomology}\index{Frobenius action on local cohomology} is the map described above.
\end{definition}
\begin{example}
	Let $R=k[x,y]$. The Frobenius action $F^e$ on $\H^2_{\m}(R)=\check{H}^2(x,y;R)$ is given by $F^e\big([\frac{f}{x^n y^n}]\big)=\big[\frac{f^{p^e}}{x^{p^e n} y^{p^e n}}\big]$.
\end{example}

We note that if $R$ is graded, and $I$ homogeneous, so that $\H^i_I(R)$ is graded, the Frobenius action satisfies the rule $F^e\big( [\H^i_I(R)]_d \big) \subseteq [\H^i_I(R)]_{p^e d}$.

The other functor coming from Frobenius is the one corresponding to base change. We will stick with the notation $F:R_s \to R_t$ for the Frobenius, where $R_s$ denotes the source copy of $R$, and $R_t$ denotes the target copy of $R$ (which coincidentally are the same!).

\begin{definition}
	The \emph{Peskine-Szpiro functors}\index{Peskine-Szpiro functor}\index{$\cF^e(M)$} are the functors $\cF^e$ from $R(=R_s)$-modules to $R(=R_t)$ modules given by base change along the $e$th Frobenius map. That is, $\cF^e(M)=R_t \otimes_{R_s} M$, with the structure coming from $R_t$.
\end{definition}

To make sense of this definition, we observe the following.
\begin{itemize}
	\item $\cF^e(R)\cong R$: \quad $R_t \otimes_{R_s} {R_s}$ as an $R_t$-module is just $R_t=R$.
	\item $\cF^e$ takes the map $\cdot r : R \to R$ to $\cdot r^{p^e}: R \to R$: \quad $1\otimes 1\in R_t \otimes_{R_s} {R_s}$ maps to $1 \otimes r = r^{p^e} \otimes 1$.
	\item The functors $\cF^e$ are right exact.
	\item If $R^a \stackrel{A}{\longrightarrow} R^b \to M \to 0$ is a presentation of $M$, with $A=[a_{ij}]$, then $R^a \stackrel{A^{[p^e]}}{\longrightarrow} R^b \to \cF^e(M) \to 0$ is a presentation of $\cF^e(M)$, where $A^{[p^e]}=[a^{p^e}_{ij}]$.
	\item In particular, $\cF^e(R/I)=R/I^{[p^e]}$.
\end{itemize}

As we have seen in the examples, the Frobenius map is not always flat: $R^{1/p^e}$ is not always flat over $R$. The following theorem of Kunz characterizes when this happens.

\begin{theorem}[Kunz' theorem]\index{Kunz' theorem}
	Let $R$ be a noetherian ring of positive characteristic. Then $R$ is regular if and only if the $e$th Frobenius map on $R$ is flat for some (equivalently, all) $e$; i.e., $R^{1/p^e}$ is a flat $R$-module for  some (equivalently, all) $e$.
\end{theorem}

We will prove a more general version of the ``$\Rightarrow$'' direction below.

%\begin{proof}
%	We will only prove the implication ``$\Rightarrow$''; we will only use this in the sequel.
%	
%	Since regularity and flatness are local properties, and the Frobenius map localizes, we can assume that $R$ is a regular local ring. Then, we claim that the following diagram commutes:
%	\[ \xymatrix{ \widehat{R} \ar[r] &\widehat{R}^{1/p^e} \\  R \ar[u]\ar[r] & R^{1/p^e} \ar[u] }\]
%	where the vertical maps are the completion maps. Indeed, the systems of ideals $\{\m^t\}_t$ and $\{(\m^t)^{[p^e]}\}_t$ are cofinal in $R$. We obtain that 
%	\[ \widehat{R^{1/p^e}} \cong \varprojlim_t \frac{R^{1/p^e}}{\m^t R^{1/p^e}} \cong \varprojlim_t \frac{R^{1/p^e}}{ \big((\m^t)^{[p^e]}\big)^{1/p^e} R^{1/p^e}} \cong \bigg(\varprojlim_t \frac{R}{(\m^t)^{[p^e]}}\bigg)^{1/p^e} \cong \big(\varprojlim_t R/\m^t\big)^{1/p^e} \cong \widehat{R}^{1/p^e}. \]
%	
%	Since the completion maps are faithfully flat, to see that the bottom map is flat, it suffices to see that the top map is flat. We can use the Cohen structure theorem to write $\widehat{R}\cong k\llbracket x_1,\dots, x_d \rrbracket$. Then, we factor the top map as
%	
%	\[ k\llbracket x_1,\dots, x_d \rrbracket \subseteq k\big\llbracket x_1^{1/p^e},\dots, x_d^{1/p^e} \big\rrbracket \subseteq k^{1/p^e} \otimes_k k\big\llbracket x_1^{1/p^e},\dots, x_d^{1/p^e} \big\rrbracket \subseteq k^{1/p^e}\big\llbracket x_1^{1/p^e},\dots, x_d^{1/p^e} \big\rrbracket. \]
%	The first inclusion is free on the basis $\{ \underline{x}^{\alpha} \ | \ 0\leq \alpha_i\leq p^e-1\}$. The second is a flat base change. The third is the completion map with respect to the $\underline{x}$-adic topology. Thus, the composition is flat, as required.
%\end{proof}
%
%\begin{corollary}
%	If $R$ is a regular ring of positive characteristic, then the Peskine-Szpiro functors $\cF^e$ are exact.
%\end{corollary}
%\begin{proof}
%	Indeed, in this case, they are just extension of scalars along a flat map.
%\end{proof}



\section{Peskine-Szpiro vanishing}

The statement of Kunz' theorem describes when the Peskine-Szpiro functors are exact: indeed, since these are given by extension of scalars, this happens if and only if the map is flat, which happens if and only if $R$ is regular. It turns out that for all local rings of positive characteristic, the Peskine-Szpiro functors are exact on the category of modules of finite projective dimension (we will give a precise statement soon). We prepare for this with a lemma.

\begin{lemma}[Acyclicity lemma]\index{Acyclicity lemma}
	Let $R$ be a local ring, and $0\to M_n \to \cdots \to M_0 \to 0$ be a complex of $R$-modules with nonzero homology. Let $s=\max\{ i \  | \ H_i(M_\bullet)\neq 0\}$.
	
	If $\depth(M_i)\geq i$ for all $i\geq 1$, then either $s=0$ or $\depth(H_s(M_\bullet))\geq 1$.
\end{lemma}
\begin{proof}
	Suppose $s\geq 1$ and $\depth H_s(M_\bullet)=0$. Let $Z_i=\ker(M_i\to M_{i-1})$ and $B_i=\im (M_{i+1}\to M_i)$. There are short exact sequences 
	\[ 0 \to B_s \to Z_s \to H_s(M_\bullet)\to 0 \quad \text{and} \quad 0 \to B_{i+1} \to M_{i+1} \to B_i\to 0 \ \text{for $s\leq i \leq n-1$}.\]
	Since $Z_s\subseteq M_s$ and $\depth M_s \geq s\geq 1$, there is a nonzerodivisor on $M_s$, hence on $Z_s$, so we must also have $\depth Z_s \geq 1$. By the first sequence, we find that $\depth B_s =1$. Applying the Depth Lemma to the latter short exact sequences inductively gives $\depth B_i = i - s + 1$ for $s\leq i\leq n-1$. Since $B_{n-1}=M_n$, $\depth M_n = n-s \leq n-1$, which is a contradiction.
\end{proof}

\begin{theorem}
	Let $R$ be a local ring of positive characteristic, and $M$ be a finitely generated module of finite projective dimension. If $P_\bullet \to M$ is a minimal free resolution of $M$, then $\cF^e(P_\bullet)\to \cF^e(M)$ is a minimal free resolution of $\cF^e(M)$.
\end{theorem}
\begin{proof} The homology of $\cF^e(P_\bullet)$ is $\Tor^R_i(R^{1/p^e},M)=0$, with the structure given by identifying the left argument with $R$.
	It suffices to show that $\Tor^R_i(R^{1/p^e},M)=0$ for $i>0$. Let $s$ be the highest nonvanishing such $i$. Let $\p\in \Ass(\Tor^R_s(R^{1/p^e},M))$. Take $F_\bullet\to M_\p$ a minimal free resolution over $R_\p$, and $C_\bullet=\cF^e(F_\bullet)$. By choice of $\p$, $\depth_{R_\p} H_s(C_\bullet) =0$, and $H_i(C_\bullet)=0$ for $i>s$. By Auslander-Buchsbaum, $F_i=0$ for $i>\depth(R_\p)$. Now, by the Acyclicity Lemma, $s=0$.
\end{proof}

\begin{corollary}
	Let $R$ be a local ring of positive characteristic. If
	\[ 0 \to A \to B \to C \to 0 \]
	is a short exact sequence of modules of finite projective dimension, then
	\[ 0 \to \cF^e(A)\to \cF^e(B) \to \cF^e(C) \to 0\]
	is exact as well.
\end{corollary}
\begin{proof}
	If $F'_\bullet\to A$, $F_\bullet\to B$, and $F''_\bullet \to C$ are the minimal free resolutions, there is a short exact sequence of complexes 
	\[0\to F'_\bullet \to F_\bullet \to F''_\bullet \to 0,\] and another 
	\[0\to \cF^e(F'_\bullet) \to \cF^e(F_\bullet) \to \cF^e(F''_\bullet) \to 0.\]
	By the previous theorem, the LES of homology of the latter is just
	\[ 0 \to \cF^e(A)\to \cF^e(B) \to \cF^e(C) \to 0.\]\qedhere
\end{proof}

\begin{corollary}\index{One Direction}
	If $R$ is a regular ring of positive characteristic, then $F^e$ is flat for all $e$.
\end{corollary}
\begin{proof}
We can test flatness on the inclusions of ideals into the ring. But, by Auslander-Buchsbaum-Serre and the previous theorem, we have that \[ 0 \to \cF^e(I) \to \cF^e(R) \to \cF^e(R/I) \to 0\]
is exact.
\end{proof}

We can apply this theorem to give a vanishing theorem on local cohomology.

\begin{theorem}
	Let $R$ be a local ring of positive characteristic, and $I$ be an ideal of $R$. Then $\cd(I,R)\leq \pd_R (R/I)$.
\end{theorem}
\begin{proof}
	The statement is vacuous unless $I$ has finite projective dimension, so we assume that. We note that the sequence of ideals $I^{[p^e]}$ is cofinal with the sequence of powers of $I$. Thus, we can compute $\H^i_I(R)=\varinjlim \Ext^i_R(R/I^{[p^e]},R)$. Since $\pd_R(R/I^{[p^e]})=\pd_R(\cF^e(R/I))\leq\pd_R(R/I)$ for all~$e$, we must have that $\Ext^i_R(R/I^{[p^e]},R)=0$ for all $e$ and all $i>\pd_R(R/I)$. Thus, $\H^i_I(R)=0$ for all $i>\pd_R(R/I)$.
\end{proof}

We single out one notable case as a corollary.

\begin{corollary}
	Let $R$ be a regular local ring of positive characteristic, and $I$ be an ideal of $R$ such that $R/I$ is Cohen-Macaulay. Then $\H^i_I(R)=0$ for all $i\neq \mathrm{height}(I)$.
\end{corollary}
\begin{proof}
	By Auslander-Buchsbaum and the CM assumption, $\pd_R(R/I)=\dim(R)-\dim(R/I)=\mathrm{height}(I)$, so local cohomology vanishes beyond this index. Again since $R$ is CM, $\mathrm{height}(I)=\depth_I(R)$, and local cohomology vanishes below this index.
\end{proof}

\begin{example}
	Let $K$ be a field of characteristic $p>0$. Consider the ideal $I=I_2(X_{2\times 3})\subseteq R=K[X_{2\times 3}]$ of $2\times 2$ minors of a generic $2\times 3$ matrix. Since $R/I$ is Cohen-Macaulay, and $I$ has height 2, $\H^3_I(R)=0$.
	
	As a consequence of this vanishing, we see that $K[\Delta_1,\Delta_2,\Delta_3] \subseteq  R$ is \emph{not} a direct summand. Indeed, $\H^3_{(\underline{\Delta})}(K[\Delta_1,\Delta_2,\Delta_3])\neq 0$ so it cannot be a direct summand of $\H^3_{(\underline{\Delta})}(R)=0$. 
	
	We contrast this with the situation in characteristic zero (which we discussed earlier), where $\H^3_I(R)\neq 0$ and the subring above \emph{is} a direct summand.
\end{example}


\section{Finiteness results}

We recall that we have seen a local cohomology module $\H^2_{(x,y)}(\frac{K[x,y,u,v]}{(xu-yv)})$ that had $\m$ as its only associated prime, but had an infinite $K$-dimensional socle. We can think of this local cohomology module as quantitatively big. We will also see in the homework a local cohomology module that has infinitely many associated primes. We can think of that local cohomology module as qualitatively big.

We showed that if $\m$ is a maximal ideal, neither of these bignesses can occur: the local cohomology modules with support in $\m$ are artinian, hence they have only one associated prime, and the socle is finite dimensional. Both of these facts can be expressed in terms of Bass numbers: to say there are finitely many associated primes means that $\mu^0_\p(\H^i_I(R))\neq 0$ for only finitely many $\p$, and, if $\H^i_I(R)$ is $\m$-torsion, to say that it is artinian means that $\mu^0_\p(\H^i_I(R))$ is finite.

We will now work towards a statement that says that if $R$ is a regular ring of positive characteristic, and $I$ is an arbitrary ideal, then $\H^i_I(R)$ is qualitatively and quantitatively small.

%Huneke-Sharp goes here

\begin{lemma}
	Let $(R,\m,k)$ be a regular local ring, and $M$, $N$ be $R$-modules, with $M$ finitely generated. Then $\cF^e\big(\Ext_R^i(M,N)\big)\cong \Ext_R^i\big(\cF^e(M),\cF^e(N)\big)$ for all $i$.
\end{lemma}
\begin{proof}
	This is just a disorienting version of flat base change. We have that
$\cF^e\big(\Ext_R^i(M,N)\big) = R_t \otimes_{R_s} \Ext_{R_s}^i(M,N)$ via its $R_t$-structure. By flat base change, this is the same as $\Ext_{R_t}^i(R_t \otimes_{R_s} M,R_t \otimes_{R_s} N)\cong \Ext_R^i\big(\cF^e(M),\cF^e(N)\big)$.
\end{proof}

We also need a statement that shows that certain modules are fixed by $\cF^e$.

\begin{lemma}
	Let $(R,\m,k)$ be a regular local ring.
	\begin{enumerate}
		\item For any multiplicative system, $\cF^e(W^{-1}R)\cong W^{-1}R$.
		\item For any ideal $I$, $\cF^e(\H^i_I(R))\cong \H^i_I(R)$.
		\item For any injective module, $\cF^e(E)\cong E$.
	\end{enumerate}
\end{lemma}
\begin{proof} 
	\begin{enumerate}
		\item It is equivalent to show that $R^{1/p^e}\otimes_R W^{-1}R \cong (W^{-1}R)^{1/p^e}$. To that end, note that $R^{1/p^e} \otimes_R W^{-1}R \cong W^{-1} R^{1/p^e}$. If $w\in W$, then $1/w^{1/p^e}=w^{(p^e-1)/p^e}/w\in W^{-1} R^{1/p^e}$, so $(W^{-1} R)^{1/p^e}\subseteq W^{-1} R^{1/p^e}$. The other containment is clear.
		\item We can compute $\H^i_I(R)$ from a \v Cech complex. The terms in this complex are all sums of localizations of $R$. The isomorphisms in part 1 commute with the localization maps (check if this isn't clear to you!) and the statement follows.
		\item The Peskine-Szpiro functors commute with direct sums (like all base change functors do), so this reduces to checking for an indecomposable injective $E_R(R/\p)$. We know that $E_{R}(R/\p)\cong E_{R_\p}(R_\p / \p R_\p)$, and that $R_\p$ is Gorenstein, so $E_{R_\p}(R_\p / \p R_\p)\cong \H^{\mathrm{height}(\p )}_{\p R_\p}(R_\p)$. Thus, we have $E_R(R/\p)\cong \check{H}^h(f_1,\dots,f_h; R_{\p})$ for some elements of $R$ whose images form a regular SOP for $R_\p$. In particular, $E_R(R/\p)$ is resolved by localizations of $R$, so the statement again follows from part 1.\qedhere
	\end{enumerate}
\end{proof}

Now we state and prove the finiteness theorem.

\begin{theorem}[Huneke-Sharp]
	Let $(R,\m,k)$ be a regular local ring of positive characteristic, and $I$ an ideal. Then
	\[ \mu^j(\p,\H^i_I(R)) \leq \mu^j(\p, \Ext^i_R(R/I,R))<\infty \]
	for all $\p\in\Spec(R)$, and all $i,j$. 
	\end{theorem}
\begin{proof}
	The last inequality follows from the fact that $\Ext^i_R(R/I,R)$ is a finitely generated $R$-module, so we turn to the first inequality. By localization, we can assume that $\p=\m$.
	
	Let \[0 \,(\,\to \Ext^i_R(R/I,R)\,) \to E^0 \to \cdots \to E^n \to 0\] be the minimal injective resolution. Applying $\cF^e$, we find that
	\[ 0 \,(\,\to \cF^e(\Ext^i_R(R/I,R))\,) \to \cF^e(E^0) \to \cdots \to \cF^e(E^n) \to 0\] is exact, and applying the lemmas above, we get injective resolutions
		\[ 0 \,(\, \to \Ext^i_R(R/I^{[p^e]},R)\,) \to E^0 \to \cdots \to E^n \to 0.\]
		Since maps on modules induce maps on injective resolutions, we get a commutative diagram
		
		\[ \xymatrix{ 0 \ar[r] &  \Ext^i_R(R/I,R) \ar[r]\ar[d] & E^0 \ar[r]\ar[d] & \cdots\ar[r] & E^n \ar[r]\ar[d] & 0 \\
		0 \ar[r] &  \Ext^i_R(R/I^{[p]},R) \ar[r]\ar[d] & E^0 \ar[r]\ar[d] & \cdots\ar[r] & E^n \ar[r]\ar[d] & 0 \\ 
	0 \ar[r] &  \Ext^i_R(R/I^{[p^2]},R) \ar[r]\ar[d] & E^0 \ar[r]\ar[d] & \cdots\ar[r] & E^n \ar[r]\ar[d] & 0 \\
& \vdots & \vdots & & \vdots & }\]
Note that the vertical maps are not necessarily isomorphisms and that the horizontal maps may be different on each row. Passing to direct limits, we obtain
\[ 0 \,(\, \to \H^i_I(R) \,) \to \varinjlim E^0 \to \cdots \to \varinjlim E^n \to 0.\]
A direct limit of injective modules is injective, so this is an injective resolution. Now we compute the Bass numbers with respect to $\m$:
\begin{align*} \mu^j(\m,\H^i_I(R)) &= \dim_k \, \Ext^i_R(k,\H^i_I(R)) = \dim_k \, H^i(\Hom_R(k,\varinjlim E^{\bullet})) = \dim_k \, H^i(\varinjlim \Hom_R(k, E^{\bullet})) \\ &= \dim_k \, \varinjlim H^i(\Hom_R(k, E^{\bullet})) ) = \dim_k \, \varinjlim k^{\mu}, \end{align*}
where $\mu=\mu^j(\m,\Ext^i_R(R/I,R))$. To compute the direct limit of vector spaces of dimension at most $\mu$, we can quotient out each space by the set of elements that map to zero in the direct limit, to obtain an directed system with the same limit in which all maps are injective. Since the dimensions are bounded, the maps must all be isomorphisms past some point, hence isomorphic to the limit. We conclude that 
\[ \mu^j(\m,\H^i_I(R)) = \dim_k \, \varinjlim k^{\mu} \leq \mu, \]
as required.
\end{proof}

\begin{corollary}
	Let $(R,\m,k)$ be a regular local ring of positive characteristic, and $I$ an ideal. Then $\Ass(\H^i_I(R))$ is finite for all $i$.
\end{corollary}
\begin{proof}
	We know that for any module $M$, $\Ass(M)=\Ass(E_R(M))=\{ \p\in\Spec(R) \ | \ \mu^0(\p,M)\neq 0\}$. Since $\Ext^i_R(R/I,R)$ is finitely generated, it has finitely many associated primes, hence finitely many $\p$ for which $\mu^0(\p, \Ext^i_R(R/I,R))\neq 0$. The same then holds for $\H^i_I(R)$ by the previous theorem.
\end{proof}

\begin{remark} A module that satisfies the crucial property $\cF(M)\cong M$ used above is called an \emph{$F$-module}\index{$F$-module}; rather, the data of a pair $(M,\theta)$ of a module and an isomorphism $\theta:M\to \cF(M)$ is an $F$-module. These were introduced by Lyubeznik. The study of this structure is very fruitful in applications to local cohomology. Those who liked the previous theorem are encouraged to read Lyubenznik's original paper on $F$-modules.
	\end{remark}

\section{Strong $F$-regularity}

We will discuss some properties qualifying singularities in positive characteristic, and relate them to other interesting meaningful properties that we have encountered. While most of the notions we encounter are closely related to the tight closure theory of Hochster and Huneke, to various extents they go back in spirit to the work of Hochster and Roberts. First, we state a technical hypothesis that will simplify things.

\begin{definition}
	A ring of positive characteristic $p$ is \emph{$F$-finite}\index{$F$-finite} if $F$ is module-finite; equivalently, $F^e$ is module-finite for all $e$.
\end{definition}

\begin{remark} If $R$ is a polynomial ring or power series ring over a perfect field, then $R$ is $F$-finite, by Example~\ref{freebasispolypowerseries}. If $S\twoheadrightarrow R$ is a surjection, then there is a surjection $S^{1/p^e} \otimes_S R \twoheadrightarrow R^{1/p^e}$, so quotients of $F$-finite rings are $F$-finite. Additionally, a generating set for $R^{1/p^e}$ over $R$ localizes to a generating set for $R_\p^{1/p^e}$ over $R_\p$, so localizations of $F$-finite rings are $F$-finite.
	
	In short, rings essentially of finite type over perfect fields, and complete local rings with perfect residue fields are $F$-finite.
\end{remark}

\begin{definition}
	\
	\begin{itemize}
		\item Let $(R,\m,k)$ be a local $F$-finite ring of positive characteristic $p$. We say that $R$ is \emph{strongly $F$-regular}\index{strongly $F$-regular} if, for any $c\in R\setminus \cup \Min(R)$, there is some $e$ such that the map $c F^e:R\to R$ splits (as a map of modules over the source); i.e., $c^{1/p^e} R \subseteq R^{1/p^e}$ is a free $R$-module summand.
		\item Let $(R,\m,K)$ be a graded $F$-finite ring of positive characteristic $p$. We say that $R$ is \emph{strongly $F$-regular}\index{strongly $F$-regular} if, for any homogeneous $c\in R\setminus \cup \Min(R)$, there is some $e$ such that the map $c F^e:R\to R$ splits (as a map of graded modules over the source); i.e., $c^{1/p^e} R \subseteq R^{1/p^e}$ is a graded free $R$-module summand. We realize $cF^e$ as a graded homomorphism by rescaling the grading of the target copy of $R$ by dividing degrees by $p^e$ (i.e., considering the grading as in $R^{1/p^e}$).
	\end{itemize}
\end{definition}


\begin{proposition} 
	\
	\begin{itemize}
		\item Let $(R,\m,k)$ be an $F$-finite regular local ring. Then $R$ is strongly $F$-regular.
		\item Let $(R,\m,K)$ be a graded polynomial ring, with $K$ perfect. Then $R$ is strongly $F$-regular.
	\end{itemize}
	\end{proposition}
\begin{proof} Recall that $R$ is a domain here, so $\cup \Min(R)=0$.
	In this case, $R^{1/p^e}$ is a free $R$-module. Given $c\in R$, pick $e$ such that $r\notin \m^{[p^e]}$; we can do this by Krull intersection. Note that $R^{1/p^e} \otimes_R R/\m \cong (R/\m^{[p^e]})^{1/p^e}$. Since $c^{1/p^e}$ is nonzero in this module, it is part of a free basis for $R^{1/p^e}$.
	
	The proof in the polynomial ring case is similar (but simpler!).
\end{proof}

\begin{exercise}
	If $R$ is a strongly $F$-regular local or graded ring, then $R$ is normal. In particular, $R$ is a domain.
\end{exercise}

A hint: show that if $\phi:R^{1/p^e}\to R$ is $R$-linear, and $c$ is in the conductor of $R$, then $\phi(c^{1/p^e})$ is also in the conductor. 


\begin{proposition} Let $R$ be a direct summand of a strongly $F$-regular local or graded ring $S$; in the graded case, we assume the splitting is given by a degree-preserving map. Then $R$ is strongly $F$-regular as well.
\end{proposition}
\begin{proof}
	Fix $c\in R\smallsetminus 0$. Then, viewing $c$ as an element of $S$, there is some $e$ and some $\phi:S^{1/p^e}\to S$ such that $\phi(c^{1/p^e})=1$, since $S$ is strongly $F$-regular. Let $\beta:S\to R$ be an $R$-linear splitting of the inclusion. Then, the map $\beta \circ \phi |_{R^{1/p^e}}: R^{1/p^e} \to R$ is $R$-linear, and sends $c^{1/p^e}$~to~1.
\end{proof}

The property of strong $F$-regularity is preserved under localization.

\begin{lemma}
	\begin{enumerate}
		\item Let $(R,\m,K)$ be a strongly $F$-regular graded ring. Then $(R_\m,\m,K)$ is a strongly $F$-regular local ring.
		\item Let $(R,\m,k)$ be a  strongly $F$-regular local ring. Then for any $\p\in \Spec(R)$, $R_\p$ is strongly $F$-regular as well.
	\end{enumerate}
\end{lemma}
\begin{proof}
	\begin{enumerate}
		\item 
	Take $c\in R_\m \smallsetminus 0$. We can write $c=\frac{c_n + \dots + c_m}{d}$ with $c_i$ homogeneous, $m>0$, and $d\notin \m$. There is, for some $e$, a homogeneous $R$-linear map $\phi:R^{1/p^e}\to R$ such that $\phi((c_m)^{1/p^e})=1$. Since $\phi$ is homogeneous, $\phi((c_n + \dots + c_{m+1})^{1/p^e})\in \m$; in particular, $\phi((c_n + \dots + c_m)^{1/p^e})\notin \m$. We can extend $\phi$ to a map $\widetilde{\phi}:R_{\m}^{1/p^e}=R^{1/p^e}_{\m}\to R_{\m}$. Then, the map $\beta=\widetilde{\phi}\circ \cdot d^{1/p^e}$ satisfies \[\beta(c^{1/p^e})=\widetilde{\phi}(c^{1/p^e}d^{1/p^e})=\widetilde{\phi}((c_n + \dots + c_m)^{1/p^e})=\phi((c_n + \dots + c_m)^{1/p^e})\notin \m,\]
	so $c^{1/p^e}$ generates a free summand.
	\item Given $\frac{r}{s}\in R_\p$, there is an $e$ and an $R$-linear map $\phi:R^{1/p^e}\to R$ such that $\phi(r^{1/p^e})=1$. We can extend $\phi$ to an $R_\p$-linear map from $R_\p^{1/p^e}\to R_\p$ that sends $\frac{r^{1/p^e}}{1}$ to 1. As above, we can premultiply by $s^{1/p^e}$ to get the desired map.\qedhere
		\end{enumerate}
\end{proof}


\begin{lemma}
	Let $R$ be a strongly $F$-regular  local or graded ring. Then,
	\begin{enumerate}
		\item for all $e$ and all $i$, the map $F^e:\H^i_\m(R)\to \H^i_\m(R)$ is injective, and
		\item for all $c\in R\smallsetminus 0$ (homogeneous, in the graded case) and all $i$, there is some $e$ such that $cF^e: \H^i_\m(R) \to \H^i_\m(R)$ is injective.
	\end{enumerate}
\end{lemma}
\begin{proof}
	By definition, there is some $f$ such that $F^f$ splits: i.e., there is an $R$-linear map $\beta:R^{1/p^f}\to R$ such that the composition $R \subseteq R^{1/p^f} \stackrel{\beta}{\longrightarrow} R$ is the identity map. We can factor the first inclusion to get $R \subseteq R^{1/p} \subseteq R^{1/p^f} \stackrel{\beta}{\longrightarrow} R$ is the identity, so $R$ is a direct summand of $R^{1/p}$. Now, $R^{1/p^e}$ is an $R^{1/p^e}$-linear direct summand of $R^{1/p^{e+1}}$ for each $e$, hence an $R$-linear summand. Composing, we obtain that $R$ is an $R$-linear summand of each $R^{1/p^e}$.
	
	Then, since the identity factors through $F^e$ for all $e$, by functoriality, the identity on $\H^i_\m(R)$ factors through $F^e:\H^i_\m(R)\to \H^i_\m(R)$ for all $e$, so this map is injective.
	Similarly, for each $c\in R\smallsetminus 0$, there is an $e$ such that the identity on $R$ factors through $cF^e$, so the identity on $\H^i_\m(R)$ factors through $cF^e: \H^i_\m(R) \to \H^i_\m(R)$, which then must be injective.
\end{proof}

\begin{proposition}
	Let $R$ be a strongly $F$-regular graded or local ring. Then $R$ is Cohen-Macaulay.
\end{proposition}
\begin{proof}
	If we have a graded counterexample, then the localization at the homogeneous maximal ideal is also a counterexample, so we can assume that $R$ is local.
	
	If we have a local ring $R$ that is a counterexample, choose a prime $\p\in \Spec(R)$ such that $R_{\q}$ is Cohen-Macaulay for all $\q \subsetneq \p$. We then obtain a local counterexample $(R,\m,k)$ where $R$ is Cohen-Macaulay on the punctured spectrum.
	
	From a problem on the homework\footnote{We proved this in the case that $R$ is a quotient of a regular ring, but it holds for all $F$-finite rings. A nontrivial way to see this is as follows: $F$-finite rings have dualizing complexes (Gabber) and rings with dualizing complexes are quotients of Gorenstein rings (Kawasaki). The proof in the HW works for quotients of Gorenstein rings in exactly the same way.}, we know that $\H^i_{\m}(R)$ has finite length for all $i<\dim(R)$. Pick  $c\in \m\smallsetminus 0$, and $e$ such that $F^e$ and $cF^e: \H^i_\m(R) \to \H^i_\m(R)$ are injective. Since $\H^i_\m(R)$ has finite length, both maps are isomorphisms. If $\H^i_\m(R)\neq 0$, it has a nonzero socle; let $\eta$ be a socle element. Then there is an element $\xi\in\H^i_\m(R)$ such that $F^e(\xi)=\eta$, so $c F^e(\xi) = c \eta = 0$, which is a contradiction.
\end{proof}

We encapsulate the last two properties with a definition.

\begin{definition}
	\
	\begin{itemize}
		\item Let $(R,\m,k)$ be a local $F$-finite ring. We say that $R$ is \emph{$F$-rational}\index{$F$-rational} if $R$ is Cohen-Macaulay and for each $c\in R\setminus \cup \Min(R)$, there is an $e$ such that $cF^e:\H^d_\m(R) \to \H^d_\m(R)$ is injective.
		\item Let $(R,\m,K)$ be a  graded $F$-finite ring. We say that $R$ is \emph{$F$-rational}\index{$F$-rational} if $R$ is Cohen-Macaulay and for each homogeneous $c\in R\setminus \cup \Min(R)$, there is an $e$ such that $cF^e:\H^d_\m(R) \to \H^d_\m(R)$ is injective.
	\end{itemize}
\end{definition}

It is evident from the preceding results that strongly $F$-regular rings are $F$-rational.

\begin{proposition}
	Let $R$ be $F$-rational and graded. Then $\ai(R)<0$.
\end{proposition}
\begin{proof}
	Let $d=\dim(R)$. If $\ai(R)=a>0$, a nonzero element of $[\H^d_\m(R)]_a$ maps to a nonzero element of $[\H^d_\m(R)]_{pa}$ under $F$, which contradicts the definition of $\ai(R)$.
	
	If $\ai(R)=0$, then any element of $[\H^d_\m(R)]_0$ is in the socle of $\H^d_\m(R)$. Let $c$ have positive degree, and pick $e$ such that $c F^e:\H^d_\m(R) \to \H^d_\m(R)$ is injective. Then, the image of $c F^e$ contains nonzero elements of degree equal to that of $c$, which contradicts that the $a$-invariant is zero.
\end{proof}

\begin{theorem}
	Let $S$ be a regular $F$-finite local or graded ring of positive characteristic. Let $R$ be a direct summand of $S$. Then $R$ is Cohen-Macaulay. If $R$ is graded, then $\ai(R)<0$.
\end{theorem}


Although we won't use them in this class, it is worth defining two more other famous classes of $F$-singularities.

\begin{definition}
	Let $(R,\m,k)$ be an $F$-finite local ring.\begin{itemize}
		\item $R$ is \emph{$F$-pure}\index{$F$-pure} if $F:R\to R$ splits.
		\item $R$ is \emph{$F$-injective}\index{$F$-injective} if $F:\H^i_\m(R)\to \H^i_\m(R)$ is injective for all $i$.
	\end{itemize}
\end{definition}

The connection between these notions is given by the diagram below. We leave it as an (easy) exercise to verify the implication not stated above.

\[ \xymatrix{ \text{regular} \ar@{=>}[r] & \text{strongly $F$-regular} \ar@{=>}[r] \ar@{=>}[d] & \text{$F$-rational} \ar@{=>}[r] \ar@{=>}[d] & \text{Cohen-Macaulay} \\
	& \text{$F$-pure} \ar@{=>}[r] & \text{$F$-injective} & }\]

These properties are somewhat independent of the properties we encountered in the section on local duality.

\begin{example}
	If $K$ is a field of positive characteristic, $R=K\llbracket x,y,z \rrbracket/(x^4+y^4+z^4)$ is a complete intersection, but is not $F$-injective. To see this, we note that the local cohomology of $R$ with support in $\m$ agrees with that of its uncompleted graded counterpart, and Frobenius does not act injectively on the local cohomology there, since the $a$-invariant is positive.
\end{example}

\begin{example}
	If $K$ is a field of positive characteristic, $S=K\llbracket x^3, x^2 y, x y^2, y^3 \rrbracket$ is strongly $F$-regular, but not Gorenstein. We have seen already that it is not Gorenstein, and we note that it is a direct summand of $K\llbracket x,y \rrbracket$ so see that it is strongly $F$-regular.
\end{example}


We end our discussion of strong $F$-regularity with an application to local cohomology.

\begin{proposition}
	Let $R$ be a strongly $F$-regular local domain, and $I\subseteq R$. Then, the local cohomology modules $\H^i_I(R)$ are faithful, i.e., are not annihilated by any nonzero element.
\end{proposition}
\begin{proof}
Let $c\in R\smallsetminus 0$. Pick an $e$ such that $cF^e$ splits. By the argument above, we have that $cF^e: \H^i_I(R) \to \H^i_I(R)$ is injective. This factors through $\cdot c:\H^i_I(R) \to \H^i_I(R)$, which must not be the zero map, so $c$ does not annihilate $\H^i_I(R)$.
\end{proof}

\section{Magic squares}

\begin{definition}
	A \emph{magic square}\index{magic square} of size $t$ and sum $n$ is a $t\times t$ array of nonnegative integers such that each row sums to $n$ and each column sums to $n$.
	\end{definition}
For example,
\begin{center}
	\begin{tabular}{ | c | c | c |}
		\hline
		4 & 9 & 2 \\ \hline
		3 & 5 & 7 \\ \hline
		8 & 1 & 6 \\
		\hline
	\end{tabular} \qquad \qquad
\begin{tabular}{ |c |c| c| c|}
	\hline
1&	14&	14&	4\\ \hline
11&	7&	6&	9\\ \hline
8&	10&	10&	5\\ \hline
13&	2&	3&	15\\ \hline
\end{tabular}
\end{center}
are magic squares of size $3$ and sum $15$, and of size $4$ and sum $33$, respectively\footnote{The first is the Lo Shu square from $\sim 600$ BCE, and the second is engraved on the Sagrada Fam\'ilia}. These have appeared in China, India, Persia, Arabia, etc.~independently millenia ago. According to Narayana, a 14th century Indian mathematician, the purpose of studying magic squares is to destroy the ego of bad mathematicians\index{bad mathematicians}, and for the pleasure of good mathematicians\index{good mathematicians}.

 Given a fixed size, how does the number of magic squares of row sum $n$ vary as a function of $n$? When the size $r=1$, this is just the constant function 1. When $r=2$, everything is determined by the first row, so there are $n+1$. We will show that for each $r$, the number of magic squares of size $n$ is a polynomial in $n$.
 
 Fix $r$, and let $S=K[X_{r\times r}]$ be a polynomial ring over a field $K$. Give $S$ a grading with values in \[\ZZ^{2r}=\ZZ\langle e_1,\dots,e_{r},e'_1,\dots,e'_{r}\rangle\] by $\deg(x_{i,j})=e_i + e'_j$. Given a monomial $M=\prod_{i,j} x_{i,j}^{a_{i,j}}$, the array $A=[a_{i,j}]$ has $i$-th row sum given by the $e_i$ component of $\deg(M)$, and $j$-th column sum given by the $e'_j$ component of $\deg(M)$.


Map $\ZZ^{2r}\to \ZZ^{2r-1}=\ZZ\langle f_1,\dots,f_{r-1},f'_1,\dots,f'_{r-1},f''\rangle$ by the rules
\begin{align*}
&e_1 \mapsto -f_1 - f'',  &e_i \mapsto -f_i + f_{i-1} \text{ for } 1< i < r, & &e_r \mapsto f_{r-1}, \\ &e'_1 \mapsto -f'_1 + f'',  &e'_j \mapsto -f'_j + f'_{j-1} \text{ for } 1< j < r, & &e'_r \mapsto f'_{r-1}.
\end{align*}
The point of this mess is that under the $\underline{f}$-grading, $M=\prod_{i,j} x_{i,j}^{a_{i,j}}$ has degree $0$ if and only if $A=[a_{i,j}]$ is a magic square. Indeed, the $f_i$-degree of $M$ is the $e_{i+1}$-degree minus the $e_i$ degree, so the row sums all agree, the $f'_j$-degree of $M$ is the $e'_{j+1}$-degree minus the $e_j$-degree, so the column sums all agree,  and the $f''$-degree of $M$ is the $e'_1$-degree minus the $e_1$-degree, so the row sum agrees with the column degree.

Let $R$ be the degree zero piece of $S$ in the $\underline{f}$-grading. Evidently, as a $K$-vector space, \[R=\bigoplus K \cdot \prod_{i,j} x_{i,j}^{a_{i,j}} \ \ \big| \ A=[a_{i,j}] \text{ is a magic square}.\] Since $S$ can be written as a direct sum of its graded pieces in the $\underline{f}$-grading, and these are preserved by multiplication by elements of $R$, this realizes $R$ as an $R$-linear direct summand of $S$.

We need to collect one more fact about $R$.

\begin{lemma}
	The ring $R$ described above is generated as a $K$-algebra by $\{ \prod_i x_{i,\sigma(i)} \ | \ \sigma\in \mathcal{S}_n \}$.
\end{lemma}
\begin{proof}
	It suffices to show that any monomial in $R$ is a product of monomials in the set specified above. The exponent matrix of a monomial in the specified set is a permutation matrix. Thus, it suffices to show that any magic square is a sum of permutation matrices. By induction on the sum, it suffices to show that for any magic square, one can subtract a permutation matrix and obtain a smaller magic square. This is clear.
\end{proof}

We can now prove the theorem.

\begin{theorem} For $r>0$, the function 
	\[m_r(n)=\# \text{ magic squares of size $r$ and sum $n$}\]
	agrees with a polynomial function for all $n\in \NN$.
	\end{theorem}
\begin{proof}
	The ring $R$ is a direct summand of the polynomial ring $S$. This inclusion preserves degrees if we give each $x_{i,j}$ degree one, and the splitting constructed above which sends 
	\[\sum_{A \in \NN^{r\times r}}{f_A  \prod_{i,j} x_{i,j}^{a_{i,j}}} \mapsto \sum_{A \text{ a magic square }}{f_A  \prod_{i,j} x_{i,j}^{a_{i,j}}}\]
	is a graded splitting. We call this grading the basic $\NN$-grading on $R$. Assume now that $K$ is a perfect field of positive characteristic. We have that $R$ is $F$-rational, hence it is Cohen-Macaulay with negative $a$-invariant in the basic grading.
	
	Now, $R$ is generated by elements of degree $r$ in the basic grading. In particular, every element of $R$ lives in degrees a multiple of $r$. We can therefore rescale all of the degrees in $R$ by dividing every degree by $r$, and call this the rescaled grading.
	
	In the rescaled grading, $R$ is standard graded, CM with negative $a$-invariant, so its Hilbert function is a polynomial. But, the space of elements of degree $n$ in the rescaled grading has a $K$-basis in bijection with the magic squares with sum $n$.
\end{proof}




\chapter{Local cohomology and differential operators}

\section{Differential operators}

While we will mostly focus on the case of a polynomial or power series ring over a field of characteristic zero, we will begin with a general definition.

\begin{definition}
	Let $A\subseteq R$ be an inclusion of rings. The \emph{$A$-linear differential operators on $R$ of order at most $n$}\index{differential operators}\index{$D^n_{R|A}$}\index{$D_{R|A}$} are defined inductively as follows:
	\begin{itemize}
		\item $D^0_{R|A}:=\Hom_R(R,R)=\{ \bar{f} \ | \ f\in R\}$, where $\bar{f}$\index{$\bar{f}$} is the map ``multiplication by $f$''
		\item $D^n_{R|A}:=\{ \delta \in \Hom_A(R,R) \ | \ \delta \circ \bar{f} - \bar{f} \circ \delta \in D^{n-1}_{R|A} \}$.
	\end{itemize}
With no superscript, the \emph{$A$-linear differential operators on $R$} are $D_{R|A}=\bigcup_{n\in \NN} D^n_{R|A}$.
\end{definition}

Typically, one identifies $\bar{f}$ with $f$, and $D^0_{R|A}$ with $R$. This has the advantage of being less clunky, but has the disadvantage of introducing some ambiguity as to whether an element $f\in R$ is to be considered as an operator from $R$ to $R$, or as an element of $R$ to be acted upon by operators.

In our main case of present interest, we can give an explicit description.

\begin{example} Let $K$ be a field of characteristic zero. Let $R=K[x_1,\dots,x_d]$ or $R=K\llbracket x_1,\dots, x_d\rrbracket$. Then 
	\[ D^n_{R|K}= \left\{ \sum \bar{f}_\alpha \frac{\partial^{\alpha_1}}{\partial x_1^{\alpha_1}}\cdots \frac{\partial^{\alpha_d}}{\partial x_d^{\alpha_d}} \ \Big| \ \sum{\alpha_i} \leq n \right\} \subseteq \Hom_K(R,R). \]
That is, the differential operators of order at most $n$ are the $R$-linear combinations of compositions of at most $n$ partial derivatives; here we interpret the $R$ elements as ``multiplications by.''

To be concrete, $\overline{x_1 x_2^3} \frac{\partial^2}{\partial x_1^2}$ is a differential operator of order 2 that sends $x_1$ to zero, and $x_1^2$ to $2 x_1 x_2^3$.

Note that $\frac{\partial}{\partial x_1} \bar{x_1}$ is an element of $D_{R|K}$, despite it not fitting the description above. Indeed, if we expand any element in $R$ in terms of powers of $x_1$ as $f=\sum f_i x_1^i$, where each $f_i$ only depends on the other variables, we have 
\[\left(\frac{\partial}{\partial x_1} \bar{x_1}\right) (f) = \frac{\partial}{\partial x_1} \sum f_i x_1^{i+1} = \sum f_i (i+1) x^i = f + x_1 \sum i f_i x^{i-1} = \left(\bar{1} + \bar{x_1} \frac{\partial}{\partial x_1}\right)(f). \]
Similarly, for each $i$, we have relations $\frac{\partial}{\partial x_i} \bar{x_i}=\bar{1} + \bar{x_i} \frac{\partial}{\partial x_i}$. Furthermore, as we used implicitly above, any partial commutes with any $\bar{x_i}$ with a different index. Using these rules, any combination of $\bar{f}$'s and partials can be rearranged as a sum such that in each term, all of the partials occur first (on the right); that is, any such combination is of the form above.

We can thus rewrite our description as follows:
\[ D_{R|K}= R\left\langle \frac{\partial}{\partial x_1}, \dots, \frac{\partial}{\partial x_d} \right\rangle \subseteq \Hom_K(R,R), \]
where the brackets denote generation as a noncommutative ring, where the operation is composition, and the copy of $R$ is the ``multiplications by.''
To see that this description agrees with the prescribed definition requires a proof. It is easy to see that we have a containment between the description here are the definition; we leave as an exercise the other containment. Alternatively, one can use the descriptions here as a working definition and give alternative proofs of the next few lemmas.
\end{example}

\begin{lemma}
	Let $A\subseteq R$ be an inclusion of rings. Let $\alpha\in D^m_{R|A}$ and $\beta\in D^n_{R|A}$. Then, $\alpha \circ \beta \in D^{m+n}_{R|A}$ and $[\alpha,\beta]:=\alpha \circ \beta - \beta \circ \alpha \in D^{m+n-1}_{R|A}$.\index{$[\alpha,\beta]$}
\end{lemma}
\begin{proof}
We proceed by induction on $m+n$. If $m+n=0$, the first assertion is clear, and the second is clear if $m+n=1$. Now, 
\[ [\alpha \circ \beta, \bar{f}]=\alpha \circ \beta \circ \bar{f} - \bar{f} \circ \alpha \circ \beta  = \alpha \circ \beta \circ \bar{f} - \alpha  \circ \bar{f} \circ \beta + \alpha  \circ \bar{f} \circ \beta - \bar{f} \circ \alpha \circ \beta = \alpha \circ [ \beta, \bar{f}] + [\alpha ,\bar{f}] \circ \beta.\]
Since the order of $ [ \beta, \bar{f}]$ is less than $n$, and the order of $[\alpha ,\bar{f}]$ is less than $m$, the induction hypothesis applies to each term, so each is in $D^{m+n-1}_{R|A}$. Then, by definition, $\alpha \circ \beta\in D^{m+n-1}_{R|A}$.

For the second claim, we note that 
\[ [[\alpha,\beta],\bar{f}] = [\alpha, [\beta,\bar{f}]] - [[\alpha,\bar{f}],\beta],  \]
(check it!) which lies in $D^{m+n-2}_{R|A}$ by the induction hypothesis, so $[\alpha,\beta]\in D^{m+n-1}_{R|A}$ by definition.
\end{proof}

\begin{remark} From the first statement above, it follows that $D_{R|A}$ is a not-necessarily-commutative ring under composition. We will henceforth omit the composition circles.
\end{remark}

\begin{definition} A \emph{$D$-module}\index{$D$-module} on a ring $R$ is a left $D_{R|A}$-module. When we assert that an $R$-module $M$ is a $D$-module, this means that the action of $f$ on $M$ as an $R$-module agrees with the action of $\bar{f}$ on $M$ as a $D_{R|K}$-module.
\end{definition}

We caution that the dependence on $A$ is suppressed in the notation.

\begin{example}
	The free cyclic module $R$ is tautologically a $D$-module.
\end{example}

A number of other interesting $R$-modules are also $D$-modules for any $R$ and subring $A$.

\begin{proposition}
	Let $R$ be a noetherian ring, and $A$ a subring. Let $M$ be a $D$-module.
	\begin{enumerate}
		\item For any multiplicative set $W$, $W^{-1} M$ is a $D$-module.
		\item For any ideal $I$, $\Gamma_I(M)$ is a $D$-module.
		\item If $R$ is Gorenstein, any injective $R$-module is a $D$-module.
		\item For any ideal $I$, $\H^i_I(R)$ is a $D$-module.
	\end{enumerate}
\end{proposition}
\begin{proof}
	\begin{enumerate}
		\item We define the action of $D$ on $W^{-1}M$ by induction on the order. For operators of order $0$, this is just localization as an $R$-module. Given $m/w\in W^{-1}M$, we set 
		\[ \delta \left( \frac{m}{w}\right)=\frac{\delta\cdot m - [\delta,\bar{w}](\frac{m}{w})}{w}.\]
		Since $m\in M$ and $[\delta,w]$ has lower order than $\delta$, the right-hand side makes sense inductively. We leave the verification to you that this is a $D$-module action.
		
		\item If $I=(f_1,\dots,f_t)$, then $\Gamma_I(M)=\ker(M\to \oplus_i M_f)$ is the kernel of a map of $D$-modules, hence is a $D$-module.
		
		\item It suffices to check for indecomposable injectives. As in the proof that injectives over regular local rings are $F$-modules, we can write an indecomposable injective as the cohomology of a complex whose terms are localizations of $R$. We can realize this as a complex of $D$-modules, so such an injective is a $D$-module.
		
		\item The \v Cech complex on a generating set for $I$ is a complex of $D$-modules, hence the cohomology is a $D$-module.\qedhere
	\end{enumerate}
\end{proof}

We note that it is not a priori clear, on its own, that a differential operator gives a map on local cohomology, since such a map is not $R$-linear.


\section{Filtrations and Bernstein's inequality}

Although the ring of differential operators is noncommutative in general, it is close to being commutative in the sense that it has a filtration for which the associated graded is commutative. Pushing this philosophy gives us surprisingly great leverage over $D$-modules in the case of polynomial rings in characteristic zero (and power series rings too). To  put this to use, we will discuss filtrations in some generality.


All modules are left modules.

\begin{definition}
	\begin{itemize}
	\item A \emph{filtration}\index{filtration}\index{filtered ring} on a not-necessarily-commutative ring $R$ is an ascending chain of additive subgroups of $R$
	\[ F_0 \subseteq F_1 \subseteq F_2 \subseteq \cdots \subseteq R\]
	such that $F_i \cdot F_j \subseteq F_{i+j}$ and $\bigcup_{i\in \NN} F_i = R$. If $R$ is a $K$-algebra, we assume in addition that each $F_i$ is a $K$-vector space. We call $R$ endowed with this structure a \emph{filtered ring}.
	\item If $R$ is a filtered ring, and $M$ an $R$-module, a \emph{filtration}\index{filtered module} on $M$ is an ascending chain of additive subgroups of $M$
	\[ G_0 \subseteq G_1 \subseteq G_2 \subseteq \cdots \subseteq M\]
	such that $F_i \cdot G_j \subseteq G_{i+j}$ and $\bigcup_{i\in \NN} G_i = M$. If $R$ is a $K$-algebra, we assume in addition that each $G_i$ is a $K$-vector space. We call $M$ endowed with this structure a \emph{filtered module}. Note that this notion depends on a fixed filtration on $R$; if we wish to emphasize the filtration on $R$, we may say that $G_\bullet$ is compatible with the filtration $F_\bullet$ on $R$.
	\end{itemize}
\end{definition}

\begin{example}
	Let $A\subseteq R$. The ring of differential operators $D_{R|A}$ admits a filtration given by $F_i=D^i_{R|A}$; we proved the key filtration property as a lemma above.
\end{example}

\begin{definition}
	If $R$ is a filtered ring, the \emph{associated graded ring}\index{associated graded ring} is
	\[ \mathrm{gr}_{F_\bullet}(R) := \bigoplus_{n \in \NN} F_i/F_{i-1}. \]
\end{definition}

The filtration property endows this with a well-defined multiplication, and the resulting ring is graded by $\NN$.

\begin{definition}
	If $R$ is a filtered ring, and $M$ a filtered module, the \emph{associated graded module}\index{associated graded module} is the $\mathrm{gr}_{F_\bullet}(R)$-module
	\[ \mathrm{gr}_{G_\bullet}(M) := \bigoplus_{n \in \NN} G_i/G_{i-1}. \]
\end{definition}

Again, there is an elementary verification being brushed under the rug.

\begin{proposition} Let $A\subseteq R$ be an inclusion of rings. The associated graded ring of $D_{R|A}$ with respect to the order filtration, which we denote $\mathrm{gr}_{\mathrm{ord}}(D_{R|A})$\index{$\mathrm{gr}_{\mathrm{ord}}(D_{R|A})$}, is commutative.
\end{proposition}
\begin{proof}
	Let $x\in \mathrm{gr}_{\mathrm{ord}}(D_{R|A})_m$ and $y\in \mathrm{gr}_{\mathrm{ord}}(D_{R|A})_n$. Then $x=x'+D^{m-1}_{R|A}$ and $y=y'+D^{n-1}_{R|A}$ for some $x',y'\in D^m_{R|A},D^n_{R|A}$, respectively. By a lemma above, $x'y'-y'x'\in D^{m+n-1}_{R|A}$, so $xy-yx=x'y'-y'x' + D^{m+n-1}_{R|A} = 0 +D^{m+n-1}_{R|A}=0$ in $\mathrm{gr}_{\mathrm{ord}}(D_{R|A})$. Since homogeneous elements span the ring as an additive group, we must have that all elements commute.
\end{proof}

\begin{example}
	Let $K$ be a field of characteristic zero, and $R$ a polynomial ring or power series ring in $d$ variables over $K$. Note that \[\mathrm{gr}_{\mathrm{ord}}(D_{R|K})_0=D^0_{R|K}\cong R, \quad \text{and} \quad \mathrm{gr}_{\mathrm{ord}}(D_{R|K})_1=\frac{D^1_{R|K}}{D^0_{R|K}}\cong \frac{R \oplus \bigoplus_i R \frac{\partial}{\partial x_i}}{R} \cong \bigoplus_i R \xi_i,\]
	where $\xi_i$ is the class of $\frac{\partial}{\partial x_i}$ modulo $D^0_{R|K}$, and the copy of $R$ is $\{ \bar{r} \ | \ r\in R\}$. Since every element of $D^i_{R|K}$ can be written as a combination of products of elements in $D^1_{R|K}$, it follows that $\mathrm{gr}_{\mathrm{ord}}(D_{R|K})$ is generated over $R$ in degree one. Thus, there is a graded surjection $R[y_1,\dots,y_d]\to \mathrm{gr}_{\mathrm{ord}}(D_{R|K})$, where $R$ lives in degree zero, and the $y_i$'s are (commutative) variables.
	
	To see that this is an isomorphism, we note that the inclusions $D^{i-1}_{R|K}\subset D^{i}_{R|K}$ are split inclusions of free modules, so each graded component $\mathrm{gr}_{\mathrm{ord}}(D_{R|K})_i$ is $R$-free and its rank is easily calculated as $\binom{d+i-1}{d-1}$, which agrees with the $R$-rank of $R[y_1,\dots,y_d]_i$; it follows that the kernel is zero.
\end{example}

\begin{lemma}
	Let $R$ be a filtered ring and $M'\subseteq M$ be $R$-modules. Let $M$ be filtered. Then $G_{\bullet} \cap M'$ is a filtration on $M'$, and if $\mathrm{gr}_{G_\bullet \cap M'}(M')\subseteq \mathrm{gr}_{G_\bullet}(M)$ is an equality, then $M'=M$.
\end{lemma}
\begin{proof}
	It is clear that $G_{\bullet} \cap M'$ is a filtration on $M'$. There are inclusions $\frac{M'\cap G_i}{M' \cap G_{i-1}}\subseteq \frac{M \cap G_i}{M \cap G_{i-1}}$, and hence an inclusion of the associated graded modules. 
	
	Now, if the associated gradeds are equal, then $\frac{M' \cap G_i}{M' \cap G_{i-1}}=\frac{M \cap G_i}{M \cap G_{i-1}}$ for all $i$, and in particular, $M' \cap G_0 = M \cap G_0$. It follows by induction on $i$ that $M' \cap G_i = M \cap G_i$ for all $i$, and since $\bigcup_{i\in \NN} G_i = M$, we must have that $M' = M$.
\end{proof}

\begin{proposition}
	Let $R$ be a filtered ring and $M$ an $R$-module. If $M$ has a filtration such that $\mathrm{gr}_{G_\bullet}(M)$ is a noetherian $\mathrm{gr}_{F_\bullet}(R)$-module, then $M$ is noetherian. In particular, if $\mathrm{gr}_{F_\bullet}(R)$ is noetherian, then $R$ is noetherian.
\end{proposition}
\begin{proof}
	Given a chain of submodules \[M_1 \subseteq M_2 \subseteq M_3 \subseteq \cdots \subseteq M,\]
	 there are induced filtrations on each $M_i$ given by intersecting the filtration $G_\bullet$. This induces a chain
	  \[\mathrm{gr}_{G_\bullet \cap M_1}(M_1) \subseteq \mathrm{gr}_{G_\bullet \cap M_2}(M_2) \subseteq  \cdots \subseteq \mathrm{gr}_{G_\bullet}(M),\]
	  of $\mathrm{gr}_{F_\bullet}(R)$-submodules of the noetherian module $\mathrm{gr}_{G_\bullet}(M)$, which must stabilize. By the previous lemma, this implies that the original chain stabilizes.
\end{proof}

The previous proposition motivates the following definition.

\begin{definition} Let $R$ be a filtered ring, and $M$ an $R$-module. A \emph{good filtration}\index{good filtration} on $M$ is a filtration on $M$ such that $\mathrm{gr}_{G_\bullet}(M)$ is a finitely generated module over $\mathrm{gr}_{F_\bullet}(R)$.
\end{definition}

\begin{proposition}
	Let $R$ be a filtered ring such that $\mathrm{gr}_{F_\bullet}(R)$ is noetherian. Let $M$ be an $R$-module. Then, $M$ is finitely generated if and only if $M$ admits a good filtration.
\end{proposition}
\begin{proof}
	The ``if'' is a consequence of the previous proposition. For the other implication, we construct a good filtration on $M$ from a generating set $m_1,\dots, m_t$ by setting $G_i =  F_i \cdot m_1 + \cdots + F_i \cdot m_t \subseteq M$.
\end{proof}

\begin{proposition}
	Let $R$ be a filtered ring such that $\mathrm{gr}_{F_\bullet}(R)$ is noetherian. Let $M$ be an $R$-module. Let $G_\bullet$ and $G'_\bullet$ be filtrations for $M$. Suppose that $G_\bullet$ is a good filtration. Then there is an integer $a$ such that $G_i \subseteq G'_{i+a}$ for all $i$.
	
	In particular, any two good filtrations are comparable by a finite shift in either direction.
\end{proposition}
\begin{proof} Let $m'_1,\dots,m'_s\in M$ be elements such that their images $m_1,\dots, m_s$ generate $\mathrm{gr}_{G_\bullet}(M)$ as a $\mathrm{gr}_{F_\bullet}(R)$-module, and $m'_i\in G_{a_i}\smallsetminus G_{a_i-1} \cap G'_{b_i}\smallsetminus G'_{b_i-1}$. By the generation assumption, one has an equality $G_t= \sum F_{t-a_i} m_i$ for all $t$, where $F_{<0}=0$ (check it!).
	
	 Thus, for $t>\max_i \{a_i\}$, 
	\[G_t =\sum F_{t-a_i} m_i \subseteq \sum F_{t-a_i} G'_{b_i} \subseteq \sum G'_{t+b_i-a_i} \subseteq \sum G'_{t+a} \]
	where $a=\max_i \{b_i-a_i\}$.
\end{proof}

\begin{proposition} Let $R$ be a filtered $K$-algebra with $\mathrm{gr}_{F_\bullet}(R)$ commutative and finitely generated over $F_0=K$. Let $M$ be a finitely generated $R$-module. Then, there are integers $d(M)\geq 0$, $e(M)>0$ (if $M\neq 0$) such that for any good filtration $G_\bullet$ of $M$, $\dim_K(G_t)\sim \frac{e(M)}{d(M)!} t^{d(M)}$ as a function of $t$. 
	\end{proposition}
\begin{proof}
	For a fixed good filtration, $\dim_K(G_t)$ as a function of $t$ is a (cumulative) Hilbert function $H(t)=\dim_K([\mathrm{gr}_{G_\bullet}(M)]_{\leq t})$
	of a finitely generated graded module over a finitely generated graded $K$-algebra. Thus, $H(t)$ agrees with an integer-valued polynomial for sufficiently large $t$.
	
	To see that this is independent of the choice of a good filtration, let $G'_{\bullet}$ be another good filtration, and $H'(t)$ the corresponding Hilbert function. Let $H(t)\sim \frac{e}{d!} t^d$. By the previous proposition, there is some $a$ such that $G_{t-a} \subseteq G'_{t} \subseteq G_{t+a}$ for all sufficiently large $t$. Then,
	\[ \frac{e}{d!} = \lim_{t\to \infty} \frac{\dim_K (G_{t-a})}{t^d} \leq \frac{\dim_K (G'_{t})}{t^d} \leq \frac{\dim_K (G_{t+a})}{t^d} = \frac{e}{d!}, \]
	where the equalities holds since $\dim_K(G_{t+a}/G_{t})$ grows at the rate of $t^{d-1}$ for fixed $t$. Thus, $\dim_K(G'_t)\sim \frac{e}{d!} t^d$ as well.
\end{proof}

\begin{definition} In the situation above, the integers $d(M)$ and $e(M)$ are called the \emph{dimension}\index{dimension} and \emph{multiplicity}\index{multiplicity} of $M$, respectively. We note that these notions a priori depend on the choice of a filtration on $R$ (but not on $M$).
	\end{definition}


\begin{lemma} Let $R$ be a filtered $K$-algebra with $\mathrm{gr}_{F_\bullet}(R)$ commutative and finitely generated over $F_0=K$. Let $0 \to A \to B \to C \to 0$ be a short exact sequence of finitely generated $R$-modules. Then $d(B)=\max\{d(A),d(C)\}$. If all three of the dimensions are equal, then $e(B)=e(A)+e(C)$.
\end{lemma}
\begin{proof}
	Given a good filtration on $B$ we can restrict to $A$ to obtain a good filtration, and the surjection to $C$ induces a good filtration. Then, the Hilbert functions of the associated gradeds are additive on the short exact sequence, so the statements follow from the analogous statements from the usual Hilbert function situation.
\end{proof}

We want to apply these facts to the ring of differential operators over a polynomial ring. We already have a filtration, the order filtration, for any ring of differential operators. However, this fails the condition $F_0=K$ in the propositions above. We can salvage the order filtration for the purposes above, but we will pursue a somewhat easier approach, using a different filtration.

\begin{definition} Let $K$ be a field of characteristic zero, and $R$ a polynomial ring in $d$ variables over $K$. The \emph{Bernstein filtration}\index{Bernstein filtration} on $D_{R|K}$ is given by
	\[ F_i = \bigoplus_{|\alpha| + |\beta|\leq i} K \cdot \bar{x}^{\alpha} \partial^{\beta}, \quad\text{where} \
	\alpha,\beta \in \NN^d, \ \ \bar{x}^\alpha=\bar{x_1}^{\alpha_1}\cdots \bar{x_d}^{\alpha_d}, \ \ \text{and} \ \ \partial^{\beta}=\frac{\partial^{\beta_1}}{\partial x_1^{\beta_1}}\cdots \frac{\partial^{\beta_d}}{\partial x_d^{\beta_d}}.  \]
	\end{definition}

From the construction, this is obviously an increasing union of $K$-vector spaces. Using the relations $\frac{\partial}{\partial x_i}\bar{x_i}=\bar{x_i} \frac{\partial}{\partial x_i} + \bar{1}$, we see that any differential operator lies in some $F_i$; here it matters that we are dealing with a polynomial ring instead of a power series ring. Using the same relations, we can see that $F_i F_j \subseteq F_{i+j}$: when we ``straighten out'' differential operators into the desired form, we pick up terms that are lower in the filtration.

\begin{proposition} Let $K$ be a field of characteristic zero, and $R$ a polynomial ring in $d$ variables over $K$. The associated graded ring of $D_{R|K}$ with respect to the Bernstein filtration, denoted $\mathrm{gr}_{\mathrm{Ber}}(D_{R|K})$\index{$\mathrm{gr}_{\mathrm{Ber}}(D_{R|K})$}, is a standard graded polynomial ring generated by the images of the $\bar{x_i}$'s and $\frac{\partial}{\partial x_i}$'s.
	\end{proposition}
\begin{proof}
From the definition of the Bernstein filtration, it is evident that elements of $F_i$ can be expressed as linear combinations of products of elements in $F_1$, and hence that the associated graded is generated in degree 1. To see that the associated graded is commutative, we then just need to see that for each $i$, the classes of $\bar{x_i}$ and $\frac{\partial}{\partial x_i}$ commute. But 
	\[ (\bar{x_i} + F_0)\left(\frac{\partial}{\partial x_i} + F_0\right) - \left(\frac{\partial}{\partial x_i} + F_0\right)(\bar{x_i} + F_0) = \bar{x_i} \frac{\partial}{\partial x_i} - \frac{\partial}{\partial x_i} \bar{x_i}  + F_1 = -\bar{1} + F_1 = 0.\]
	Thus, the associated graded is a quotient of a polynomial ring in $2d$ variables. Now, the $K$-vector space dimension of $F_i$ agrees with the (cumulative) Hilbert function of a polynomial ring in $2d$ variables evaluated at $i$, so the graded ring must be the trivial quotient (the polynomial ring itself).
\end{proof}

The following amazing fact is the reward for working with the Bernstein filtration. It is the key to the power of $D$-modules on polynomial rings and smooth varieties.

\begin{theorem}[Bernstein's inequality]
	Let $K$ be a field of characteristic zero, and $R$ a polynomial ring in $d$ variables over $K$. For any nonzero finitely generated $D$-module, $d \leq d(M) \leq 2d$.
	\end{theorem}
\begin{proof} The second inequality is clear.
	Take a good filtration $G_\bullet$ for $M$ (with respect to the Bernstein filtration).
	
	 We claim that the map
	$F_t \to \Hom_{K}(G_t,G_{2t})$ given by the left action is injective. To see this, we induce on $t$. For $t=0$, $F_0$ consists of zero units, which act injectively. Let $\delta\in F_t$. There is an $i$ for which $[\delta,\bar{x_i}]$ or $[\delta,\frac{\partial}{\partial x_i}]$ is a nonzero element of $F_{t-1}$ (check it!). In the first case, by the IH, $(\delta \bar{x_i} - \bar{x_i} \delta)(G_{t-1})\neq 0$. Since $\bar{x_t} G_{t-1} \subseteq G_{t}$, $\delta(G_t)=0$ would give a contradiction. The same reasoning applies in the second case.
	
	Consequently, $\dim_K(F_t) \leq \dim_K \Hom_K(G_t,G_{2t}) = (\dim_K(G_t))(\dim_K(G_{2t}))$. Since one has ${\dim_K(F_t) \sim \frac{1}{(2d)!} t^{2d}}$, the statement follows.
\end{proof}

\begin{remark}
	A consequence of this argument is that any finitely generated $D$-module is faithful.
\end{remark}

\begin{definition} Let $K$ be a field of characteristic zero and $R$ be a polynomial ring in $d$ variables over $K$.
	A $D$-module $M$ is \emph{holonomic}\index{holonomic} if it is finitely generated and $d(M)=d$ or $M=0$ (with respect to the Bernstein filtration).
\end{definition}

\begin{example} $R$ is a holonomic $D$-module. To see this, we note that $R$ is generated by $1$ as a $D$-module, and that every partial annihilates $1$, so we can write $R=D/D(\underline{\partial})$. Then, it is easy to see that $\mathrm{gr}_{\mathrm{Ber}}(R)$ endows $R$ with its usual standard grading. Note that an easy consequence of Bernstein's inequality is that for no proper ideal $I$ of $R$ is $R/I$ a $D$-module.
	\end{example}

\begin{remark}
	Let $K$ be a field of characteristic zero and $R=K[x_1,\dots,x_d]$. If one works with the order filtration, the graded pieces of $\mathrm{gr}_{\mathrm{ord}}(D_{R|K})$ are generally not finite dimensional vector spaces, so one cannot define degree and multiplicity by using the Hilbert function directly. However, one could define the dimension of a $D$-module $M$ as the dimension as a $\mathrm{gr}_{\mathrm{ord}}(D_{R|K})$-module of $\mathrm{gr}_{G_\bullet}(M)$, where $G_\bullet$ is a good filtration on $M$ with respect to the order filtration. It turns this returns the same value as $d(M)$ with respect to the Bernstein filtration. In particular, the crucial Bernstein inequality holds if we work with the order filtration.
	
	In the case of a power series ring $R=K\llbracket x_1,\dots,x_d\rrbracket$ over a field $K$ of characteristic zero, the Bernstein inequality holds for the order filtration as well. One can find this in Bj\"ork's book; see Mel's primer on Gennady's theorems from his Winter 2011 class. The associated graded $\mathrm{gr}_{\mathrm{ord}}(D_{R|K})$ has a distinguished maximal ideal $\m \mathrm{gr}_{\mathrm{ord}}(D_{R|K})_0 +\mathrm{gr}_{\mathrm{ord}}(D_{R|K})_+$, and one obtains a theory of multiplicities for holonomic modules as well.
\end{remark}

\begin{remark}
	The assumption that $R$ be a polynomial or power series ring, or some similar smoothness/regularity hypothesis is also crucial for a number of reasons. First, there is no Bernstein filtration for most rings; the ring of differential operators is not generated over $R$ by derivations for many rings---conjecturally, it only happens for regular rings in characteristic zero. Second, there are many $\CC$-algebras $R$ for which $D_{R|\CC}$ and $\mathrm{gr}_{\mathrm{ord}}(D_{R|\CC})$ are not noetherian. Third, Bernstein's inequality (in the order filtration) can fail even for finitely generated $\CC$-algebras.
\end{remark}


\section{Holonomicity and Lyubeznik's finiteness theorem}

We can apply the theory of $D$-modules to prove an analogue of the positive characteristic theorem of Huneke and Sharp from above. The result will follow just from basic properties of holonomic modules.

\begin{lemma}
	Let $R$ be a polynomial ring over a field of characteristic zero. If $M$ is a holonomic $D$-module, then any submodule or quotient module of $M$ is holonomic. The homology modules of any complex of holonomic $D$-modules is holonomic.
\end{lemma}
\begin{proof}
	This is immediate from the fact $D_{R|K}$ is noetherian, so subs and quotients of f.g.~modules are f.g.~and that the dimension of any sub or quotient is no greater than that of the original.
\end{proof}

\begin{lemma} Let $R$ be a polynomial ring over a field of characteristic zero. If $M$ is a holonomic $D$-module, then $\ell_{D_{R|K}}(M)\leq e(M)$. In particular, it has finite length.
\end{lemma}
\begin{proof}
	If $M'$ is a proper submodule of $M$, since $d(M')=d(M)=d(M/M')$, we have that $e(M)=e(M')+e(M/M')$, with $e(M/M')>0$, so $e(M')<e(M)$. Thus any proper chain of submodules yields a strictly increasing sequence of positive integers bounded by $e(M)$, hence can have at most $e(M)$ terms.
\end{proof}

\begin{lemma}
	Let $R$ be a polynomial ring over a field of characteristic zero. Let $M$ be a holonomic $D$-module. Then the set of associated primes of $M$ as a $D$-module is finite.
\end{lemma}
\begin{proof}
	We proceed by induction on the length as a $D$-module, with length zero being trivial. If $M$ is nonzero, and $\p$ is an associated prime, then $\Gamma_{\p}(M)\neq 0$, and if $\q$ is another associated prime, then $\Gamma_{\q}(M)\neq \Gamma_{\p}(M)$. Thus, unless $\p$ is the only associated prime of $M$, $\Gamma_{\p}(M)$ is a proper $D$-submodule of $M$. We obtain a short exact sequence of nonzero holonomic $D$-modules
	\[ 0 \to \Gamma_{\p}(M) \to M \to M/\Gamma_{\p}(M) \to 0.\]
	By the induction hypothesis on length, both $\Gamma_{\p}(M)$ and $M/\Gamma_{\p}(M)$ have finitely many associated primes. Since $\Ass(M) \subseteq \Ass(\Gamma_{\p}(M)) \cup \Ass(M/\Gamma_{\p}(M))$, the lemma follows.
\end{proof}


\begin{lemma} Let $R$ be a polynomial ring over a field of characteristic zero. Let $M$ be a not-necessarily-finitely-generated $D$-module with a filtration
$G_\bullet$ compatible with the Bernstein filtration on $D_{R|K}$.
If there exists an integer $c$ such that $\dim_K(G_t)\leq c t^n + O(t^{n-1})$, then the $D$-module $M$ is finitely generated and holonomic.
\end{lemma}
\begin{proof}
We will show that any chain of finitely generated submodules of $M$ stabilizes; it will follow from this that $M$ is a noetherian module over a noetherian ring, and hence a finitely generated module. One we have done this, we know that $M$ is holonomic by the definition of dimension.
	
Let $M'$ be a finitely generated $D$-submodule of $M$, and consider a good
filtration $G'_\bullet$ on $M'$ compatible with the Bernstein filtration on $D_{R|K}$. Since $G'_\bullet$ is a good filtration on $M'$ and $G_\bullet \cap M'$ is a filtration on $M'$,
there is an integer $a$ such that $G'_i \subseteq G_{i+a} \cap M'$ for each $i$. It follows that $d(M')=d$ and that $e(M') \leq d!c$. Thus, any finitely generated submodule
of $M$ is holonomic of multiplicity at most $d! c$. As in the lemma above, a proper chain of holonomic submodules of $M$ yields a strictly increasing sequence of positive integers bounded by $d! c$, hence cannot be infinite.
\end{proof}

\begin{proposition}
	Let $R$ be a polynomial ring over a field of characteristic zero, and $f\in R$. Then $R_f$ is a holonomic $D$-module.
\end{proposition}
\begin{proof}
	Set $G_t=\{ \frac{g}{f^t} \ | \ \deg(g)\leq t(1+ \deg(f)) \}$. We claim that this is a filtration on $R_f$ compatible with the Bernstein filtration and that this satisfies the length inequality above.
\end{proof}

An interesting consequence of the above proposition is that for any nonzero $f$, there is an $N$ such that for all $n>N$, there is a differential operator $\delta_n$ with $\delta_n(1/f^{n})=1/f^{n+1}$. Indeed, $R_f=D\cdot\{ 1, 1/f, 1/f^2,1/f^3,\dots\}$, since this is a generating set as an $R$-module, and by holonomicity, a finite subset of these generators suffices. A refinement of this observation is given by the existence of the \emph{Bernstein-Sato polynomial}\index{Bernstein-Sato polynomial}: for any 
$f\in R\setminus 0$, there is some $b_f(s)\in K[s]$ and some $\delta(s)\in D_{R|K}[s]$ (i.e., a polynomial combination in $s$ of differential operators) such that $\delta(t)(f^{t+1})=b_f(t) f^t$ for all $t\in \ZZ$.

\begin{theorem}
	Let $R$ be a polynomial ring over a field $K$ of characteristic zero. Let $I\subseteq R$ be an ideal. Then each $\H^i_I(R)$ has finitely many associated primes.
\end{theorem}
\begin{proof}
	The \v Cech complex on a generating set for $I$ is a complex of holonomic $D$-modules. Its homology modules, the local cohomology modules, are holonomic. Thus they have finitely many associated primes.
\end{proof}

\begin{comment}

\section{$D$-simplicity and faithfulness}

The use of differential operators, like Frobenius, can still be fruitful on singular rings. We caution that much of the finer points of the machinery above fail even for finitely generated $K$-algebras: the ring $\mathrm{gr}_{\mathrm{ord}}(D_{R|K})$ may fail to be noetherian, the Bernstein filtration doesn't make sense any more, and Bernstein's inequality can fail for the order filtration. These all happen for such a nice ring as $\frac{\CC[x,y,z]}{(x^3+y^3+z^3)}$. The differential operators will still be a useful tool nonetheless. We pose a definition that is useful to this end.

\begin{definition}
	Let $A \subseteq R$ be an inclusion of rings. We say that $R$ is \emph{$D$-simple}\index{$D$-simple} if $R$ is a simple $D$-module. We warn that this depends on $A$ although it is dropped from the notation.
\end{definition}

\begin{remark}
	Suppose that $(R,\m)$ is local or graded. Then $R$ is $D$-simple if and only if for each $r\in R\smallsetminus 0$, there is some $\delta\in D_{R|A}$ such that $\delta(r)=1$. Indeed, ``if'' is clear, since any ideal of $R$ that is a $D$-submodule of $R$ must then contain 1. The other implication follows since the set of elements $\{r \in R \ | \ \delta(r)\in \m\}$ can be verified to be an ideal, and thus must be the zero ideal by hypothesis.
\end{remark}

\begin{example}
	Let $K$ be a field of characteristic zero, and $R$ a polynomial ring  over $K$. We observed earlier as a consequence of Bernstein's inequality that $R/I$ is not a $D$-module for any proper ideal $I$. It follows that $R$ is $D$-simple. 
\end{example}

\begin{proposition}
	Let $A\subseteq R \subseteq S$ be three rings, with $R$ and $S$ local or graded. Suppose that $R$ is a direct summand of $S$. If $S$ is $D$-simple, then $R$ is $D$-simple.
\end{proposition}
\begin{proof}
	We utilize the remark above. Take $c\in R\smallsetminus 0$. Viewing $c$ as an element of $S$, there is some $\delta\in D^n_{S|A}$ for some $n$ such that $\delta(c)=1$.
	
	Let $\beta:S\to R$ be a splitting of the inclusion map.	We claim that $\beta \circ \delta|_{R}\in D^n_{R|A}$. Of course, we induce on $n$. For $n=0$, we have $\delta=\bar{s}$ for some $s\in S$, and $\beta \circ \delta|_{R} = \bar{\beta(s)}$. In general, 
	\[ [\beta \circ \delta|_{R}, \bar{r}](x) = \beta (\delta(rx)) - r \beta (\delta(x)) = \beta (\delta(rx)) - \beta(r \delta(x)) = \beta\circ [\delta, \bar{r}]|_R (x), \]
	and the claim follows by induction.
	
	Now, since $\beta \circ \delta|_{R}(c)=1$, the proposition follows.
\end{proof}

We note also that localizations of $D$-simple rings are $D$-simple; this is left to you for the easy verification.

We can apply this notion to give an analogue of a statement we found in characteristic zero.

\begin{theorem}
	Let $A\subseteq R$ be an inclusion of rings, and suppose that $R$ is $D$-simple. Then, for any ideal of $R$, $\H^i_I(R)$ is a faithful $R$-module. In particular, if $(R,\m)$ is a local or graded direct summand of a polynomial ring over a field of characteristic zero, then every local cohomology module of $R$ is faithful.
\end{theorem}
\begin{proof}
	If $M$ is a $D$-module, then $\ann_{D_{R|A}}(M)$ is clearly a left ideal of $D_{R|A}$. Since the action of $R$ on $M$ agrees with the action of $D^0_{R|A}$ on $M$, we have that
\end{proof}

\end{comment}
\printindex

%\bibliographystyle{alpha}
%\bibliography{bibliography}


\end{document}